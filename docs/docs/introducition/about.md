# 简介

## 技术选型

> 基于Springcloud 和Vue.js的前后端分离的分布式在线评测系统



> HOJ基本逻辑架构图

![image-20201030234527577](https://cdn.jsdelivr.net/gh/HimitZH/CDN/images/hoj.png)



## 判题逻辑

1. 前端用户提交数据。
2. 后端数据服务（DataBackup）获取到数据，先将提交数据初始化，同时将该提交的状态变成等待中，写入数据库。
3. 通过Redis的发布订阅者，将该判题信息发送给对应的==等待判题频道订阅者==
4. 订阅者收到信息，初始化传输数据，使用springcloud alibaba通过nacos注册中心调用判题微服务。
5. 若是调用判题服务失败（没有空闲的判题服务器），则重新通过发布者将该提交信息发布到对应==等待判题频道==，重回3。
6. 若是调用失败超过40次，则将提交的状态修改为提交失败，不再进行判题服务的调用。
7. 前端用户可看到提交变成提交失败，可点击状态进行重新提交，重回2（注：重新提交不影响提交时间等数据）
8. 判题微服务获取到提交数据：
   - 若是远程调用，则通过Redis的发布订者发布到对应的==远程判题等待提交频道==，对应==频道接收者==获取提交信息，进行远程提交，获取对应的提交ID，再通过==远程判题等待结果频道===发布给对应频道接收者，该频道接收者接受到信息，进行结果获取，获取结果失败，则再次重复发布；获取成功，写回数据库。
   - 若是自家题目提交，则启用线程池多线程使用Http将对应测试点数据与代码提交给Go-Judge判题沙盒进行编译与评测，最后获取各个评测点结果，进行结果计算写回数据库。