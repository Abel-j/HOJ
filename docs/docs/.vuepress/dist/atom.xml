<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-US">
  <id>https://hcode.top/docs/</id>
  <title>HOJ</title>
  <updated>2021-12-23T14:25:17.980Z</updated>
  <generator>@mr-hope/vuepress-plugin-feed</generator>
  <link rel="self" href="https://hcode.top/docs/atom.xml"/>
  <link rel="alternate" href="https://hcode.top/docs/"/>
  <entry>
    <title type="html">Home</title>
    <id>https://hcode.top/docs/</id>
    <link href="https://hcode.top/docs/"/>
    <updated>2021-12-14T05:02:32.000Z</updated>
    <content type="html"><![CDATA[<p><a href="http://openjdk.java.net/" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/Java-1.8-informational" alt="Java" /></a>
<a href="https://spring.io/projects/spring-boot" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/Spring Boot-2.2.6.RELEASE-success" alt="Spring Boot" /></a>
<a href="https://spring.io/projects/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/Spring Cloud Alibaba-2.2.1.RELEASE-success" alt="SpringCloud Alibaba" /></a>
<a href="https://www.mysql.com/" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/MySQL-8.0.19-blue" alt="MySQL" /></a>
<a href="https://redis.io/" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/Redis-5.0.9-red" alt="Redis" /></a>
<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/Nacos-1.4.2-%23267DF7" alt="Nacos" /></a>
<a href="https://cn.vuejs.org/" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/Vue-2.6.11-success" alt="Vue" /></a>
<a href="https://qm.qq.com/cgi-bin/qm/qr?k=WWGBZ5gfDiBZOcpNvM8xnZTfUq7BT4Rs&amp;jump_from=webapi" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/QQ Group-598587305-blue" alt="QQ Group 598587305" /></a></p>
<p>Hcode Online Judge (HOJ) : 基于前后端分离，分布式架构的在线测评平台（hoj），前端使用vue，后端主要使用springboot，redis，mysql，nacos等技术，<strong>支持HDU、POJ、Codeforces（包括GYM）的vjudge判题，同时适配手机端、电脑端浏览，拥有讨论区与站内消息系统，还有完善的比赛功能（打星队伍、关注队伍、外榜）。</strong></p>
<p><a href="https://github.com/HimitZH/HOJ" target="_blank" rel="noopener noreferrer">Github 仓库</a>
<a href="https://gitee.com/himitzh0730/hoj" target="_blank" rel="noopener noreferrer">Gitee 仓库</a></p>
<p>欢迎star收藏本项目对开发者的支持，谢谢<br>
有任何部署问题或项目bug请发issue或者加QQ群<br>
<strong>如果要对本项目进行商业化，请在页面底部的Powered by指向HOJ本仓库地址</strong></p>
<p><a href="https://hdoi.cn/" target="_blank" rel="noopener noreferrer">HDOI Onlie Judge</a></p>
<h2 id="联系我们"> 联系我们</h2>
<p>QQ: <a href="https://wpa.qq.com/msgrd?v=3&amp;uin=372347736&amp;site=qq&amp;menu=yes" target="_blank" rel="noopener noreferrer">372347736</a><br>
HOJ交流群: 598587305</p>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-03-02T14:19:37.000Z</published>
  </entry>
  <entry>
    <title type="html">开启HTTPS</title>
    <id>https://hcode.top/docs/deploy/open-https/</id>
    <link href="https://hcode.top/docs/deploy/open-https/"/>
    <updated>2021-12-06T13:04:45.000Z</updated>
    <content type="html"><![CDATA[<h1 id="开启https"> 开启HTTPS</h1>
<ul>
<li>
<p>单机部署：</p>
<p>提供server.crt和server.key证书与密钥文件放置<code>/standAlone</code>目录下，与<code>docker-compose.yml</code>和<code>.env</code>文件放置同一位置，然后修改<code>docker-compose.yml</code>中的hoj-frontend的配置</p>
</li>
<li>
<p>分布式部署：</p>
<p>提供server.crt和server.key证书与密钥文件放置<code>/distributed/main</code>目录下，与<code>docker-compose.yml</code>和<code>.env</code>文件放置同一位置，然后修改<code>docker-compose.yml</code>中的hoj-frontend的配置</p>
</li>
</ul>
<div><pre><code><span>hoj-frontend</span><span>:</span>
    <span>image</span><span>:</span> registry.cn<span>-</span>shenzhen.aliyuncs.com/hcode/hoj_frontend
    <span>container_name</span><span>:</span> hoj<span>-</span>frontend
    <span>restart</span><span>:</span> always
    <span># 开启https，请提供证书</span>
    <span>volumes</span><span>:</span>
      <span>-</span> ./server.crt<span>:</span>/etc/nginx/etc/crt/server.crt
      <span>-</span> ./server.key<span>:</span>/etc/nginx/etc/crt/server.key
    <span># 修改前端logo</span>
    <span># - ./logo.a0924d7d.png:/usr/share/nginx/html/assets/img/logo.a0924d7d.png</span>
    <span># - ./backstage.8bce8c6e.png:/usr/share/nginx/html/assets/img/backstage.8bce8c6e.png</span>
    <span>environment</span><span>:</span>
      <span>-</span> SERVER_NAME=localhost  <span># 提供你的域名！！！！</span>
      <span>-</span> BACKEND_SERVER_HOST=$<span>{</span>BACKEND_HOST<span>:</span><span>-</span>172.20.0.5<span>}</span> <span># backend后端服务地址</span>
      <span>-</span> BACKEND_SERVER_PORT=$<span>{</span>BACKEND_PORT<span>:</span><span>-6688</span><span>}</span> <span># backend后端服务端口号</span>
      <span>-</span> USE_HTTPS=true <span># 使用https请设置为true</span>
    <span>ports</span><span>:</span>
      <span>-</span> <span>"80:80"</span>
      <span>-</span> <span>"443:443"</span>
    <span>networks</span><span>:</span>
      <span>hoj-network</span><span>:</span>
        <span>ipv4_address</span><span>:</span> 172.20.0.6
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br></div></div>]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-12-06T13:04:45.000Z</published>
  </entry>
  <entry>
    <title type="html">快速部署</title>
    <id>https://hcode.top/docs/deploy/docker/</id>
    <link href="https://hcode.top/docs/deploy/docker/"/>
    <updated>2021-12-22T05:12:42.000Z</updated>
    <content type="html"><![CDATA[<h1 id="快速部署"> 快速部署</h1>
<p><strong>前提：已经在上一步准备好docker与docker-compose</strong></p>
<div><p>Warning</p>
<p>注意：如果正式部署运用HOJ，请修改默认配置的密码，例如Redis、MySQL、Nacos的密码！！！<br>
<strong>使用默认密码可能会导致数据泄露，网站及其不安全！</strong></p>
</div>
<h2 id="一、单机部署"> 一、单机部署</h2>
<ol>
<li>
<p>选择好需要安装的位置，运行下面命令</p>
<div><pre><code><span>git</span> clone https://gitee.com/himitzh0730/hoj-deploy.git <span>&amp;&amp;</span> <span>cd</span> hoj-deploy
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>进入文件夹，使用docker-compose启动各容器服务</p>
<div><pre><code><span>cd</span> standAlone
</code></pre>
<div><span>1</span><br></div></div><p><code>standAlone</code>文件夹文件有以下：</p>
<div><pre><code>├── docker-compose.yml
├── .env
</code></pre>
<div><span>1</span><br><span>2</span><br></div></div><p>主要配置请修改<code>.env</code>文件，内容如下：</p>
<blockquote>
<p>注意：各服务ip最好不改动，保持处于172.20.0.0/16网段的docker network</p>
</blockquote>
<div><pre><code><span># hoj全部数据存储的文件夹位置（默认当前路径生成hoj文件夹）</span>
<span>HOJ_DATA_DIRECTORY</span><span>=</span><span>./hoj</span>

<span># redis的配置</span>
<span>REDIS_HOST</span><span>=</span><span>172.20.0.2</span>
<span>REDIS_PORT</span><span>=</span><span>6379</span>
<span>REDIS_PASSWORD</span><span>=</span><span>hoj123456 # 正式部署请修改</span>

<span># mysql的配置</span>
<span>MYSQL_HOST</span><span>=</span><span>172.20.0.3</span>
<span># 如果判题服务是分布式，请提供当前mysql所在服务器的公网ip</span>
<span>MYSQL_PUBLIC_HOST</span><span>=</span><span>172.20.0.3</span>
<span>MYSQL_PORT</span><span>=</span><span>3306</span>
<span>MYSQL_ROOT_PASSWORD</span><span>=</span><span>hoj123456 # 正式部署请修改</span>

<span># nacos的配置</span>
<span>NACOS_HOST</span><span>=</span><span>172.20.0.4</span>
<span>NACOS_PORT</span><span>=</span><span>8848</span>
<span>NACOS_USERNAME</span><span>=</span><span>root</span>
<span>NACOS_PASSWORD</span><span>=</span><span>hoj123456 # 正式部署请修改</span>

<span># backend后端服务的配置</span>
<span>BACKEND_HOST</span><span>=</span><span>172.20.0.5</span>
<span>BACKEND_PORT</span><span>=</span><span>6688</span>
<span># token加密秘钥 默认则生成32位随机密钥</span>
<span>JWT_TOKEN_SECRET</span><span>=</span><span>default</span>
<span># token过期时间默认为24小时 86400s</span>
<span>JWT_TOKEN_EXPIRE</span><span>=</span><span>86400</span>
<span># token默认12小时可自动刷新</span>
<span>JWT_TOKEN_FRESH_EXPIRE</span><span>=</span><span>43200</span>
<span># 调用判题服务器的token 默认则生成32位随机密钥</span>
<span>JUDGE_TOKEN</span><span>=</span><span>default</span>
<span># 请使用邮件服务的域名或ip</span>
<span>EMAIL_SERVER_HOST</span><span>=</span><span>smtp.qq.com</span>
<span>EMAIL_SERVER_PORT</span><span>=</span><span>465</span>
<span>EMAIL_USERNAME</span><span>=</span><span>your_email_username</span>
<span>EMAIL_PASSWORD</span><span>=</span><span>your_email_password</span>
<span># 开启虚拟判题请提供对应oj的账号密码 格式为 </span>
<span># username1,username2,...</span>
<span># password1,password2,...</span>
<span>HDU_ACCOUNT_USERNAME_LIST</span><span>=</span>
<span>HDU_ACCOUNT_PASSWORD_LIST</span><span>=</span>
<span>CF_ACCOUNT_USERNAME_LIST</span><span>=</span>
<span>CF_ACCOUNT_PASSWORD_LIST</span><span>=</span>
<span>POJ_ACCOUNT_USERNAME_LIST</span><span>=</span>
<span>POJ_ACCOUNT_PASSWORD_LIST</span><span>=</span>

<span># judgeserver的配置</span>
<span>JUDGE_SERVER_IP</span><span>=</span><span>172.20.0.7</span>
<span>JUDGE_SERVER_PORT</span><span>=</span><span>8088</span>
<span>JUDGE_SERVER_NAME</span><span>=</span><span>judger-alone</span>

<span> # docker network的配置</span>
<span> SUBNET</span><span>=</span><span>172.20.0.0/16</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br></div></div></li>
</ol>
<div><p>Tips</p>
<p>提示：如果服务器的内存在4G或4G以上，请去掉JVM限制才能大大提高并发量，操作如下：</p>
</div>
<div><pre><code><span>vim</span> docker-compose.yml
</code></pre>
<div><span>1</span><br></div></div><p><strong>注释或去掉图中选中的行</strong></p>
<p>① hoj-backend模块</p>
<p><img src="https://img-blog.csdnimg.cn/4dfdcb2461c742f1b3717a8a27c3598a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述" /></p>
<p>② hoj-judgeserver模块</p>
<p><img src="https://img-blog.csdnimg.cn/9a936ad86ff2439a9e1188c286cfd751.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述" /></p>
<p>如果不改动，则以默认参数启动（<strong>测试可以不改，但正式部署请修改默认配置的密码！</strong>）</p>
<div><pre><code>docker-compose up -d
</code></pre>
<div><span>1</span><br></div></div><p><strong>根据网速情况，大约十到二十分钟拉取镜像，全程无需人工干预，拉取完毕后，自动启动容器服务，大概需要一至两分钟的初始化。</strong></p>
<p>等待命令执行完毕后，查看容器状态</p>
<div><pre><code>docker <span>ps</span> -a
</code></pre>
<div><span>1</span><br></div></div><p>当看到所有的容器的状态status都为<code>UP</code>或<code>healthy</code>就代表 OJ 已经启动成功。</p>
<p>以下默认参数说明</p>
<div><p>Note</p>
<ul>
<li>默认超级管理员账号与密码：root / hoj123456</li>
<li>默认redis密码：hoj123456（<strong>正式部署请修改</strong>）</li>
<li>默认mysql账号与密码：root / hoj123456（<strong>正式部署请修改</strong>）</li>
<li>默认nacos管理员账号与密码：root / hoj123456（<strong>正式部署请修改</strong>）</li>
<li>默认不开启https，开启需修改文件同时提供证书文件</li>
<li>判题并发数默认：cpu核心数+1</li>
<li>默认开启vj判题，需要手动修改添加账号与密码，如果不添加不能vj判题！</li>
<li>vj判题并发数默认：cpu核心数*2+1</li>
</ul>
</div>
<p><strong>登录root账号到后台查看服务状态以及到<code>http://ip/admin/conf</code>修改服务配置!</strong></p>
<p><u>注意：网站的注册及用户账号相关操作需要邮件系统，所以请在系统配置中配置自己的SMTP邮件服务。</u></p>
<p><strong>(如果已经在启动在.env文件配置了邮件服务即不用再次修改)</strong></p>
<div><pre><code>Host: smtp.qq.com
Port: <span>465</span>
Username: qq邮箱账号
Password: 开启SMTP服务后生成的随机授权码
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><h2 id="二、分布式部署"> 二、分布式部署</h2>
<div><p>Tips</p>
<p>主服务器（运行nacos，backend, frontend,redis）的服务器防火墙请开 <strong>8848，3306，873</strong>端口号<br>
从服务器（运行judgeserver）的服务器防火墙请开<strong>8088</strong>端口号</p>
</div>
<ol>
<li>
<p>选择好需要安装的位置，运行下面命令</p>
<div><pre><code><span>git</span> clone https://gitee.com/himitzh0730/hoj-deploy.git <span>&amp;&amp;</span> <span>cd</span> hoj-deploy
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>进入文件夹</p>
<div><pre><code><span>cd</span> distributed
</code></pre>
<div><span>1</span><br></div></div><p><code>distributed</code>文件夹有以下：</p>
<div><pre><code>├── judgeserver
├── main
</code></pre>
<div><span>1</span><br><span>2</span><br></div></div></li>
<li>
<p>首先部署主服务，即是数据后台服务（DataBackup）</p>
<div><pre><code><span>cd</span> main
</code></pre>
<div><span>1</span><br></div></div><p>该文件夹下有：</p>
<div><pre><code>├── docker-compose.yml
├── .env
</code></pre>
<div><span>1</span><br><span>2</span><br></div></div><p>修改<code>.env</code>文件中的配置</p>
<div><pre><code><span>vim</span> .env
</code></pre>
<div><span>1</span><br></div></div><blockquote>
<p>注意：各服务ip最好不改动，保持处于172.20.0.0/16网段的docker network</p>
</blockquote>
<div><pre><code><span># hoj全部数据存储的文件夹位置（默认当前路径生成hoj文件夹）</span>
<span>HOJ_DATA_DIRECTORY</span><span>=</span><span>./hoj</span>

<span># redis的配置</span>
<span>REDIS_HOST</span><span>=</span><span>172.20.0.2</span>
<span>REDIS_PORT</span><span>=</span><span>6379</span>
<span>REDIS_PASSWORD</span><span>=</span><span>hoj123456 # 正式部署请修改</span>

<span># mysql的配置</span>
<span>MYSQL_HOST</span><span>=</span><span>172.20.0.3</span>
<span># 请提供当前mysql所在服务器的公网ip</span>
<span>MYSQL_PUBLIC_HOST</span><span>=</span><span>172.20.0.3</span>
<span>MYSQL_PORT</span><span>=</span><span>3306</span>
<span>MYSQL_ROOT_PASSWORD</span><span>=</span><span>hoj123456 # 正式部署请修改</span>

<span># nacos的配置</span>
<span>NACOS_HOST</span><span>=</span><span>172.20.0.4</span>
<span>NACOS_PORT</span><span>=</span><span>8848</span>
<span>NACOS_USERNAME</span><span>=</span><span>root</span>
<span>NACOS_PASSWORD</span><span>=</span><span>hoj123456 # 正式部署请修改</span>

<span># backend后端服务的配置</span>
<span>BACKEND_HOST</span><span>=</span><span>172.20.0.5</span>
<span>BACKEND_PORT</span><span>=</span><span>6688</span>
<span># token加密秘钥 默认则生成32位随机密钥</span>
<span>JWT_TOKEN_SECRET</span><span>=</span><span>default</span>
<span># token过期时间默认为24小时 86400s</span>
<span>JWT_TOKEN_EXPIRE</span><span>=</span><span>86400</span>
<span># token默认12小时可自动刷新</span>
<span>JWT_TOKEN_FRESH_EXPIRE</span><span>=</span><span>43200</span>
<span># 调用判题服务器的token 默认则生成32位随机密钥</span>
<span>JUDGE_TOKEN</span><span>=</span><span>default</span>
<span># 请使用邮件服务的域名或ip</span>
<span>EMAIL_SERVER_HOST</span><span>=</span><span>smtp.qq.com</span>
<span>EMAIL_SERVER_PORT</span><span>=</span><span>465</span>
<span>EMAIL_USERNAME</span><span>=</span><span>your_email_username</span>
<span>EMAIL_PASSWORD</span><span>=</span><span>your_email_password</span>
<span># 开启虚拟判题请提供对应oj的账号密码 格式为 </span>
<span># username1,username2,...</span>
<span># password1,password2,...</span>
<span>HDU_ACCOUNT_USERNAME_LIST</span><span>=</span><span>username1,username2</span>
<span>HDU_ACCOUNT_PASSWORD_LIST</span><span>=</span><span>password1,password2</span>
<span>CF_ACCOUNT_USERNAME_LIST</span><span>=</span>
<span>CF_ACCOUNT_PASSWORD_LIST</span><span>=</span>
<span>POJ_ACCOUNT_USERNAME_LIST</span><span>=</span>
<span>POJ_ACCOUNT_PASSWORD_LIST</span><span>=</span>

<span># 评测数据同步的配置</span>
<span># 请修改数据同步密码</span>
<span>RSYNC_PASSWORD</span><span>=</span><span>hoj123456 # 正式部署请修改</span>

<span># docker network的配置</span>
<span>SUBNET</span><span>=</span><span>172.20.0.0/16</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br></div></div><p>配置修改保存后，当前路径下启动该服务</p>
<div><pre><code>docker-compose up -d
</code></pre>
<div><span>1</span><br></div></div><p>根据网速情况，大约十分钟即可安装完毕，全程无需人工干预。</p>
<p>等待命令执行完毕后，查看容器状态</p>
<div><pre><code>docker <span>ps</span> -a
</code></pre>
<div><span>1</span><br></div></div><p>当看到所有的容器的状态status都为<code>UP</code>或<code>healthy</code>就代表 OJ 已经启动成功。</p>
</li>
<li>
<p>接着，在另一台服务器上，依旧git clone该文件夹下来，然后进入<code>judgeserver</code>文件夹，修改<code>.env</code>的配置</p>
<div><pre><code><span># hoj全部数据存储的文件夹位置（默认当前路径生成judge文件夹）</span>
<span>HOJ_JUDGESERVER_DATA_DIRECTORY</span><span>=</span><span>./judge</span>

<span># nacos的配置</span>
<span># 修改为nacos所在服务的ip</span>
<span>NACOS_HOST</span><span>=</span><span>NACOS_HOST</span>
<span># 修改为nacos启动端口号，默认为8848</span>
<span>NACOS_PORT</span><span>=</span><span>8848</span>
<span># 修改为nacos的管理员账号</span>
<span>NACOS_USERNAME</span><span>=</span><span>root</span>
<span># 修改为nacos的管理员密码</span>
<span>NACOS_PASSWORD</span><span>=</span><span>hoj123456</span>

<span># judgeserver的配置</span>
<span>#修改服务器公网ip</span>
<span>JUDGE_SERVER_IP</span><span>=</span><span>172.20.0.7</span>
<span>JUDGE_SERVER_PORT</span><span>=</span><span>8088</span>
<span>JUDGE_SERVER_NAME</span><span>=</span><span>judger-1</span>
<span># -1表示最大并行任务数为cpu核心数+1</span>
<span>MAX_TASK_NUM</span><span>=</span><span>-1</span>
<span># 当前判题服务器是否开启远程虚拟判题功能</span>
<span>REMOTE_JUDGE_OPEN</span><span>=</span><span>true</span>
<span># -1表示最大并行任务数为cpu核心数*2+1</span>
<span>REMOTE_JUDGE_MAX_TASK_NUM</span><span>=</span><span>-1</span>

<span># rsync评测数据同步的配置</span>
<span># 写入主服务器ip</span>
<span>RSYNC_MASTER_ADDR</span><span>=</span><span>127.0.0.1</span>
<span># 与主服务器的rsync密码一致</span>
<span>RSYNC_PASSWORD</span><span>=</span><span>hoj123456 </span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br></div></div><p>配置修改保存后，当前路径下启动该服务</p>
<div><pre><code>docker-compose up -d
</code></pre>
<div><span>1</span><br></div></div><blockquote>
<p>提示：需要开启多台判题机，就如当前第4步的操作一样，在每台服务器上执行以上的操作即可。</p>
</blockquote>
</li>
<li>
<p>两个服务都启动完成，在浏览器输入主服务ip或域名进行访问，登录root账号到后台查看服务状态。</p>
</li>
</ol>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-05-23T14:43:06.000Z</published>
  </entry>
  <entry>
    <title type="html">环境配置</title>
    <id>https://hcode.top/docs/deploy/</id>
    <link href="https://hcode.top/docs/deploy/"/>
    <updated>2021-11-14T05:56:04.000Z</updated>
    <content type="html"><![CDATA[<h1 id="环境配置"> 环境配置</h1>
<h2 id="环境说明"> 环境说明</h2>
<div><p>Tips</p>
<ul>
<li>后端：需要在Linux系统下部署运行，建议使用ubuntu18.04，其它版本的Linux系统也可，同时需要<strong>Docker</strong>辅助部署</li>
<li>前端：Linux系统下，需要nginx进行反向代理</li>
<li>判题服务：由于判题沙盒有多操作系统版本，Linux系统或Windows都可，但是在本HOJ镜像中<strong>只能</strong>使用<strong>Ubuntu16.04</strong>以上或者<strong>CentOS8</strong>以上。</li>
<li>数据同步：需要运行判题服务和后端服务的服务器有rsync即可</li>
<li><strong>尽量不要使用突发性能或共享型的云服务器实例，有可能造成评测时间计量不准确。</strong></li>
</ul>
</div>
<h2 id="linux环境搭建"> Linux环境搭建</h2>
<blockquote>
<p>HOJ使用的Ubuntu18.04版本，单机部署建议2核4G以上内存</p>
</blockquote>
<h3 id="安装docker"> 安装docker</h3>
<ol>
<li>
<p>安装需要的包</p>
<div><pre><code><span>sudo</span> <span>apt-get</span> update
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>安装依赖包</p>
<div><pre><code><span>sudo</span> <span>apt-get</span> <span>install</span> <span>\</span>
   apt-transport-https <span>\</span>
   ca-certificates <span>\</span>
   <span>curl</span> <span>\</span>
   gnupg-agent <span>\</span>
   software-properties-common
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div></li>
<li>
<p>添加 Docker 的官方 GPG 密钥</p>
<div><pre><code><span>curl</span> -fsSL https://download.docker.com/linux/ubuntu/gpg <span>|</span> <span>sudo</span> apt-key <span>add</span> -
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>设置远程仓库</p>
<div><pre><code><span>sudo</span> add-apt-repository <span>\</span>
   <span>"deb [arch=amd64] https://download.docker.com/linux/ubuntu \
  <span><span>$(</span>lsb_release -cs<span>)</span></span> \
  stable"</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div></li>
<li>
<p>安装 Docker-CE</p>
<div><pre><code><span>sudo</span> <span>apt-get</span> update
<span>sudo</span> <span>apt-get</span> <span>install</span> docker-ce docker-ce-cli containerd.io
</code></pre>
<div><span>1</span><br><span>2</span><br></div></div></li>
<li>
<p>验证是否成功</p>
<div><pre><code><span>sudo</span> docker run hello-world
</code></pre>
<div><span>1</span><br></div></div></li>
</ol>
<h3 id="安装docker-compose"> 安装docker-compose</h3>
<ol>
<li>
<p>下载</p>
<div><pre><code><span>sudo</span> <span>curl</span> -L https://get.daocloud.io/docker/compose/releases/download/1.25.5/docker-compose-<span><span>`</span><span>uname</span> -s<span>`</span></span>-<span><span>`</span><span>uname</span> -m<span>`</span></span> -o /usr/local/bin/docker-compose
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>授权</p>
<div><pre><code><span>sudo</span> <span>chmod</span> +x /usr/local/bin/docker-compose
</code></pre>
<div><span>1</span><br></div></div></li>
</ol>
<h2 id="windows-环境"> Windows 环境</h2>
<p>Windows 下的安装仅供体验，勿在生产环境使用。如有必要，请使用虚拟机安装 Linux 并将 OJ 安装在其中。</p>
<p>以下教程仅适用于 Win10 x64 下的 <code>PowerShell</code></p>
<ol>
<li>安装 Windows 的 Docker 工具</li>
<li>右击右下角 Docker 图标，选择 Settings 进行设置</li>
<li>选择 <code>Shared Drives</code> 菜单，之后勾选你想安装 OJ 的盘符位置（例如勾选D盘），点击 <code>Apply</code></li>
<li>输入 Windows 的账号密码进行文件共享</li>
<li>安装 <code>Python</code>、<code>pip</code>、<code>git</code>、<code>docker-compose</code>，安装方法自行搜索。</li>
</ol>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-03-02T14:19:37.000Z</published>
  </entry>
  <entry>
    <title type="html">如何更新</title>
    <id>https://hcode.top/docs/deploy/update/</id>
    <link href="https://hcode.top/docs/deploy/update/"/>
    <updated>2021-12-14T05:02:32.000Z</updated>
    <content type="html"><![CDATA[<h1 id="如何更新"> 如何更新</h1>
<h2 id="一、无二次开发的更新"> 一、无二次开发的更新</h2>
<div><p>Note</p>
<p>2021.09.21之后部署hoj的请看下面操作</p>
</div>
<p>请在对应的docker-compose.yml当前文件夹下执行<code>docker-compose pull</code>拉取最新镜像，然后重新<code>docker-compose up -d</code>即可。</p>
<div><p>Note</p>
<p>2021.09.21之前部署hoj的请看下面操作</p>
</div>
<h3 id="_1、修改mysql8-0默认的密码加密方式"> 1、修改MySQL8.0默认的密码加密方式</h3>
<p>（1）进行hoj-mysql容器</p>
<div><pre><code>docker <span>exec</span> -it hoj-mysql <span>bash</span>
</code></pre>
<div><span>1</span><br></div></div><p>(2) 输入对应的mysql密码，进入mysql数据库</p>
<p>注意：-p 后面跟着数据库密码例如hoj123456</p>
<div><pre><code>mysql -uroot -p数据库密码
</code></pre>
<div><span>1</span><br></div></div><p>（3）成功进入后，执行以下命令</p>
<div><pre><code>mysql<span>></span> use mysql<span>;</span>

mysql<span>></span> grant all PRIVILEGES on *.* to root@<span>'%'</span> WITH GRANT OPTION<span>;</span>

 
mysql<span>></span> ALTER user <span>'root'</span>@<span>'%'</span> IDENTIFIED BY <span>'数据库密码'</span> PASSWORD EXPIRE NEVER<span>;</span>

 
mysql<span>></span> ALTER user <span>'root'</span>@<span>'%'</span> IDENTIFIED WITH mysql_native_password BY <span>'数据库密码'</span><span>;</span>

 
mysql<span>></span> FLUSH PRIVILEGES<span>;</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><p>（4） 两次exit 退出mysql和容器</p>
<h3 id="_2、-添加hoj-mysql-checker模块"> 2、 添加hoj-mysql-checker模块</h3>
<p>（1）可以选择拉取仓库最新的docker-compose.yml文件（跟部署操作一样,但是会覆盖之前设置的参数）或者访问：</p>
<p>https://gitee.com/himitzh0730/hoj-deploy/blob/master/standAlone/docker-compose.yml</p>
<p>（2）或者编辑docker-compose.yml文件，手动添加新模块</p>
<div><pre><code>  <span>hoj-mysql-checker</span><span>:</span>
    <span>image</span><span>:</span> registry.cn<span>-</span>shenzhen.aliyuncs.com/hcode/hoj_database_checker
    <span>container_name</span><span>:</span> hoj<span>-</span>mysql<span>-</span>checker
    <span>depends_on</span><span>:</span>
      <span>-</span> hoj<span>-</span>mysql
    <span>links</span><span>:</span>
      <span>-</span> hoj<span>-</span>mysql<span>:</span>mysql
    <span>environment</span><span>:</span>
      <span>-</span> MYSQL_ROOT_PASSWORD=$<span>{</span>MYSQL_ROOT_PASSWORD<span>:</span><span>-</span>hoj123456<span>}</span>
    <span>networks</span><span>:</span>
      <span>hoj-network</span><span>:</span>
        <span>ipv4_address</span><span>:</span> 172.20.0.8
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><p>(3)  保存后重启容器即可</p>
<div><pre><code>docker-compose down

docker-compose pull

docker-compose up -d
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p><strong>注意</strong>：此次修改成功后，以后更新，都请在对应的docker-compose.yml当前文件夹下执行<code>docker-compose pull</code>拉取最新镜像，然后重新<code>docker-compose up -d</code>即可。</p>
<h2 id="二、自定义前端的更新"> 二、自定义前端的更新</h2>
<blockquote>
<p>附加：如何自定义前端请看这里 =&gt; <a href="/use/update-fe.html">自定义前端文档</a></p>
</blockquote>
<p>（1）首先到<code>./hoj/hoj-vue</code>文件夹中，拉取<a href="https://gitee.com/himitzh0730/hoj/tree/master/hoj-vue" target="_blank" rel="noopener noreferrer">hoj-vue</a>仓库最新的代码，请注意解决出现的冲突。</p>
<div><pre><code><span>git</span> pull
</code></pre>
<div><span>1</span><br></div></div><p>或者重新直接download成zip包，然后重新自定义修改前端</p>
<p>当然，如果想查看对比主仓库更新的内容，可以用以下命令一步步合并</p>
<div><pre><code><span>git</span> remote -v                 <span># 查看主仓库的远程仓库</span>
<span>git</span> fetch origin master:temp  <span># 将最新的主仓库代码拉到本地一个temp的分支</span>
<span>git</span> <span>diff</span> temp                 <span># 比较现在本地代码与最新temp分支的区别</span>
<span>git</span> merge temp                <span># 合并temp分支到本地的master分支</span>
<span>git</span> branch -d temp            <span># 删除temp这个临时分支</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>（2）接着，重新用npm打包，在<code>./hoj/hoj-vue/dist</code>文件夹会生成静态的前端文件，放到原来指定的位置即可</p>
<div><pre><code><span>npm</span> run build
</code></pre>
<div><span>1</span><br></div></div><p>（3）其它模块的更新，都请在对应的docker-compose.yml当前文件夹下执行<code>docker-compose pull</code>拉取最新镜像，然后重新<code>docker-compose up -d</code>即可。</p>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-12-06T13:04:45.000Z</published>
  </entry>
  <entry>
    <title type="html">多个判题机</title>
    <id>https://hcode.top/docs/deploy/multi-judgeserver/</id>
    <link href="https://hcode.top/docs/deploy/multi-judgeserver/"/>
    <updated>2021-12-06T13:04:45.000Z</updated>
    <content type="html"><![CDATA[<h1 id="多个判题机"> 多个判题机</h1>
<h2 id="前言"> 前言</h2>
<p>不同判题机之间是通过rsync进行数据同步的，所以需要配置相应的rsync服务。</p>
<p>同时注意以下两点：</p>
<ol>
<li>保证rsync-slave服务的密码与主服务rsync-master的数据同步密码一致</li>
<li>rsync-slave服务（判题机服务器）拉取主服务rsync-master的评测数据是每100s一次，所以后台上传评测数据后，需等待大概100s才能正常判题。</li>
</ol>
<h2 id="单体部署"> 单体部署</h2>
<p>如果之前是选择了单体部署，也就是主服务器既有backend和judgeserver服务，那么部署更多不同服务器的判题机应该如下修改：</p>
<ol>
<li>
<p>在原先运行的服务器上，修改<code>hoj-deploy/standAlone</code>文件夹里面的<code>docker-compose.yml</code>，<strong>添加以下rsync-master服务</strong>，数据同步密码请自行修改，如下：</p>
<p><strong>（注意：如果云服务器有防火墙请开启8848，3306，873端口）</strong></p>
<div><pre><code><span>hoj-rsync-master</span><span>:</span>
    <span>image</span><span>:</span> registry.cn<span>-</span>shenzhen.aliyuncs.com/hcode/hoj_rsync<span>:</span><span>1.0</span>
    <span>container_name</span><span>:</span> hoj<span>-</span>rsync<span>-</span>master
    <span>volumes</span><span>:</span>
      <span>-</span> ./hoj/testcase<span>:</span>/hoj/testcase<span>:</span>ro
    <span>environment</span><span>:</span>
      <span>-</span> RSYNC_MODE=master
      <span>-</span> RSYNC_USER=hojrsync 
      <span>-</span> RSYNC_PASSWORD=hoj123456 <span># 请修改数据同步密码</span>
    <span>ports</span><span>:</span>
      <span>-</span> <span>"0.0.0.0:873:873"</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><p><strong>同时，需要将MySQL的配置<code>MYSQL_PUBLIC_HOST</code>改成当前服务器的公网IP</strong></p>
<div><pre><code><span>vim</span> .env  <span># 修改与docker-compose.yml同目录下的配置文件</span>
</code></pre>
<div><span>1</span><br></div></div><div><pre><code><span># mysql的配置</span>
MYSQL_HOST=172.20.0.3
<span># 请提供当前mysql所在服务器的公网ip</span>
MYSQL_PUBLIC_HOST=<span>***</span>
MYSQL_PORT=3306
MYSQL_ROOT_PASSWORD=hoj123456
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></div></div></li>
<li>
<p>在其它服务器（判题机服务器）中使用docker-compose运行judgeserver服务，具体操作如下：</p>
<p><strong>（注意：如果云服务器有防火墙请开启8088端口号，需要将判题服务暴露出去）</strong></p>
<ol>
<li>
<p>下载文件,进入到指定文件夹</p>
<div><pre><code><span>git</span> clone https://gitee.com/himitzh0730/hoj-deploy.git <span>&amp;&amp;</span> <span>cd</span> hoj-deploy/distributed/judgeserver
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>修改配置<code>.env</code>文件,里面的nacos参数，judgeServer，rsync的参数请正确修改！</p>
<div><pre><code><span># nacos的配置</span>
<span># 修改为nacos所在服务的ip</span>
<span>NACOS_HOST</span><span>=</span><span>NACOS_HOST</span>
<span># 修改为nacos启动端口号，默认为8848</span>
<span>NACOS_PORT</span><span>=</span><span>8848</span>
<span># 修改为nacos的管理员账号</span>
<span>NACOS_USERNAME</span><span>=</span><span>root</span>
<span># 修改为nacos的管理员密码</span>
<span>NACOS_PASSWORD</span><span>=</span><span>hoj123456</span>

<span># judgeserver的配置</span>
<span>#修改为当前服务器公网ip</span>
<span>JUDGE_SERVER_IP</span><span>=</span><span>172.20.0.7</span>
<span>JUDGE_SERVER_PORT</span><span>=</span><span>8088</span>
<span>JUDGE_SERVER_NAME</span><span>=</span><span>judger-1</span>
<span># -1表示最大并行任务数为cpu核心数*2</span>
<span>MAX_TASK_NUM</span><span>=</span><span>-1</span>
<span># 当前判题服务器是否开启远程虚拟判题功能</span>
<span>REMOTE_JUDGE_OPEN</span><span>=</span><span>true</span>
<span># -1表示最大并行任务数为(cpu核心数*2)*2</span>
<span>REMOTE_JUDGE_MAX_TASK_NUM</span><span>=</span><span>-1</span>

<span># rsync评测数据同步的配置</span>
<span># 写入主服务器ip</span>
<span>RSYNC_MASTER_ADDR</span><span>=</span><span>127.0.0.1</span>
<span># 与主服务器的rsync密码一致</span>
<span>RSYNC_PASSWORD</span><span>=</span><span>hoj123456</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br></div></div></li>
<li>
<p>启动即可</p>
<div><pre><code>docker-compose up -d
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>验证：</p>
<div><pre><code>访问 http://ip:8088/version
如果返回信息正常即启动成功！
</code></pre>
<div><span>1</span><br><span>2</span><br></div></div></li>
</ol>
</li>
</ol>
<h2 id="分布式部署"> 分布式部署</h2>
<ol>
<li>
<p>如果之前已经选择了分布式部署，那么增加判题机，则与原先启动判题机的操作一样即可，在新的服务器上操作如下：</p>
<div><pre><code><span>git</span> clone https://gitee.com/himitzh0730/hoj-deploy.git <span>&amp;&amp;</span> <span>cd</span> hoj-deploy/distributed/judgeserver
<span>vim</span> .env
</code></pre>
<div><span>1</span><br><span>2</span><br></div></div></li>
<li>
<p>修改<code>.env</code>的配置</p>
<div><pre><code><span># nacos的配置</span>
<span># 修改为nacos所在服务的ip</span>
<span>NACOS_HOST</span><span>=</span><span>NACOS_HOST</span>
<span># 修改为nacos启动端口号，默认为8848</span>
<span>NACOS_PORT</span><span>=</span><span>8848</span>
<span># 修改为nacos的管理员账号</span>
<span>NACOS_USERNAME</span><span>=</span><span>root</span>
<span># 修改为nacos的管理员密码</span>
<span>NACOS_PASSWORD</span><span>=</span><span>hoj123456</span>

<span># judgeserver的配置</span>
<span>#修改为当前服务器公网ip</span>
<span>JUDGE_SERVER_IP</span><span>=</span><span>172.20.0.7</span>
<span>JUDGE_SERVER_PORT</span><span>=</span><span>8088</span>
<span>JUDGE_SERVER_NAME</span><span>=</span><span>judger-1</span>
<span># -1表示最大并行任务数为cpu核心数*2</span>
<span>MAX_TASK_NUM</span><span>=</span><span>-1</span>
<span># 当前判题服务器是否开启远程虚拟判题功能</span>
<span>REMOTE_JUDGE_OPEN</span><span>=</span><span>true</span>
<span># -1表示最大并行任务数为(cpu核心数*2)*2</span>
<span>REMOTE_JUDGE_MAX_TASK_NUM</span><span>=</span><span>-1</span>

<span># rsync评测数据同步的配置</span>
<span># 写入主服务器ip</span>
<span>RSYNC_MASTER_ADDR</span><span>=</span><span>127.0.0.1</span>
<span># 与主服务器的rsync密码一致</span>
<span>RSYNC_PASSWORD</span><span>=</span><span>hoj123456</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br></div></div></li>
<li>
<p>修改完保存，启动即可。</p>
<div><pre><code>docker-compose up -d
</code></pre>
<div><span>1</span><br></div></div></li>
</ol>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-12-06T13:04:45.000Z</published>
  </entry>
  <entry>
    <title type="html">如何备份</title>
    <id>https://hcode.top/docs/deploy/how-to-backup/</id>
    <link href="https://hcode.top/docs/deploy/how-to-backup/"/>
    <updated>2021-12-12T04:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="如何备份"> 如何备份</h1>
<h3 id="_1-单体部署"> 1. 单体部署</h3>
<p>请到<code>~/hoj-deploy/standAlone</code>的目录下，即是与<code>docker-compose.yml</code>的文件同个目录下，该目录下有个叫<code>hoj</code>的文件夹，里面的文件夹介绍如下：</p>
<div><pre><code>hoj
├── file   		# 存储了上传的图片、上传的临时题目数据、markdown引用的文件等文件
├── judge  		# 存储了每个提交题目的评测过程产生的数据
├── log    		# 存储了hoj-backend项目的运行日志
├── testcase    # 存储了题目的评测数据
└── data        
    ├── mysql
    │   ├── data # 存储了MySQL数据库的数据
    ├── redis
    │   ├── data # 存储了redis产生的快照数据
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><p>那么，如果需要备份，只需将该<code>hoj</code>文件夹复制一份即可，在新的机器上重新部署新的hoj的时候，将该文件夹放置与<code>docker-compose.yml</code>一个目录下，使用<code>docker-compose up -d</code>即可启动恢复原来的数据。</p>
<h3 id="_2-分布式部署"> 2. 分布式部署</h3>
<ul>
<li>
<p>主服务器（运行hoj-backend的服务器）</p>
<p>请到<code>~/hoj-deploy/distributed/main</code>的目录下，即是与<code>docker-compose.yml</code>的文件同个目录下，该目录下有个叫<code>hoj</code>的文件夹，里面的文件夹介绍如下：</p>
<div><pre><code>hoj
├── file   		# 存储了上传的图片、上传的临时题目数据、markdown引用的文件等文件
├── log    		# 存储了hoj-backend项目的运行日志
├── testcase    # 存储了题目的评测数据
└── data        
    ├── mysql
    │   ├── data # 存储了MySQL数据库的数据
    ├── redis
    │   ├── data # 存储了redis产生的快照数据
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div></li>
<li>
<p>判题服务器（运行hoj-judgeserver的服务器）</p>
<p>请到<code>~/hoj-deploy/distributed/judgeserver</code>的目录下，即是与<code>docker-compose.yml</code>的文件同个目录下，该目录下有个叫<code>judge</code>的文件夹，里面的文件夹介绍如下：</p>
<div><pre><code>judge
├── run  		# 存储了每个提交题目的评测过程产生的数据
├── log    		# 存储了hoj-judgeserver项目的运行日志
├── test_case   # 存储了题目的评测数据(每100s从主服务器同步)
├── spj         # 存储了SPJ的代码
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div></li>
</ul>
<p>那么，主要要备份的还是<strong>主服务器</strong>的数据，只需将该<code>hoj</code>文件夹复制一份即可，在新的机器上重新部署新的hoj的时候，将该文件夹放置与<code>docker-compose.yml</code>一个目录下，使用<code>docker-compose up -d</code>即可启动恢复原来的数据。</p>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-12-12T04:02:17.000Z</published>
  </entry>
  <entry>
    <title type="html">安全沙盒的调用</title>
    <id>https://hcode.top/docs/develop/sandbox/</id>
    <link href="https://hcode.top/docs/develop/sandbox/"/>
    <updated>2021-05-23T14:43:06.000Z</updated>
    <content type="html"><![CDATA[<h1 id="安全沙盒的调用"> 安全沙盒的调用</h1>
<blockquote>
<p>Judger-SandBox使用的是开源项目<a href="https://github.com/criyle/go-judge" target="_blank" rel="noopener noreferrer">go-judge</a>Linux版本的可执行文件，更多调用方式请自行浏览<a href="https://github.com/criyle/go-judge" target="_blank" rel="noopener noreferrer">go-judge</a></p>
</blockquote>
<p>HOJ用的是java来调用此沙盒，请看<a href="https://gitee.com/himitzh0730/hoj/tree/master/hoj-springboot/JudgeServer/src/main/java/top/hcode/hoj/judge" target="_blank" rel="noopener noreferrer">JudgeServer-judge</a>下的SandboxRun.java</p>
<p>启动<a href="https://gitee.com/himitzh0730/hoj/blob/master/judger/Judger-SandBox" target="_blank" rel="noopener noreferrer">Judger-SandBox</a>，默认监听5050端口</p>
<h4 id="验证是否启动"> 验证是否启动</h4>
<p>访问：<code>http://localhost:5050/version</code></p>
<h4 id="编译"> 编译</h4>
<p>1.1 请求的url为</p>
<blockquote>
<p><code>http://localhost:5050/run</code></p>
</blockquote>
<p>1.2 请求方式</p>
<blockquote>
<p>POST</p>
</blockquote>
<p>1.3 请求参数</p>
<blockquote>
<p>数据格式为json，内容如下</p>
</blockquote>
<div><pre><code> <span>{</span>
    <span>"cmd"</span><span>:</span> <span>[</span>
        <span>{</span>
            <span>"args"</span><span>:</span> <span>[</span>
                <span>"/usr/bin/g++"</span>, 
                <span>"a.cc"</span>, 
                <span>"-o"</span>, 
                <span>"a"</span>
            <span>]</span>, 
            <span>"env"</span><span>:</span> <span>[</span>
                <span>"PATH=/usr/bin:/bin"</span>
            <span>]</span>, 
            <span>"files"</span><span>:</span> <span>[</span>
                <span>{</span>
                    <span>"content"</span><span>:</span> <span>""</span>
                <span>}</span>, 
                <span>{</span>
                    <span>"name"</span><span>:</span> <span>"stdout"</span>, 
                    <span>"max"</span><span>:</span> <span>10240</span>
                <span>}</span>, 
                <span>{</span>
                    <span>"name"</span><span>:</span> <span>"stderr"</span>, 
                    <span>"max"</span><span>:</span> <span>10240</span>
                <span>}</span>
            <span>]</span>, 
            <span>"cpuLimit"</span><span>:</span> <span>10000000000</span>, 
            <span>"memoryLimit"</span><span>:</span> <span>104857600</span>, 
            <span>"procLimit"</span><span>:</span> <span>50</span>, 
            <span>"copyIn"</span><span>:</span> <span>{</span>
                <span>"a.cc"</span><span>:</span> <span>{</span>
                  <span>"content"</span><span>:</span> <span>"#include &lt;iostream><span title="\n">\n</span>using namespace std;<span title="\n">\n</span>int main() {<span title="\n">\n</span>int a, b;<span title="\n">\n</span>cin >> a >> b;<span title="\n">\n</span>cout &lt;&lt; a + b &lt;&lt; endl;<span title="\n">\n</span>}"</span>
                <span>}</span>
            <span>}</span>, 
            <span>"copyOut"</span><span>:</span> <span>[</span>
                <span>"stdout"</span>, 
                <span>"stderr"</span>
            <span>]</span>, 
            <span>"copyOutCached"</span><span>:</span> <span>[</span>
                <span>"a.cc"</span>, 
                <span>"a"</span>
            <span>]</span>, 
            <span>"copyOutDir"</span><span>:</span> <span>"1"</span>
        <span>}</span>
    <span>]</span>
<span>}</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br></div></div><p>1.4 返回的数据为json格式</p>
<div><pre><code>  <span>[</span>
         <span>{</span>
             <span>"status"</span><span>:</span> <span>"Accepted"</span><span>,</span>
             <span>"exitStatus"</span><span>:</span> <span>0</span><span>,</span>
             <span>"time"</span><span>:</span> <span>303225231</span><span>,</span>
             <span>"memory"</span><span>:</span> <span>32243712</span><span>,</span>
             <span>"runTime"</span><span>:</span> <span>524177700</span><span>,</span>
             <span>"files"</span><span>:</span> <span>{</span>
                 <span>"stderr"</span><span>:</span> <span>""</span><span>,</span>
                 <span>"stdout"</span><span>:</span> <span>""</span>
             <span>}</span><span>,</span>
             <span>"fileIds"</span><span>:</span> <span>{</span>
                 <span>"a"</span><span>:</span> <span>"WDQL5TNLRRVB2KAP"</span><span>,</span>
                 <span>"a.cc"</span><span>:</span> <span>"NOHPGGDTYQUFRSLJ"</span>
             <span>}</span>
         <span>}</span>
     <span>]</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div><h4 id="运行与评测"> 运行与评测</h4>
<p>2.1 请求的url为</p>
<blockquote>
<p><code>http://localhost:5050/run</code></p>
</blockquote>
<p>2.2 请求方式</p>
<blockquote>
<p>POST</p>
</blockquote>
<p>2.3 请求参数</p>
<blockquote>
<p>数据格式为json，内容如下</p>
</blockquote>
<div><pre><code><span>{</span>
    <span>"cmd"</span><span>:</span> <span>[</span><span>{</span>
        <span>"args"</span><span>:</span> <span>[</span><span>"a"</span><span>]</span><span>,</span>
        <span>"env"</span><span>:</span> <span>[</span><span>"PATH=/usr/bin:/bin"</span><span>,</span><span>"LANG=en_US.UTF-8"</span><span>,</span><span>"LC_ALL=en_US.UTF-8"</span><span>,</span><span>"LANGUAGE=en_US:en"</span><span>]</span><span>,</span>
        <span>"files"</span><span>:</span> <span>[</span><span>{</span>
            <span>"src"</span><span>:</span> <span>"/judge/test_case/problem_1010/1.in"</span>
        <span>}</span><span>,</span> <span>{</span>
            <span>"name"</span><span>:</span> <span>"stdout"</span><span>,</span>
            <span>"max"</span><span>:</span> <span>10240</span>
        <span>}</span><span>,</span> <span>{</span>
            <span>"name"</span><span>:</span> <span>"stderr"</span><span>,</span>
            <span>"max"</span><span>:</span> <span>10240</span>
        <span>}</span><span>]</span><span>,</span>
        <span>"cpuLimit"</span><span>:</span> <span>10000000000</span><span>,</span>
        <span>"realCpuLimit"</span><span>:</span><span>30000000000</span><span>,</span>
        <span>"stackLimit"</span><span>:</span><span>134217728</span><span>,</span>
        <span>"memoryLimit"</span><span>:</span> <span>104811111</span><span>,</span>
        <span>"procLimit"</span><span>:</span> <span>50</span><span>,</span>
        <span>"copyIn"</span><span>:</span> <span>{</span>
            <span>"a"</span><span>:</span><span>{</span><span>"fileId"</span><span>:</span><span>"WDQL5TNLRRVB2KAP"</span><span>}</span>
        <span>}</span><span>,</span>
        <span>"copyOut"</span><span>:</span> <span>[</span><span>"stdout"</span><span>,</span> <span>"stderr"</span><span>]</span>
    <span>}</span><span>]</span>
<span>}</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br></div></div><p>2.4 返回的数据为json格式</p>
<div><pre><code><span>[</span><span>{</span>
  <span>"status"</span><span>:</span> <span>"Accepted"</span><span>,</span>
  <span>"exitStatus"</span><span>:</span> <span>0</span><span>,</span>
  <span>"time"</span><span>:</span> <span>3171607</span><span>,</span>
  <span>"memory"</span><span>:</span> <span>475136</span><span>,</span>
  <span>"runTime"</span><span>:</span> <span>110396333</span><span>,</span>
  <span>"files"</span><span>:</span> <span>{</span>
    <span>"stderr"</span><span>:</span> <span>""</span><span>,</span>
    <span>"stdout"</span><span>:</span> <span>"23\n"</span>
  <span>}</span>
<span>}</span><span>]</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h4 id="特殊判题"> 特殊判题</h4>
<p>3.1 请求的url为</p>
<blockquote>
<p><code>http://localhost:5050/run</code></p>
</blockquote>
<p>3.2 请求方式</p>
<blockquote>
<p>POST</p>
</blockquote>
<p>3.3 请求参数</p>
<blockquote>
<p>数据格式为json，内容如下</p>
</blockquote>
<div><pre><code>   <span>{</span>
<span>"pipeMapping"</span><span>:</span> <span>[</span>
    <span>{</span>
        <span>"in"</span><span>:</span> <span>{</span>
            <span>"max"</span><span>:</span> <span>16777216</span><span>,</span>
            <span>"index"</span><span>:</span> <span>0</span><span>,</span>
            <span>"fd"</span><span>:</span> <span>1</span>
        <span>}</span><span>,</span>
        <span>"out"</span><span>:</span> <span>{</span>
            <span>"index"</span><span>:</span> <span>1</span><span>,</span>
            <span>"fd"</span><span>:</span> <span>0</span>
        <span>}</span>
    <span>}</span>
<span>]</span><span>,</span>
<span>"cmd"</span><span>:</span> <span>[</span>
    <span>{</span>
        <span>"stackLimit"</span><span>:</span> <span>134217728</span><span>,</span>
        <span>"cpuLimit"</span><span>:</span> <span>3000000000</span><span>,</span>
        <span>"realCpuLimit"</span><span>:</span> <span>9000000000</span><span>,</span>
        <span>"clockLimit"</span><span>:</span> <span>64</span><span>,</span>
        <span>"env"</span><span>:</span> <span>[</span>
            <span>"LANG=en_US.UTF-8"</span><span>,</span>
            <span>"LANGUAGE=en_US:en"</span><span>,</span>
            <span>"LC_ALL=en_US.UTF-8"</span><span>,</span>
            <span>"PYTHONIOENCODING=utf-8"</span>
        <span>]</span><span>,</span>
        <span>"copyOut"</span><span>:</span> <span>[</span>
            <span>"stderr"</span>
        <span>]</span><span>,</span>
        <span>"args"</span><span>:</span> <span>[</span>
            <span>"/usr/bin/python3"</span><span>,</span>
            <span>"main"</span>
        <span>]</span><span>,</span>
        <span>"files"</span><span>:</span> <span>[</span>
            <span>{</span>
                <span>"src"</span><span>:</span> <span>"/judge/test_case/problem_1002/5.in"</span>
            <span>}</span><span>,</span>
            <span>null</span><span>,</span>
            <span>{</span>
                <span>"max"</span><span>:</span> <span>16777216</span><span>,</span>
                <span>"name"</span><span>:</span> <span>"stderr"</span>
            <span>}</span>
        <span>]</span><span>,</span>
        <span>"memoryLimit"</span><span>:</span> <span>536870912</span><span>,</span>
        <span>"copyIn"</span><span>:</span> <span>{</span>
            <span>"main"</span><span>:</span> <span>{</span>
                <span>"fileId"</span><span>:</span> <span>"CGTRDEMKW5VAYN6O"</span>
            <span>}</span>
        <span>}</span>
    <span>}</span><span>,</span>
    <span>{</span>
        <span>"stackLimit"</span><span>:</span> <span>134217728</span><span>,</span>
        <span>"cpuLimit"</span><span>:</span> <span>8000000000</span><span>,</span>
        <span>"clockLimit"</span><span>:</span> <span>24000000000</span><span>,</span>
        <span>"env"</span><span>:</span> <span>[</span>
            <span>"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span><span>,</span>
            <span>"LANG=en_US.UTF-8"</span><span>,</span>
            <span>"LANGUAGE=en_US:en"</span><span>,</span>
            <span>"LC_ALL=en_US.UTF-8"</span>
        <span>]</span><span>,</span>
        <span>"copyOut"</span><span>:</span> <span>[</span>
            <span>"stdout"</span><span>,</span>
            <span>"stderr"</span>
        <span>]</span><span>,</span>
        <span>"args"</span><span>:</span> <span>[</span>
            <span>"/w/spj"</span><span>,</span>
            <span>"/w/tmp"</span>
        <span>]</span><span>,</span>
        <span>"files"</span><span>:</span> <span>[</span>
            <span>null</span><span>,</span>
            <span>{</span>
                <span>"max"</span><span>:</span> <span>16777216</span><span>,</span>
                <span>"name"</span><span>:</span> <span>"stdout"</span>
            <span>}</span><span>,</span>
            <span>{</span>
                <span>"max"</span><span>:</span> <span>16777216</span><span>,</span>
                <span>"name"</span><span>:</span> <span>"stderr"</span>
            <span>}</span>
        <span>]</span><span>,</span>
        <span>"memoryLimit"</span><span>:</span> <span>536870912</span><span>,</span>
        <span>"copyIn"</span><span>:</span> <span>{</span>
            <span>"spj"</span><span>:</span> <span>{</span>
                <span>"src"</span><span>:</span> <span>"/judge/spj/1002/spj"</span>
            <span>}</span><span>,</span>
            <span>"tmp"</span><span>:</span> <span>{</span>
                <span>"src"</span><span>:</span> <span>"/judge/test_case/problem_1002/5.out"</span>
            <span>}</span>
        <span>}</span><span>,</span>
        <span>"procLimit"</span><span>:</span> <span>64</span>
    <span>}</span>
<span>]</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br><span>64</span><br><span>65</span><br><span>66</span><br><span>67</span><br><span>68</span><br><span>69</span><br><span>70</span><br><span>71</span><br><span>72</span><br><span>73</span><br><span>74</span><br><span>75</span><br><span>76</span><br><span>77</span><br><span>78</span><br><span>79</span><br><span>80</span><br><span>81</span><br><span>82</span><br><span>83</span><br><span>84</span><br><span>85</span><br><span>86</span><br><span>87</span><br><span>88</span><br><span>89</span><br><span>90</span><br><span>91</span><br></div></div><p>3.4 返回的数据为json格式</p>
<div><pre><code><span>[</span>
    <span>{</span>
        <span>"status"</span><span>:</span> <span>"Accepted"</span><span>,</span>
        <span>"exitStatus"</span><span>:</span> <span>0</span><span>,</span>
        <span>"time"</span><span>:</span> <span>1545123</span><span>,</span>
        <span>"memory"</span><span>:</span> <span>253952</span><span>,</span>
        <span>"runTime"</span><span>:</span> <span>4148800</span><span>,</span>
        <span>"files"</span><span>:</span> <span>{</span>
            <span>"stderr"</span><span>:</span> <span>""</span>
        <span>}</span><span>,</span>
        <span>"fileIds"</span><span>:</span> <span>{</span><span>}</span>
    <span>}</span><span>,</span>
    <span>{</span>
        <span>"status"</span><span>:</span> <span>"Accepted"</span><span>,</span>
        <span>"exitStatus"</span><span>:</span> <span>0</span><span>,</span>
        <span>"time"</span><span>:</span> <span>1501463</span><span>,</span>
        <span>"memory"</span><span>:</span> <span>253952</span><span>,</span>
        <span>"runTime"</span><span>:</span> <span>5897700</span><span>,</span>
        <span>"files"</span><span>:</span> <span>{</span>
            <span>"stderr"</span><span>:</span> <span>""</span><span>,</span>
            <span>"stdout"</span><span>:</span> <span>""</span>
        <span>}</span><span>,</span>
        <span>"fileIds"</span><span>:</span> <span>{</span><span>}</span>
    <span>}</span>
<span>]</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br></div></div>]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-05-23T14:43:06.000Z</published>
  </entry>
  <entry>
    <title type="html">数据库说明</title>
    <id>https://hcode.top/docs/develop/db/</id>
    <link href="https://hcode.top/docs/develop/db/"/>
    <updated>2021-11-24T12:03:14.000Z</updated>
    <content type="html"><![CDATA[<h1 id="数据库说明"> 数据库说明</h1>
<h2 id="用户资料模块"> 用户资料模块</h2>
<p>user_info表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>uuid</td>
<td>String</td>
<td>主键</td>
<td>uuid用户id</td>
</tr>
<tr>
<td>username</td>
<td>String</td>
<td></td>
<td>登录账号</td>
</tr>
<tr>
<td>password</td>
<td>String</td>
<td></td>
<td>登录密码</td>
</tr>
<tr>
<td>nickname</td>
<td>String</td>
<td></td>
<td>用户昵称</td>
</tr>
<tr>
<td>school</td>
<td>String</td>
<td></td>
<td>学校</td>
</tr>
<tr>
<td>course</td>
<td>String</td>
<td></td>
<td>专业</td>
</tr>
<tr>
<td>number</td>
<td>String</td>
<td></td>
<td>学号</td>
</tr>
<tr>
<td>realname</td>
<td>String</td>
<td></td>
<td>真实名字</td>
</tr>
<tr>
<td>email</td>
<td>String</td>
<td></td>
<td>邮箱</td>
</tr>
<tr>
<td>gender</td>
<td>String</td>
<td></td>
<td>性别</td>
</tr>
<tr>
<td>avatar</td>
<td>String</td>
<td></td>
<td>头像图片地址</td>
</tr>
<tr>
<td>signature</td>
<td>String</td>
<td></td>
<td>个性签名</td>
</tr>
<tr>
<td>cf_username</td>
<td>String</td>
<td></td>
<td>codeforces的username</td>
</tr>
<tr>
<td>blog</td>
<td>String</td>
<td></td>
<td>博客地址</td>
</tr>
<tr>
<td>github</td>
<td>String</td>
<td></td>
<td>github地址</td>
</tr>
<tr>
<td>title_name</td>
<td>String</td>
<td></td>
<td>称号、头衔</td>
</tr>
<tr>
<td>title_color</td>
<td>String</td>
<td></td>
<td>称号、头衔的背景颜色</td>
</tr>
<tr>
<td>status</td>
<td>int</td>
<td></td>
<td>0可用，1不可用</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>session表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>uid</td>
<td>String</td>
<td>外键</td>
<td>用户id</td>
</tr>
<tr>
<td>user_agent</td>
<td>String</td>
<td></td>
<td>访问的浏览器参数</td>
</tr>
<tr>
<td>ip</td>
<td>Srting</td>
<td></td>
<td>访问所在的ip</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>role 角色表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>role</td>
<td>String</td>
<td></td>
<td>“admin”，”tourist”，“user”</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td></td>
<td>角色描述</td>
</tr>
<tr>
<td>status</td>
<td>int</td>
<td></td>
<td>是否可用,0可用 1不可用</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>user_role表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>uid</td>
<td>String</td>
<td>外键</td>
<td>用户id</td>
</tr>
<tr>
<td>role_id</td>
<td>int</td>
<td>外键</td>
<td>角色id</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>auth权限表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td></td>
<td>权限名称，“superadmin”,”contest”，“admin”,”common”  普通用户默认为“common”</td>
</tr>
<tr>
<td>permission</td>
<td>String</td>
<td></td>
<td>权限字符串,例如“contest:1001”，发布某场比赛。  “all”,”select”,”update”等等，</td>
</tr>
<tr>
<td>status</td>
<td>int</td>
<td></td>
<td>0可用，1不可用</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>role_auth表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>role_id</td>
<td>int</td>
<td></td>
<td>角色id</td>
</tr>
<tr>
<td>auth_id</td>
<td>int</td>
<td></td>
<td>权限id</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>user_record表 个人做题记录表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>primary key</td>
<td>auto_increment</td>
</tr>
<tr>
<td>uid</td>
<td>String</td>
<td>外键</td>
<td>用户id</td>
</tr>
<tr>
<td>rating</td>
<td>int</td>
<td></td>
<td>Cf得分，未参加过默认为1500</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>user_acproblem表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>primary key</td>
<td>auto_increment</td>
</tr>
<tr>
<td>uid</td>
<td>String</td>
<td>外键</td>
<td>用户id</td>
</tr>
<tr>
<td>pid</td>
<td>long</td>
<td>外键</td>
<td>Ac的题目id</td>
</tr>
<tr>
<td>subimit_id</td>
<td>long</td>
<td>外键</td>
<td>提交的id</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<h2 id="题目详情模块"> 题目详情模块</h2>
<p>problem表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>primary key</td>
<td>auto_increment 1000开始</td>
</tr>
<tr>
<td>problem_id</td>
<td>String</td>
<td></td>
<td>题目展示id</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td></td>
<td>题目标题</td>
</tr>
<tr>
<td>author</td>
<td>String</td>
<td></td>
<td>默认可为无</td>
</tr>
<tr>
<td>type</td>
<td>int</td>
<td></td>
<td>题目类型 0为ACM,1为OI</td>
</tr>
<tr>
<td>time_limit</td>
<td>int</td>
<td></td>
<td>时间限制(ms)，默认为c/c++限制,其它语言为2倍</td>
</tr>
<tr>
<td>memory_limit</td>
<td>int</td>
<td></td>
<td>空间限制(mb)，默认为c/c++限制,其它语言为2倍</td>
</tr>
<tr>
<td>stack_limit</td>
<td>int</td>
<td></td>
<td>栈限制(mb)，默认为128</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td></td>
<td>内容描述</td>
</tr>
<tr>
<td>input</td>
<td>String</td>
<td></td>
<td>输入描述</td>
</tr>
<tr>
<td>output</td>
<td>String</td>
<td></td>
<td>输出描述</td>
</tr>
<tr>
<td>examples</td>
<td>Srting</td>
<td></td>
<td>题面输入输出样例，不纳入评测数据</td>
</tr>
<tr>
<td>source</td>
<td>int</td>
<td></td>
<td>题目来源（比赛id），默认为hoj,可能为爬虫vj</td>
</tr>
<tr>
<td>difficulty</td>
<td>int</td>
<td></td>
<td>题目难度，0简单，1中等，2困难</td>
</tr>
<tr>
<td>hint</td>
<td>String</td>
<td></td>
<td>备注 提醒</td>
</tr>
<tr>
<td>auth</td>
<td>int</td>
<td></td>
<td>默认为1公开，2为私有，3为比赛中。</td>
</tr>
<tr>
<td>io_score</td>
<td>int</td>
<td></td>
<td>当该题目为io题目时的分数 默认为100</td>
</tr>
<tr>
<td>code_share</td>
<td>boolean</td>
<td></td>
<td>该题目对应的相关提交代码，用户是否可用分享</td>
</tr>
<tr>
<td>spj_code</td>
<td>String</td>
<td></td>
<td>特判程序代码 空代表非特判</td>
</tr>
<tr>
<td>spj_language</td>
<td>String</td>
<td></td>
<td>特判程序的语言</td>
</tr>
<tr>
<td>is_remove_end_blank</td>
<td>boolean</td>
<td></td>
<td>是否默认去除用户代码的文末空格</td>
</tr>
<tr>
<td>open_case_result</td>
<td>boolean</td>
<td></td>
<td>是否默认开启该题目的测试样例结果查看</td>
</tr>
<tr>
<td>caseVersion</td>
<td>String</td>
<td></td>
<td>题目测试数据的版本号</td>
</tr>
<tr>
<td>is_upload_case</td>
<td>boolean</td>
<td></td>
<td>是否是上传zip评测数据的</td>
</tr>
<tr>
<td>modified_user</td>
<td>String</td>
<td></td>
<td>最新修改题目的用户</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>problem_case表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>primary key</td>
<td>auto_increment</td>
</tr>
<tr>
<td>pid</td>
<td>long</td>
<td>外键</td>
<td>题目id</td>
</tr>
<tr>
<td>input</td>
<td>String</td>
<td></td>
<td>测试样例的输入文件名</td>
</tr>
<tr>
<td>output</td>
<td>String</td>
<td></td>
<td>测试样例的输出文件名</td>
</tr>
<tr>
<td>status</td>
<td>String</td>
<td></td>
<td>状态0可用，1不可用</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>tag表  题目表的标签</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td></td>
<td>标签名字</td>
</tr>
<tr>
<td>color</td>
<td>String</td>
<td></td>
<td>标签颜色</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>problem_tag表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td></td>
<td>主键id</td>
</tr>
<tr>
<td>tid</td>
<td>int</td>
<td></td>
<td>标签id</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>language表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td></td>
<td>主键id</td>
</tr>
<tr>
<td>content_type</td>
<td>String</td>
<td></td>
<td>语言类型</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td></td>
<td>语言描述</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td></td>
<td>语言名字</td>
</tr>
<tr>
<td>compile_command</td>
<td>String</td>
<td></td>
<td>编译指令</td>
</tr>
<tr>
<td>template</td>
<td>String</td>
<td></td>
<td>A+B题目模板</td>
</tr>
<tr>
<td>code_template</td>
<td>String</td>
<td></td>
<td>语言对应的代码模板</td>
</tr>
<tr>
<td>is_spj</td>
<td>boolean</td>
<td></td>
<td>是否可作为特殊判题的一种语言</td>
</tr>
<tr>
<td>oj</td>
<td>String</td>
<td></td>
<td>该语言属于哪个oj，自身oj用ME</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>code_template表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td></td>
<td>主键id</td>
</tr>
<tr>
<td>pid</td>
<td>long</td>
<td>外键</td>
<td>题目id</td>
</tr>
<tr>
<td>lid</td>
<td>long</td>
<td>外键</td>
<td>语言id</td>
</tr>
<tr>
<td>code</td>
<td>String</td>
<td></td>
<td>代码模板</td>
</tr>
<tr>
<td>status</td>
<td>boolean</td>
<td></td>
<td>是否启用</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<h2 id="提交评测模块"> 提交评测模块</h2>
<blockquote>
<p>判题结果status</p>
</blockquote>
<p>未提交：STATUS_NOT_SUBMITTED = -10</p>
<p>提交中：STATUS_SUBMITTING = 9</p>
<p>排队中：STATUS_PENDING  =  6</p>
<p>评测中：STATUS_JUDGING =  7</p>
<p>编译错误：STATUS_COMPILE_ERROR = -2</p>
<p>输出格式错误：STATUS_PRESENTATION_ERROR = -3</p>
<p>答案错误：STATUS__WRONG_ANSWER = -1</p>
<p>评测通过：STATUS_ACCEPTED = 0</p>
<p>cpu时间超限：STATUS__CPU_TIME_LIMIT_EXCEEDED = 1</p>
<p>真实时间超限：STATUS__REAL_TIME_LIMIT_EXCEEDED = 2</p>
<p>空间超限：STATUS__MEMORY_LIMIT_EXCEEDED = 3</p>
<p>运行错误：STATUS__RUNTIME_ERROR = 4</p>
<p>系统错误：STATUS__SYSTEM_ERROR = 5</p>
<p>OI评测部分通过：STATUS_PARTIAL_ACCEPTED = 8</p>
<p>提交失败：STATUS_SUBMITTED_FAILED= 10</p>
<p>judge表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>submit_id</td>
<td>long</td>
<td>primary key</td>
<td>auto_increment</td>
</tr>
<tr>
<td>display_pid</td>
<td>String</td>
<td></td>
<td>题目展示id</td>
</tr>
<tr>
<td>pid</td>
<td>long</td>
<td>外键</td>
<td>题目id</td>
</tr>
<tr>
<td>uid</td>
<td>String</td>
<td>外键</td>
<td>提交用户的id</td>
</tr>
<tr>
<td>username</td>
<td>String</td>
<td>外键</td>
<td>用户名</td>
</tr>
<tr>
<td>submit_time</td>
<td>datetime</td>
<td></td>
<td>提交时间</td>
</tr>
<tr>
<td>status</td>
<td>String</td>
<td></td>
<td>判题结果</td>
</tr>
<tr>
<td>share</td>
<td>Boolean</td>
<td></td>
<td>代码是否分享</td>
</tr>
<tr>
<td>error_message</td>
<td>String</td>
<td></td>
<td>错误提醒（编译错误，或者vj提醒）</td>
</tr>
<tr>
<td>time</td>
<td>int</td>
<td></td>
<td>运行时间</td>
</tr>
<tr>
<td>memory</td>
<td>int</td>
<td></td>
<td>所耗内存</td>
</tr>
<tr>
<td>length</td>
<td>int</td>
<td></td>
<td>代码长度</td>
</tr>
<tr>
<td>code</td>
<td>String</td>
<td></td>
<td>代码</td>
</tr>
<tr>
<td>language</td>
<td>String</td>
<td></td>
<td>代码语言</td>
</tr>
<tr>
<td>cpid</td>
<td>int</td>
<td></td>
<td>比赛中的题目编号id</td>
</tr>
<tr>
<td>judger</td>
<td>String</td>
<td></td>
<td>判题机ip</td>
</tr>
<tr>
<td>ip</td>
<td>String</td>
<td></td>
<td>提交者ip</td>
</tr>
<tr>
<td>cid</td>
<td>int</td>
<td></td>
<td>题目来源的比赛id，默认为0</td>
</tr>
<tr>
<td>version</td>
<td>int</td>
<td></td>
<td>乐观锁（废弃）</td>
</tr>
<tr>
<td>oi_rank_score</td>
<td>int</td>
<td></td>
<td>oi排行榜得分</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>jugde_case表 评测单个样例结果表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>submit_id</td>
<td>long</td>
<td>外键</td>
<td>提交id</td>
</tr>
<tr>
<td>problemId</td>
<td>String</td>
<td>外键</td>
<td>题目id</td>
</tr>
<tr>
<td>userId</td>
<td>String</td>
<td>外键</td>
<td>提交用户的id</td>
</tr>
<tr>
<td>Status</td>
<td>String</td>
<td></td>
<td>单个样例评测结果</td>
</tr>
<tr>
<td>time</td>
<td>int</td>
<td></td>
<td>运行时间</td>
</tr>
<tr>
<td>memory</td>
<td>int</td>
<td></td>
<td>运行内存</td>
</tr>
<tr>
<td>case_id</td>
<td>String</td>
<td></td>
<td>测试样例id</td>
</tr>
<tr>
<td>input_data</td>
<td>String</td>
<td></td>
<td>样例输入的文件名</td>
</tr>
<tr>
<td>Output_data</td>
<td>String</td>
<td></td>
<td>样例输出的文件名</td>
</tr>
<tr>
<td>user_output</td>
<td>Srting</td>
<td></td>
<td>暂时用作信息提示</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<h2 id="比赛模块"> 比赛模块</h2>
<p>更新比赛状态的存储过程</p>
<div><pre><code><span>DELIMITER</span> <span>|</span>

<span>DROP</span> <span>PROCEDURE</span> <span>IF</span> <span>EXISTS</span> contest_status <span>|</span>
<span>CREATE</span> <span>PROCEDURE</span> contest_status<span>(</span><span>)</span>

   <span>BEGIN</span>
     <span>UPDATE</span> contest 
   <span>SET</span> <span>STATUS</span> <span>=</span> <span>(</span>
   <span>CASE</span> 
     <span>WHEN</span> <span>NOW</span><span>(</span><span>)</span> <span>&lt;</span> start_time <span>THEN</span> <span>-</span><span>1</span> 
     <span>WHEN</span> <span>NOW</span><span>(</span><span>)</span> <span>>=</span> start_time <span>AND</span> <span>NOW</span><span>(</span><span>)</span><span>&lt;</span>end_time <span>THEN</span>  <span>0</span>
     <span>WHEN</span> <span>NOW</span><span>(</span><span>)</span> <span>>=</span> end_time <span>THEN</span> <span>1</span>
   <span>END</span><span>)</span><span>;</span>
   <span>END</span>
<span>|</span>

</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br></div></div><p>创建插入时的触发器</p>
<div><pre><code><span>DROP</span> <span>TRIGGER</span> <span>IF</span> <span>EXISTS</span> contest_trigger<span>;</span>

<span>DELIMITER</span> $$
<span>CREATE</span> <span>TRIGGER</span> contest_trigger
BEFORE <span>INSERT</span> <span>ON</span> contest <span>FOR EACH ROW</span>
<span>BEGIN</span>
<span>SET</span> new<span>.</span><span>status</span><span>=</span><span>(</span>
	<span>CASE</span> 
	  <span>WHEN</span> <span>NOW</span><span>(</span><span>)</span> <span>&lt;</span> new<span>.</span>start_time <span>THEN</span> <span>-</span><span>1</span> 
	  <span>WHEN</span> <span>NOW</span><span>(</span><span>)</span> <span>>=</span> new<span>.</span>start_time <span>AND</span> <span>NOW</span><span>(</span><span>)</span><span>&lt;</span>new<span>.</span>end_time <span>THEN</span>  <span>0</span>
	  <span>WHEN</span> <span>NOW</span><span>(</span><span>)</span> <span>>=</span> new<span>.</span>end_time <span>THEN</span> <span>1</span>
	<span>END</span><span>)</span><span>;</span>
<span>END</span>$$
<span>DELIMITER</span> <span>;</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><p>设置定时器</p>
<div><pre><code><span>SET</span> <span>GLOBAL</span> event_scheduler <span>=</span> <span>1</span><span>;</span>  <span>// 开启定时器</span>
<span>CREATE</span> EVENT <span>IF</span> <span>NOT</span> <span>EXISTS</span> contest_event

<span>ON</span> SCHEDULE EVERY <span>1</span> <span>SECOND</span> <span>// 每秒执行一次</span>

<span>ON</span> COMPLETION PRESERVE  

<span>DO</span> <span>CALL</span> contest_status<span>(</span><span>)</span><span>;</span> <span>// 调用存储过程</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div><p>开启或关闭定时器</p>
<div><pre><code><span>ALTER</span> EVENT contest_event <span>ON</span>  COMPLETION PRESERVE <span>ENABLE</span><span>;</span>   <span>-- 开启事件</span>
<span>ALTER</span> EVENT contest_event <span>ON</span>  COMPLETION PRESERVE <span>DISABLE</span><span>;</span>  <span>-- 关闭事件</span>
</code></pre>
<div><span>1</span><br><span>2</span><br></div></div><p>contest表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment  1000起步</td>
</tr>
<tr>
<td>uid</td>
<td>String</td>
<td>外键</td>
<td>创建者id</td>
</tr>
<tr>
<td>author</td>
<td>String</td>
<td></td>
<td>比赛创建者的用户名</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td></td>
<td>比赛标题</td>
</tr>
<tr>
<td>type</td>
<td>int</td>
<td></td>
<td>Acm赛制或者Rating</td>
</tr>
<tr>
<td>source</td>
<td>int</td>
<td></td>
<td>比赛来源，原创为0，克隆赛为比赛id</td>
</tr>
<tr>
<td>auth</td>
<td>int</td>
<td></td>
<td>0为公开赛，1为私有赛（有密码），3为保护赛（有密码）。</td>
</tr>
<tr>
<td>pwd</td>
<td>string</td>
<td></td>
<td>比赛密码</td>
</tr>
<tr>
<td>start_time</td>
<td>datetime</td>
<td></td>
<td>开始时间</td>
</tr>
<tr>
<td>end_time</td>
<td>datetime</td>
<td></td>
<td>结束时间</td>
</tr>
<tr>
<td>duration</td>
<td>long</td>
<td></td>
<td>比赛时长（s）</td>
</tr>
<tr>
<td>description</td>
<td>Srting</td>
<td></td>
<td>比赛说明</td>
</tr>
<tr>
<td>seal_rank</td>
<td>boolean</td>
<td></td>
<td>是否开启封榜</td>
</tr>
<tr>
<td>seal_rank_time</td>
<td>datetime</td>
<td></td>
<td>封榜起始时间，一直到比赛结束，不刷新榜单。</td>
</tr>
<tr>
<td>status</td>
<td>int</td>
<td></td>
<td>-1为未开始，0为进行中，1为已结束</td>
</tr>
<tr>
<td>visible</td>
<td>boolean</td>
<td></td>
<td>是否可见</td>
</tr>
<tr>
<td>open_print</td>
<td>boolean</td>
<td></td>
<td>是否打开打印功能</td>
</tr>
<tr>
<td>open_account_limit</td>
<td>boolean</td>
<td></td>
<td>是否开启账号限制</td>
</tr>
<tr>
<td>account_limit_rule</td>
<td>String</td>
<td></td>
<td>账号限制规则</td>
</tr>
<tr>
<td>rank_show_name</td>
<td>String</td>
<td></td>
<td>排行榜显示（username、nickname、realname）</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>contest_problem表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>display_id</td>
<td>String</td>
<td></td>
<td>展示的id</td>
</tr>
<tr>
<td>cid</td>
<td>long</td>
<td>外键</td>
<td>比赛id</td>
</tr>
<tr>
<td>pid</td>
<td>long</td>
<td>外键</td>
<td>题目id</td>
</tr>
<tr>
<td>display_title</td>
<td>String</td>
<td></td>
<td>该题目在比赛中的标题，默认为原名字</td>
</tr>
<tr>
<td>color</td>
<td>String</td>
<td></td>
<td>气球颜色，不设置则不显示</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>contest_register表 比赛报名表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>cid</td>
<td>long</td>
<td>外键</td>
<td>比赛id</td>
</tr>
<tr>
<td>uid</td>
<td>String</td>
<td>外键</td>
<td>用户id</td>
</tr>
<tr>
<td>status</td>
<td>int</td>
<td></td>
<td>默认为0表示正常，1为失效。</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>contest_score表 rating赛制中获得的分数更改记录表（未使用）</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>cid</td>
<td>long</td>
<td>外键</td>
<td>比赛id</td>
</tr>
<tr>
<td>last</td>
<td>int</td>
<td></td>
<td>比赛前的score得分</td>
</tr>
<tr>
<td>change</td>
<td>int</td>
<td></td>
<td>Score比分变化</td>
</tr>
<tr>
<td>now</td>
<td>int</td>
<td></td>
<td>现在的score</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>contest_record表 比赛记录表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>cid</td>
<td>long</td>
<td>外键</td>
<td>比赛id</td>
</tr>
<tr>
<td>uid</td>
<td>String</td>
<td>外键</td>
<td>用户id</td>
</tr>
<tr>
<td>pid</td>
<td>int</td>
<td>外键</td>
<td>题目id</td>
</tr>
<tr>
<td>cpid</td>
<td>int</td>
<td>外键</td>
<td>比赛中的题目id</td>
</tr>
<tr>
<td>submit_id</td>
<td>int</td>
<td>外键</td>
<td>提交id，用于可重判</td>
</tr>
<tr>
<td>display_id</td>
<td>String</td>
<td></td>
<td>比赛展示的id</td>
</tr>
<tr>
<td>username</td>
<td>String</td>
<td></td>
<td>用户名</td>
</tr>
<tr>
<td>realname</td>
<td>String</td>
<td></td>
<td>真实姓名（废弃）</td>
</tr>
<tr>
<td>status</td>
<td>int</td>
<td></td>
<td>提交结果，0表示未AC通过不罚时，1表示AC通过，-1为未AC通过算罚时</td>
</tr>
<tr>
<td>submit_time</td>
<td>datetime</td>
<td></td>
<td>具体提交时间</td>
</tr>
<tr>
<td>time</td>
<td>int</td>
<td></td>
<td>提交时间，为提交时间减去比赛时间，时间戳</td>
</tr>
<tr>
<td>score</td>
<td>int</td>
<td></td>
<td>OI比赛得分</td>
</tr>
<tr>
<td>use_time</td>
<td>int</td>
<td></td>
<td>提交的程序运行耗时</td>
</tr>
<tr>
<td>first_blood</td>
<td>Boolean</td>
<td></td>
<td>是否为一血AC（废弃）</td>
</tr>
<tr>
<td>checked</td>
<td>Boolean</td>
<td></td>
<td>AC是否已校验</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>contest_print表 比赛打印表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>cid</td>
<td>long</td>
<td>外键</td>
<td>比赛id</td>
</tr>
<tr>
<td>username</td>
<td>String</td>
<td></td>
<td>提交打印文本的用户</td>
</tr>
<tr>
<td>realname</td>
<td>String</td>
<td></td>
<td>真实姓名</td>
</tr>
<tr>
<td>content</td>
<td>String</td>
<td></td>
<td>需要打印的文本内容</td>
</tr>
<tr>
<td>status</td>
<td>int</td>
<td></td>
<td>状态 是否已打印</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>announcement表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td></td>
<td>公告标题</td>
</tr>
<tr>
<td>content</td>
<td>String</td>
<td></td>
<td>公告内容</td>
</tr>
<tr>
<td>uid</td>
<td>String</td>
<td>外键</td>
<td>发布者id（必须为比赛创建者或者超级管理员才能）</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>contest_announcement表 比赛时的通知表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>aid</td>
<td>long</td>
<td>外键</td>
<td>公告id</td>
</tr>
<tr>
<td>cid</td>
<td>int</td>
<td>外键</td>
<td>比赛id</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>contest_explanation表 赛后题解表**(未使用)**</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>cid</td>
<td>int</td>
<td>外键</td>
<td>比赛id</td>
</tr>
<tr>
<td>content</td>
<td>String</td>
<td></td>
<td>内容(支持markdown)</td>
</tr>
<tr>
<td>uid</td>
<td>int</td>
<td></td>
<td>发布者（必须为比赛创建者或者超级管理员才能）</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>##训练(题单)模块</p>
<p>题单训练表 training</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td></td>
</tr>
<tr>
<td>title</td>
<td>string</td>
<td></td>
<td>训练题单名称</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td></td>
<td>训练题单简介</td>
</tr>
<tr>
<td>author</td>
<td>string</td>
<td>外键</td>
<td>训练题单创建者用户名</td>
</tr>
<tr>
<td>auth</td>
<td>string</td>
<td></td>
<td>训练题单权限类型：Public、Private</td>
</tr>
<tr>
<td>private_pwd</td>
<td>string</td>
<td></td>
<td>训练题单权限为Private时的密码</td>
</tr>
<tr>
<td>rank</td>
<td>int</td>
<td></td>
<td>编号，升序</td>
</tr>
<tr>
<td>status</td>
<td>boolean</td>
<td></td>
<td>是否可用</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>训练注册表 training_register</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td></td>
</tr>
<tr>
<td>tid</td>
<td>long</td>
<td>外键</td>
<td>训练id</td>
</tr>
<tr>
<td>uid</td>
<td>long</td>
<td>外键</td>
<td>用户id</td>
</tr>
<tr>
<td>status</td>
<td>boolean</td>
<td></td>
<td>是否可用</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>训练与题目关联表 training_problem</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td></td>
</tr>
<tr>
<td>tid</td>
<td>long</td>
<td>外键</td>
<td>训练id</td>
</tr>
<tr>
<td>pid</td>
<td>long</td>
<td>外键</td>
<td>题目id</td>
</tr>
<tr>
<td>display_id</td>
<td>string</td>
<td></td>
<td>排序用 展示id</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>训练记录表 training_record</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td></td>
</tr>
<tr>
<td>tid</td>
<td>long</td>
<td>外键</td>
<td>训练id</td>
</tr>
<tr>
<td>tpid</td>
<td>long</td>
<td>外键</td>
<td>训练题目id</td>
</tr>
<tr>
<td>pid</td>
<td>long</td>
<td>外键</td>
<td>题目id</td>
</tr>
<tr>
<td>uid</td>
<td>string</td>
<td>外键</td>
<td>用户id</td>
</tr>
<tr>
<td>submit_id</td>
<td>long</td>
<td>外键</td>
<td>提交id</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>训练分类表 training_category</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td></td>
<td>分类名称</td>
</tr>
<tr>
<td>color</td>
<td>string</td>
<td></td>
<td>分类背景颜色</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>训练分类关联表 mapping_training_category</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td></td>
</tr>
<tr>
<td>tid</td>
<td>long</td>
<td>外键</td>
<td>训练id</td>
</tr>
<tr>
<td>cid</td>
<td>long</td>
<td>外键</td>
<td>训练分类id（training_category）</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<h2 id="讨论模块"> 讨论模块</h2>
<blockquote>
<p>包括题目讨论区，公共讨论区，比赛评论</p>
</blockquote>
<p>category表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td></td>
<td>分类名字</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>discussion表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>category_id</td>
<td>int</td>
<td>外键</td>
<td>分类id</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td>外键</td>
<td>讨论标题</td>
</tr>
<tr>
<td>content</td>
<td>String</td>
<td></td>
<td>讨论详情</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td></td>
<td>讨论描述</td>
</tr>
<tr>
<td>pid</td>
<td>String</td>
<td>外键</td>
<td>引用的题目id，默认未null则不引用</td>
</tr>
<tr>
<td>uid</td>
<td>iString</td>
<td>外键</td>
<td>发布讨论的用户id</td>
</tr>
<tr>
<td>author</td>
<td>String</td>
<td>外键</td>
<td>发布讨论的用户名</td>
</tr>
<tr>
<td>avatar</td>
<td>String</td>
<td>外键</td>
<td>发布讨论的用户头像地址</td>
</tr>
<tr>
<td>role</td>
<td>String</td>
<td></td>
<td>发布讨论的用户角色</td>
</tr>
<tr>
<td>view_num</td>
<td>int</td>
<td></td>
<td>浏览数量</td>
</tr>
<tr>
<td>like_num</td>
<td>int</td>
<td></td>
<td>点赞数量</td>
</tr>
<tr>
<td>top_priority</td>
<td>boolean</td>
<td></td>
<td>优先级，是否置顶</td>
</tr>
<tr>
<td>comment_num</td>
<td>int</td>
<td></td>
<td>评论数量</td>
</tr>
<tr>
<td>status</td>
<td>int</td>
<td></td>
<td>是否封禁或逻辑删除该讨论</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>discussion_like表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>did</td>
<td>int</td>
<td>外键</td>
<td>讨论id</td>
</tr>
<tr>
<td>uid</td>
<td>String</td>
<td>外键</td>
<td>用户id</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>discussion_report表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>did</td>
<td>int</td>
<td>外键</td>
<td>讨论id</td>
</tr>
<tr>
<td>reporter</td>
<td>String</td>
<td>外键</td>
<td>举报者的用户名</td>
</tr>
<tr>
<td>content</td>
<td>String</td>
<td></td>
<td>举报内容</td>
</tr>
<tr>
<td>status</td>
<td>boolean</td>
<td></td>
<td>是否已读</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>comment表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>cid</td>
<td>long</td>
<td>外键</td>
<td>比赛id，NULL表示无引用比赛</td>
</tr>
<tr>
<td>did</td>
<td>int</td>
<td>外键</td>
<td>讨论id，NULL表示无引用讨论</td>
</tr>
<tr>
<td>content</td>
<td>String</td>
<td></td>
<td>评论内容</td>
</tr>
<tr>
<td>from_uid</td>
<td>String</td>
<td>外键</td>
<td>评论者id</td>
</tr>
<tr>
<td>from_name</td>
<td>String</td>
<td>外键</td>
<td>评论者用户名</td>
</tr>
<tr>
<td>from_avatar</td>
<td>String</td>
<td>外键</td>
<td>评论者头像地址</td>
</tr>
<tr>
<td>from_role</td>
<td>String</td>
<td>外键</td>
<td>评论者角色</td>
</tr>
<tr>
<td>like_num</td>
<td>int</td>
<td></td>
<td>点赞数量</td>
</tr>
<tr>
<td>status</td>
<td>int</td>
<td></td>
<td>是否封禁或逻辑删除该评论，0正常，1封禁</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>comment_like表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>lint</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>cid</td>
<td>int</td>
<td>外键</td>
<td>评论id</td>
</tr>
<tr>
<td>uid</td>
<td>String</td>
<td>外键</td>
<td>用户id</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>reply表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>comment_id</td>
<td>ind</td>
<td>外键</td>
<td>评论id</td>
</tr>
<tr>
<td>content</td>
<td>String</td>
<td></td>
<td>回复的内容</td>
</tr>
<tr>
<td>from_uid</td>
<td>String</td>
<td>外键</td>
<td>回复评论者id</td>
</tr>
<tr>
<td>from_name</td>
<td>String</td>
<td>外键</td>
<td>回复评论者用户名</td>
</tr>
<tr>
<td>from_avatar</td>
<td>String</td>
<td>外键</td>
<td>回复评论者头像地址</td>
</tr>
<tr>
<td>from_role</td>
<td>String</td>
<td>外键</td>
<td>回复评论者角色</td>
</tr>
<tr>
<td>to_uid</td>
<td>String</td>
<td>外键</td>
<td>被回复的用户id</td>
</tr>
<tr>
<td>to_name</td>
<td>String</td>
<td>外键</td>
<td>被回复的用户名</td>
</tr>
<tr>
<td>to_avatar</td>
<td>String</td>
<td>外键</td>
<td>被回复的用户头像地址</td>
</tr>
<tr>
<td>status</td>
<td>int</td>
<td></td>
<td>是否封禁或逻辑删除该回复，0正常，1封禁</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<h2 id="站内消息模块"> 站内消息模块</h2>
<p>admin_sys_notice表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>title</td>
<td>String</td>
<td></td>
<td>通知标题</td>
</tr>
<tr>
<td>content</td>
<td>String</td>
<td></td>
<td>通知内容</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td></td>
<td>发给哪些用户类型,例如全部用户All，指定单个用户Single，管理员Admin</td>
</tr>
<tr>
<td>state</td>
<td>boolean</td>
<td></td>
<td>是否已被拉取过，如果已经拉取过，就无需再次拉取</td>
</tr>
<tr>
<td>recipient_id</td>
<td>String</td>
<td>外键</td>
<td>接受通知的用户的id，如果type为single，那么recipient 为该用户的id;否则recipient为null</td>
</tr>
<tr>
<td>admin_id</td>
<td>String</td>
<td>外键</td>
<td>发布通知的管理员id</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>user_sys_notice表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>sys_notice_id</td>
<td>long</td>
<td>外键</td>
<td>系统通知的id</td>
</tr>
<tr>
<td>recipient_id</td>
<td>String</td>
<td>外键</td>
<td>接受通知的用户的id</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td></td>
<td>消息类型，系统通知Sys、我的信息Mine</td>
</tr>
<tr>
<td>state</td>
<td>boolean</td>
<td></td>
<td>是否已读</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>msg_remind表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>action</td>
<td>String</td>
<td></td>
<td>动作类型，如点赞讨论帖Like_Post、点赞评论Like_Discuss、评论Discuss、回复Reply等</td>
</tr>
<tr>
<td>source_id</td>
<td>int</td>
<td></td>
<td>消息来源id，讨论id或比赛id</td>
</tr>
<tr>
<td>source_type</td>
<td>String</td>
<td></td>
<td>事件源类型：'Discussion'、'Contest'等</td>
</tr>
<tr>
<td>source_content</td>
<td>String</td>
<td></td>
<td>事件源的内容，比如回复的内容，回复的评论等等,不超过250字符，超过使用...</td>
</tr>
<tr>
<td>quote_id</td>
<td>int</td>
<td></td>
<td>事件引用上一级评论或回复id</td>
</tr>
<tr>
<td>quote_type</td>
<td>String</td>
<td></td>
<td>事件引用上一级的类型：Comment、Reply</td>
</tr>
<tr>
<td>url</td>
<td>String</td>
<td></td>
<td>事件所发生的地点链接 url</td>
</tr>
<tr>
<td>recipient_id</td>
<td>String</td>
<td>外键</td>
<td>接受通知的用户的id</td>
</tr>
<tr>
<td>sender_id</td>
<td>String</td>
<td>外键</td>
<td>动作执行者的id</td>
</tr>
<tr>
<td>state</td>
<td>boolean</td>
<td></td>
<td>是否已读</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<h2 id="文件模块"> 文件模块</h2>
<p>file表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>uid</td>
<td>String</td>
<td></td>
<td>用户id</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td></td>
<td>文件名</td>
</tr>
<tr>
<td>suffix</td>
<td>String</td>
<td></td>
<td>文件后缀格式</td>
</tr>
<tr>
<td>folder_path</td>
<td>String</td>
<td></td>
<td>文件所在文件夹的路径</td>
</tr>
<tr>
<td>file_path</td>
<td>String</td>
<td></td>
<td>文件绝对路径</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td></td>
<td>文件所属类型，例如avatar</td>
</tr>
<tr>
<td>delete</td>
<td>String</td>
<td></td>
<td>是否删除</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<h2 id="判题机模块"> 判题机模块</h2>
<p>judge_server表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td></td>
<td>判题服务名字</td>
</tr>
<tr>
<td>ip</td>
<td>String</td>
<td></td>
<td>判题机ip</td>
</tr>
<tr>
<td>port</td>
<td>int</td>
<td></td>
<td>判题机端口号</td>
</tr>
<tr>
<td>url</td>
<td>String</td>
<td></td>
<td>ip:port</td>
</tr>
<tr>
<td>cpu_core</td>
<td>int</td>
<td></td>
<td>判题机所在服务器cpu核心数</td>
</tr>
<tr>
<td>task_number</td>
<td>int</td>
<td></td>
<td>当前判题数</td>
</tr>
<tr>
<td>max_task_number</td>
<td>int</td>
<td></td>
<td>判题并发最大数</td>
</tr>
<tr>
<td>status</td>
<td>int</td>
<td></td>
<td>0可用，1不可用</td>
</tr>
<tr>
<td>version</td>
<td>long</td>
<td></td>
<td>版本控制</td>
</tr>
<tr>
<td>is_remote</td>
<td>boolean</td>
<td></td>
<td>是否为远程判题vj</td>
</tr>
<tr>
<td>cf_submittable</td>
<td>boolean</td>
<td></td>
<td>当前机器是否可提交cf，控制机器一次只能一账号交题</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<p>remote_judge_account表</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>实体属性类型</th>
<th>键</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td>主键</td>
<td>auto_increment</td>
</tr>
<tr>
<td>oj</td>
<td>String</td>
<td></td>
<td>vjudge交题的oj名字</td>
</tr>
<tr>
<td>username</td>
<td>String</td>
<td></td>
<td>vjudge登录的账号</td>
</tr>
<tr>
<td>password</td>
<td>int</td>
<td></td>
<td>vjudge登录的密码</td>
</tr>
<tr>
<td>status</td>
<td>int</td>
<td></td>
<td>0可用，1不可用</td>
</tr>
<tr>
<td>version</td>
<td>long</td>
<td></td>
<td>版本控制</td>
</tr>
<tr>
<td>gmt_create</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>gmt_modified</td>
<td>datetime</td>
<td></td>
<td>修改时间</td>
</tr>
</tbody>
</table>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-05-13T10:18:08.000Z</published>
  </entry>
  <entry>
    <title type="html">前言</title>
    <id>https://hcode.top/docs/introducition/</id>
    <link href="https://hcode.top/docs/introducition/"/>
    <updated>2021-12-12T11:51:55.000Z</updated>
    <content type="html"><![CDATA[<h1 id="前言"> 前言</h1>
<h2 id="一、什么是hoj"> 一、什么是HOJ？</h2>
<p>HOJ，全称 Hcode Online Judge，是基于（springcloud+vue）前后端分离，分布式架构的在线测评系统。</p>
<p><a href="http://openjdk.java.net/" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/Java-1.8-informational" alt="Java" /></a>
<a href="https://spring.io/projects/spring-boot" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/Spring Boot-2.2.6.RELEASE-success" alt="Spring Boot" /></a>
<a href="https://spring.io/projects/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/Spring Cloud Alibaba-2.2.1.RELEASE-success" alt="SpringCloud Alibaba" /></a>
<a href="https://www.mysql.com/" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/MySQL-8.0.19-blue" alt="MySQL" /></a>
<a href="https://redis.io/" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/Redis-5.0.9-red" alt="Redis" /></a>
<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/Nacos-1.4.2-%23267DF7" alt="Nacos" /></a>
<a href="https://cn.vuejs.org/" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/Vue-2.6.11-success" alt="Vue" /></a>
<a href="https://qm.qq.com/cgi-bin/qm/qr?k=WWGBZ5gfDiBZOcpNvM8xnZTfUq7BT4Rs&amp;jump_from=webapi" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/QQ Group-598587305-blue" alt="QQ Group 598587305" /></a></p>
<h2 id="二、为什么要开发hoj"> 二、为什么要开发HOJ？</h2>
<p>因为这是Himit_ZH的毕业设计，同时也是个人志趣所在，目前HOJ从开始开发到现在快有一年了，凭着兴趣与职责一直在不断维护与更新新功能。</p>
<h2 id="三、hoj的特点"> 三、HOJ的特点</h2>
<div><p>Tips</p>
<ul>
<li>适应：支持手机端，响应式布局</li>
<li>设计：界面简约大方</li>
<li>安全：判题使用 cgroup 隔离用户程序，杜绝卡评测；网站权限控制完善</li>
<li>扩展：支持分布式判题</li>
<li>简单：高度集中网站配置</li>
<li>功能：
<ul>
<li>支持ACM、OI题目及比赛，比赛拥有外榜、打星队伍、关注队伍等功能</li>
<li>拥有讨论区、题目讨论、比赛讨论、同时拥有站内消息系统</li>
<li>支持testlib的SPJ</li>
</ul>
</li>
<li>多样：支持自身题目数据评测，也支持其它知名OJ（HDU、Codeforces、POJ）题目的爬取与提交</li>
</ul>
</div>
<h2 id="四、使用hoj的学校"> 四、使用HOJ的学校</h2>
<p>主要是OI：首都师范大学附属中学...</p>
<p>主要是ACM：西南科技大学、长春理工大学、兰州大学...</p>
<h2 id="五、部分截图"> 五、部分截图</h2>
<div><p>Note</p>
<p><strong>以下截图页面均支持中英文国际化，点击底部的转换即可全网站转换，包括后台管理，同时浏览器会记住本次选择的语言</strong></p>
</div>
<blockquote>
<p>首页页面</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210609212151977.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzg1MzA5Nw==,size_16,color_FFFFFF,t_70" alt="首页" /></p>
<blockquote>
<p>首页英文</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210609213403198.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzg1MzA5Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" /></p>
<blockquote>
<p>站内消息系统</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/a1a83ff01be84406954537e2ab78d999.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="站内消息系统" /></p>
<p><img src="https://img-blog.csdnimg.cn/513e7e37f52f48518c2fa1bf14eeea99.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="站内消息系统" /></p>
<blockquote>
<p>题目列表页</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/de80b1573ea04195a45b65e0dc55a308.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="题目列表页" /></p>
<blockquote>
<p>题目详情页</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/655a9886cf7d4683812c923b9ce2aa2e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="题目详情页" /></p>
<blockquote>
<p>比赛列表页</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/2021060921255349.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzg1MzA5Nw==,size_16,color_FFFFFF,t_70" alt="比赛列表页" /></p>
<p><strong>比赛以西南科技大学某届新生赛截图为例</strong></p>
<blockquote>
<p>比赛详情首页</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/50026bde6dd64cd5929b38f8ecc6e72e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="比赛详情页" /></p>
<blockquote>
<p>比赛题目列表页</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/8646fc212b5c47e9b35e60634cfc8d6a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="比赛题目列表" /></p>
<blockquote>
<p>比赛排行榜</p>
</blockquote>
<ul>
<li>ACM比赛</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/c50140e3b73d482d82ca6f13f47aa080.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="比赛排行榜" /></p>
<ul>
<li>
<p>OI比赛</p>
<p><img src="https://img-blog.csdnimg.cn/67f6262854bb44efa70c374f1f156166.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="oi排行榜" /></p>
</li>
</ul>
<blockquote>
<p>提交列表页</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210609213021223.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzg1MzA5Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" /></p>
<blockquote>
<p>排行榜</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/407ad16361f34b44a282b07af68825e0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="排行榜" /></p>
<blockquote>
<p>公共讨论区</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210513134216723.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzg1MzA5Nw==,size_16,color_FFFFFF,t_70" alt="公共讨论区" /></p>
<blockquote>
<p>评论组件</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210513142826730.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzg1MzA5Nw==,size_16,color_FFFFFF,t_70#pic_center" alt="评论组件" /></p>
<blockquote>
<p>个人首页</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/3f9111cc0767466991ae3d99602b5865.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="个人首页" /></p>
<blockquote>
<p>个人设置页</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/971566eeac674d388b9f5d6064286e14.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="个人设置" /></p>
<blockquote>
<p>管理后台首页</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/9b9674c0f30a441bb200a32756f24d2c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="管理后端" /></p>
<blockquote>
<p>部分手机端显示</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/c7b3648217af4899bedf7f7d804968ba.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_12,color_FFFFFF,t_70,g_se,x_16" alt="手机端" /></p>
<p><img src="https://img-blog.csdnimg.cn/20210509233845230.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzg1MzA5Nw==,size_16,color_FFFFFF,t_70" alt="评论区" /></p>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-03-02T14:19:37.000Z</published>
  </entry>
  <entry>
    <title type="html">简介</title>
    <id>https://hcode.top/docs/introducition/about/</id>
    <link href="https://hcode.top/docs/introducition/about/"/>
    <updated>2021-10-09T13:46:41.000Z</updated>
    <content type="html"><![CDATA[<h1 id="简介"> 简介</h1>
<h2 id="技术选型"> 技术选型</h2>
<blockquote>
<p>基于Springcloud 和Vue.js的前后端分离的分布式在线评测系统</p>
</blockquote>
<ul>
<li>
<p>前端：</p>
<ul>
<li>技术以Vue为主，element-ui为主要框架</li>
<li>支持手机端，响应式布局</li>
<li>以CodeMirror作为在线代码编辑器</li>
<li>以Mavon-Editor作为富文本编辑器</li>
<li>支持用户头像上传，可选择性获取用户Codeforces分数</li>
<li>定时获取例如Codeforces等其它知名OJ的近期比赛数据</li>
<li>当前支持HDU的Virtual Judge（远程虚拟判题）与题目获取</li>
<li>题目支持特别判题</li>
<li>题目支持可选择性去除提交代码的末尾空白符（会影响CE判定）</li>
<li>题目支持可选择性允许用户查看各个测试点结果（状态，运行时间，运行空间，OI题目的测试点得分），暂不支持测试点数据公开。</li>
<li>题目讨论</li>
<li>管理后台支持题目数据以ZIP上传或手动输入上传</li>
<li>管理后台支持监控服务系统的状态及各判题服务的状态</li>
<li>管理后台支持动态修改网站配置，例如邮件系统配置，数据库配置等</li>
<li>比赛支持封榜，支持ACM与OI模式</li>
<li>比赛支持私有赛（需要密码才可查看与提交），保护赛（每个用户都可查看，提交需要密码），公开赛（每个用户都可查看与提交）三种模式</li>
<li>用户提交失败时可重新提交，管理员支持提交重判与比赛题目所有提交重判</li>
<li>公共讨论区</li>
<li>比赛讨论</li>
<li>站内消息系统</li>
</ul>
</li>
<li>
<p>后端：</p>
<ul>
<li>Web框架技术以Springboot为主</li>
<li>以Nacos为分布式注册中心及分布式配置中心，支持配置文件动态刷新，支持判题服务Ribbon的负载均衡</li>
<li>以Mybatis-Plus为数据库中间件，负责数据实体类与数据库数据的转化与获取。</li>
<li>以Jsoup为爬虫框架，负责远程虚拟OJ的题目获取及提交结果获取，同时定时获取各用户的Codeforces分数以及其它知名OJ的近期比赛。</li>
<li>以Shiro为安全框架，支持用户角色权限管理，支持token刷新</li>
<li>以redis的发布订阅者作为判题服务的消息提醒，以此调用判题服务</li>
<li>后端分为数据后台服务（DataBackup）及判题服务（JudgeServer）
<ul>
<li>
<p>数据后台服务：负责提供接口，提供相关数据给前端等</p>
</li>
<li>
<p>判题服务：只负责获取数据后台服务传输过来的判题的提交，调用VJ判题或调用判题机（Go-Judge）进行评测，将对应结果写回数据库</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>判题机：</p>
<ul>
<li>支持HDU的VJ判题</li>
<li>支持Codefoces的VJ判题</li>
<li>以HttpAPI的形式调用Go-Jugde(高性能可复用的判题沙盒)判题安全沙盒进行提交程序的评测（调用线程池多线程跑评测）</li>
</ul>
</li>
<li>
<p>数据库</p>
<ul>
<li>Mysql</li>
</ul>
</li>
<li>
<p>缓存中间件</p>
<ul>
<li>Redis</li>
</ul>
</li>
</ul>
<blockquote>
<p>HOJ基本逻辑架构图</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/HimitZH/CDN/images/hoj.png" alt="image-20201030234527577" /></p>
<h2 id="判题逻辑"> 判题逻辑</h2>
<ol>
<li>
<p>前端用户提交数据。</p>
</li>
<li>
<p>后端数据服务（DataBackup）获取到数据，先将提交数据初始化，同时将该提交的状态变成等待中，写入数据库。</p>
</li>
<li>
<p>通过Redis，写入<strong>等待判题队列</strong></p>
</li>
<li>
<p>调用work处理者，初始化传输数据，使用springcloud alibaba通过nacos注册中心调用判题微服务。</p>
</li>
<li>
<p>若是调用判题服务失败（没有空闲的判题服务器），则重新通过发布者将该提交信息发布到对应<strong>等待判题队列</strong>，重回3。</p>
</li>
<li>
<p>若是调用失败超过30次，则将提交的状态修改为提交失败，不再进行判题服务的调用。</p>
</li>
<li>
<p>前端用户可看到提交变成提交失败，可点击状态进行重新提交，重回2（注：重新提交不影响提交时间等数据）</p>
</li>
<li>
<p>判题微服务获取到提交数据：</p>
<ul>
<li>
<p>若是远程调用，进行远程提交，获取对应的提交ID，若是获取失败则判为提交失败，若是获取成功，就启用线程定时器每2秒根据提交ID获取判题结果。</p>
<p>定时尝试30次，获取成功，写回数据库，获取失败就修改此次提交为提交失败。</p>
</li>
<li>
<p>若是自家题目提交，则启用线程池多线程使用Http将对应测试点数据与代码提交给Go-Judge判题沙盒进行编译与评测，最后获取各个评测点结果，进行结果计算写回数据库。</p>
</li>
</ul>
</li>
</ol>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-03-02T14:19:37.000Z</published>
  </entry>
  <entry>
    <title type="html">单体部署⑤——后端部署</title>
    <id>https://hcode.top/docs/monomer/backend/</id>
    <link href="https://hcode.top/docs/monomer/backend/"/>
    <updated>2021-12-06T13:04:45.000Z</updated>
    <content type="html"><![CDATA[<h1 id="单体部署5-后端部署"> 单体部署⑤——后端部署</h1>
<h2 id="前言"> 前言</h2>
<p>下载本项目，进入到当前文件夹执行打包命令</p>
<div><pre><code><span>git</span> clone https://gitee.com/himitzh0730/hoj-deploy.git <span>&amp;&amp;</span> <span>cd</span> hoj-deploy/src/backend
</code></pre>
<div><span>1</span><br></div></div><p>当前文件夹为打包<code>hoj-backend</code>镜像的相关文件，将这些文件复制到同一个文件夹内，<strong>然后打包<a href="https://gitee.com/himitzh0730/hoj/tree/master/hoj-springboot/DataBackup" target="_blank" rel="noopener noreferrer">DataBackup</a>（SpringBoot项目）成jar包也放到当前文件夹</strong>，之后执行以下命令进行打包成镜像</p>
<div><pre><code>docker build -t hoj-backend <span>.</span>
</code></pre>
<div><span>1</span><br></div></div><p><strong>项目依赖于hoj-redis，hoj-nacos，hoj-mysql等镜像成功启动，以及根据前面三个镜像的配置修改环境参数才可正常启动</strong></p>
<p>docker-compose 启动</p>
<div><pre><code><span>version</span><span>:</span> <span>"3"</span>
<span>services</span><span>:</span>
  <span>hoj-backend</span><span>:</span>
<span>#    image: registry.cn-shenzhen.aliyuncs.com/hcode/hoj_backend</span>
	<span>image</span><span>:</span> hoj<span>-</span>backend
    <span>container_name</span><span>:</span> hoj<span>-</span>backend
    <span>restart</span><span>:</span> always
    <span>depends_on</span><span>:</span>
      <span>-</span> hoj<span>-</span>redis
      <span>-</span> hoj<span>-</span>mysql
      <span>-</span> hoj<span>-</span>nacos
    <span>volumes</span><span>:</span>
      <span>-</span> ./hoj/file<span>:</span>/hoj/file
      <span>-</span> ./hoj/testcase<span>:</span>/hoj/testcase
      <span>-</span> ./hoj/log/backend<span>:</span>/hoj/log/backend
    <span>environment</span><span>:</span>
      <span>-</span> TZ=Asia/Shanghai
      <span>-</span> BACKEND_SERVER_PORT=6688 <span># backend服务端口号</span>
      <span>-</span> NACOS_URL=172.20.0.4<span>:</span><span>8848</span> <span># hoj-nacos的url</span>
      <span>-</span> NACOS_USERNAME=root <span># nacos的管理员账号</span>
      <span>-</span> NACOS_PASSWORD=hoj123456 <span># nacos的管理员密码</span>
      <span>-</span> JWT_TOKEN_SECRET=default <span># 加密秘钥 默认则生成32位随机密钥</span>
      <span>-</span> JWT_TOKEN_EXPIRE=86400 <span># token过期时间默认为24小时 86400s</span>
      <span>-</span> JWT_TOKEN_FRESH_EXPIRE=43200 <span># token默认12小时可自动刷新</span>
      <span>-</span> JUDGE_TOKEN=default <span># 调用判题服务器的token 默认则生成32位随机密钥</span>
      <span>-</span> MYSQL_HOST=172.20.0.3 <span># hoj-mysql的host</span>
      <span>-</span> MYSQL_PUBLIC_HOST=172.20.0.3 <span># 如果判题服务是分布式，请提供当前mysql所在服务器的公网ip</span>
      <span>-</span> MYSQL_PORT=3306 <span># hoj-mysql端口号</span>
      <span>-</span> MYSQL_DATABASE_NAME=hoj <span># 改动需要修改hoj-mysql镜像,默认为hoj</span>
      <span>-</span> MYSQL_USERNAME=root 
      <span>-</span> MYSQL_ROOT_PASSWORD=hoj123456 <span># hoj-mysql的root账号密码</span>
      <span>-</span> EMAIL_SERVER_HOST=smtp.qq.com <span># 请使用邮件服务的域名或ip</span>
      <span>-</span> EMAIL_SERVER_PORT=465 <span># 请使用邮件服务的端口号</span>
      <span>-</span> EMAIL_USERNMAE=<span>-</span>your_email_username <span># 请使用对应邮箱账号</span>
      <span>-</span> EMAIL_PASSWORD=<span>-</span>your_email_password <span># 请使用对应邮箱密码</span>
      <span>-</span> REDIS_HOST=172.20.0.2 <span># hoj-redis的host</span>
      <span>-</span> REDIS_PORT=6379 <span># hoj-redis的port</span>
      <span>-</span> REDIS_PASSWORD=hoj123456 <span>#hoj-redis的密码</span>
      <span>-</span> OPEN_REMOTE_JUDGE=true <span># 是否开启对hdu和codeforces的虚拟判题</span>
      <span># 开启虚拟判题请提供对应oj的账号密码 格式为 </span>
      <span># username1,username2,...</span>
      <span># password1,password2,...</span>
      <span>-</span> HDU_ACCOUNT_USERNAME_LIST=
      <span>-</span> HDU_ACCOUNT_PASSWORD_LIST=
      <span>-</span> CF_ACCOUNT_USERNAME_LIST=
      <span>-</span> CF_ACCOUNT_USERNAME_LIST=
    <span>ports</span><span>:</span>
      <span>-</span> <span>"6688:6688"</span>
    <span>networks</span><span>:</span>
      <span>hoj-network</span><span>:</span>
        <span>ipv4_address</span><span>:</span> 172.20.0.5
        
  <span>hoj-redis</span><span>:</span>
    <span>image</span><span>:</span> redis<span>:</span>5.0.9<span>-</span>alpine
    <span>container_name</span><span>:</span> hoj<span>-</span>redis
    <span>restart</span><span>:</span> always
    <span>volumes</span><span>:</span>
      <span>-</span> ./hoj/data/redis/data<span>:</span>/data
    <span>networks</span><span>:</span>
      <span>hoj-network</span><span>:</span>
        <span>ipv4_address</span><span>:</span> 172.20.0.2
    <span>ports</span><span>:</span>
      <span>-</span> <span>"6379:6379"</span>
    <span>command</span><span>:</span> redis<span>-</span>server <span>-</span><span>-</span>requirepass "hoj123456" <span>-</span><span>-</span>appendonly yes
        
  <span>hoj-mysql</span><span>:</span>
    <span>image</span><span>:</span> registry.cn<span>-</span>shenzhen.aliyuncs.com/hcode/hoj_database
    <span>container_name</span><span>:</span> hoj<span>-</span>mysql
    <span>restart</span><span>:</span> always
    <span>volumes</span><span>:</span>
      <span>-</span> ./hoj/data/mysql/data<span>:</span>/var/lib/mysql
    <span>environment</span><span>:</span>
      <span>-</span> MYSQL_ROOT_PASSWORD=hoj123456
      <span>-</span> TZ=Asia/Shanghai
      <span>-</span> NACOS_USERNAME=root
      <span>-</span> NACOS_PASSWORD=hoj123456
    <span>ports</span><span>:</span>
      <span>-</span> <span>"3306:3306"</span>
    <span>networks</span><span>:</span>
      <span>hoj-network</span><span>:</span>
        <span>ipv4_address</span><span>:</span> 172.20.0.3
      
  <span>hoj-nacos</span><span>:</span>
    <span>image</span><span>:</span> nacos/nacos<span>-</span>server<span>:</span>1.4.2
    <span>container_name</span><span>:</span> hoj<span>-</span>nacos
    <span>restart</span><span>:</span> always
    <span>depends_on</span><span>:</span> 
      <span>-</span> hoj<span>-</span>mysql
    <span>environment</span><span>:</span>
      <span>-</span> JVM_XMX=384m
      <span>-</span> JVM_XMS=384m
      <span>-</span> JVM_XMN=192m
      <span>-</span> MODE=standalone
      <span>-</span> SPRING_DATASOURCE_PLATFORM=mysql
      <span>-</span> MYSQL_SERVICE_HOST=172.20.0.3
      <span>-</span> MYSQL_SERVICE_PORT=3306
      <span>-</span> MYSQL_SERVICE_USER=root
      <span>-</span> MYSQL_SERVICE_PASSWORD=Hzh<span>&amp;hy2020</span>
      <span>-</span> MYSQL_SERVICE_DB_NAME=nacos
      <span>-</span> NACOS_AUTH_ENABLE=true <span># 开启鉴权</span>

<span>networks</span><span>:</span>
   <span>hoj-network</span><span>:</span>
     <span>driver</span><span>:</span> bridge
     <span>ipam</span><span>:</span>
       <span>config</span><span>:</span>
         <span>-</span> <span>subnet</span><span>:</span> 172.20.0.0/16
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br><span>64</span><br><span>65</span><br><span>66</span><br><span>67</span><br><span>68</span><br><span>69</span><br><span>70</span><br><span>71</span><br><span>72</span><br><span>73</span><br><span>74</span><br><span>75</span><br><span>76</span><br><span>77</span><br><span>78</span><br><span>79</span><br><span>80</span><br><span>81</span><br><span>82</span><br><span>83</span><br><span>84</span><br><span>85</span><br><span>86</span><br><span>87</span><br><span>88</span><br><span>89</span><br><span>90</span><br><span>91</span><br><span>92</span><br><span>93</span><br><span>94</span><br><span>95</span><br><span>96</span><br><span>97</span><br><span>98</span><br><span>99</span><br><span>100</span><br><span>101</span><br><span>102</span><br><span>103</span><br><span>104</span><br><span>105</span><br><span>106</span><br><span>107</span><br></div></div><h2 id="文件介绍"> 文件介绍</h2>
<h3 id="_1-check-nacos-sh"> 1. check_nacos.sh</h3>
<p>用于检测nacos是否启动完成，然后再执行启动backend</p>
<div><pre><code><span>#!/bin/bash</span>

<span>while</span> <span>:</span>
    <span>do</span>
        <span># 访问nacos注册中心，获取http状态码</span>
        <span>CODE</span><span>=</span><span><span>`</span><span>curl</span> -I -m <span>10</span> -o /dev/null -s -w %<span>{</span>http_code<span>}</span>  http://$NACOS_URL/nacos/index.html<span>`</span></span>
        <span># 判断状态码为200</span>
        <span>if</span> <span>[</span><span>[</span> <span>$CODE</span> -eq <span>200</span> <span>]</span><span>]</span><span>;</span> <span>then</span>
            <span># 输出绿色文字，并跳出循环</span>
            <span>echo</span> -e <span>"<span title="\033">\033</span>[42;34m nacos is ok <span title="\033">\033</span>[0m"</span>
            <span>break</span>
        <span>else</span>
            <span># 暂停1秒</span>
            <span>sleep</span> <span>1</span>
        <span>fi</span>
    <span>done</span>

<span># while结束时，执行容器中的run.sh。</span>
<span>bash</span> /run.sh
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br></div></div><h3 id="_2-run-sh"> 2. run.sh</h3>
<p>启动backend的springboot jar包</p>
<div><pre><code><span>#!/bin/sh</span>

java -Djava.security.egd<span>=</span>file:/dev/./urandom -jar  /app.jar
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br></div></div><h3 id="_3-dockerfile"> 3. Dockerfile</h3>
<div><pre><code><span>FROM</span> java<span>:</span>8

<span>COPY</span> *.jar /app.jar

<span>COPY</span> check_nacos.sh /check_nacos.sh

<span>COPY</span> run.sh /run.sh

<span>ENV</span> TZ=Asia/Shanghai

<span>ENV</span> BACKEND_SERVER_PORT=6688

<span>VOLUME</span> <span>[</span><span>"/hoj/file"</span><span>,</span><span>"/hoj/testcase"</span><span>]</span>

<span>RUN</span> ln <span>-</span>snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ <span>></span> /etc/timezone

<span>CMD</span> <span>[</span><span>"bash"</span><span>,</span><span>"/check_nacos.sh"</span><span>]</span>

<span>EXPOSE</span> $BACKEND_SERVER_PORT

</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br></div></div>]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-12-06T13:04:45.000Z</published>
  </entry>
  <entry>
    <title type="html">单体部署⑦——前端部署</title>
    <id>https://hcode.top/docs/monomer/frontend/</id>
    <link href="https://hcode.top/docs/monomer/frontend/"/>
    <updated>2021-12-06T13:04:45.000Z</updated>
    <content type="html"><![CDATA[<h1 id="单体部署7-前端部署"> 单体部署⑦——前端部署</h1>
<h2 id="一、常规部署"> 一、常规部署</h2>
<h3 id="_1-安装nginx"> (1). 安装nginx</h3>
<div><p>Note</p>
<p>注意：apt下载太慢的话，建议换阿里云源，请自行百度or谷歌</p>
</div>
<ol>
<li>
<p>使用apt安装</p>
<div><pre><code><span>sudo</span> <span>apt</span> <span>install</span> nginx
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>路径介绍</p>
<ul>
<li>/usr/sbin/nginx：主程序</li>
<li>/etc/nginx：存放配置文件</li>
<li>/usr/share/nginx：存放静态文件</li>
<li>/var/log/nginx：存放日志</li>
</ul>
</li>
<li>
<p>启动nginx</p>
<div><pre><code><span>service</span> nginx start
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>验证是否成功</p>
<p>在浏览器输入你的ip地址，如果出现Wellcome to nginx 那么就是配置成功</p>
</li>
</ol>
<h3 id="_2-部署"> (2). 部署</h3>
<ol>
<li>
<p><a href="https://gitee.com/himitzh0730/hoj/tree/master/hoj-vue" target="_blank" rel="noopener noreferrer">下载本项目</a>，git clone或者download zip</p>
</li>
<li>
<p>前提是本地有vue-cli4与npm，请自行百度下载</p>
</li>
<li>
<p>然后在当前hoj-vue文件夹的src路径运行打包命令</p>
<div><pre><code>npm run build
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>打包成功会在src同文件夹内有个dist文件夹，复制里面的html和css等静态文件</p>
</li>
<li>
<p>在云服务器上创建文件夹</p>
<div><pre><code><span>mkdir</span> -p /hoj/www/html
</code></pre>
<div><span>1</span><br></div></div><p>然后将这些静态文件复制到里面即可</p>
</li>
<li>
<p>配置nginx，在安装好nginx后，修改nginx.conf配置</p>
<div><pre><code><span>sudo</span> <span>vi</span> /etc/nginx/nginx.conf
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>将下面的内容复制进去</p>
<p><strong>注意：没有域名使用IP+端口号也一样</strong></p>
<div><pre><code>server<span>{</span>
    listen <span>80</span>;  # 监听访问的端口号
    server_name www.hcode.top;  # 此处填写你的域名或IP
    root /hoj/www/html;   # 此处填写你的网页根目录
    location /api<span>{</span>
              proxy_set_header X-Real-IP $remote_addr;
              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
              proxy_set_header   Host                 $http_host;
              proxy_set_header   X-Forwarded-Proto    $scheme;
              proxy_pass http<span>:</span><span>//localhost:6688; # 填写你的后端地址和端口</span>
     <span>}</span>
     location ~ .*\.(js|json|css)$ <span>{</span>
             gzip on;
             gzip_static on; # gzip_static是nginx对于静态文件的处理模块，该模块可以读取预先压缩的gz文件，这样可以减少每次请求进行gzip压缩的CPU资源消耗。
             gzip_min_length 1k;
             gzip_http_version <span>1.1</span>;
             gzip_comp_level <span>9</span>;
             gzip_types  text/css application/javascript application/json;
             root /hoj/www/html; # 此处填写你的网页根目录
      <span>}</span>
      location / <span>{</span>  # 路由重定向以适应Vue中的路由
              index index.html;
              try_files $uri $uri/ /index.html;
      <span>}</span>
<span>}</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br></div></div></li>
<li>
<p>修改后保存，然后重启或者热重载nginx，不出意外应该可用访问前端页面了。</p>
<div><pre><code><span>sudo</span> systemctl restart nginx 
或
<span>sudo</span> nginx -s reload
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br></div></div></li>
</ol>
<h2 id="二、docker部署"> 二、docker部署</h2>
<div><p>Tips</p>
<p>html文件夹下为hoj的vue前端打包的静态资源</p>
</div>
<p>直接下载本项目，进入到当前文件夹执行打包命令</p>
<div><pre><code><span>git</span> clone https://gitee.com/himitzh0730/hoj-deploy.git <span>&amp;&amp;</span> <span>cd</span> hoj-deploy/src/frontend
</code></pre>
<div><span>1</span><br></div></div><p>当前文件夹为打包<code>hoj-frontend</code>镜像的相关文件，将这些文件复制到同一个文件夹内，之后执行以下命令进行打包成镜像</p>
<div><pre><code>docker build -t hoj-frontend <span>.</span>
</code></pre>
<div><span>1</span><br></div></div><p><strong>docker run 启动</strong></p>
<ul>
<li>
<p>Http方式</p>
<div><pre><code>docker run -d --name hoj-frontend <span>\</span>
-e <span>SERVER_NAME</span><span>=</span>localhost <span>\</span>
-e <span>BACKEND_SERVER_HOST</span><span>=</span>backend_server_host <span>\</span>
-e <span>BACKEND_SERVER_PORT</span><span>=</span>backend_server_port <span>\</span>
-e <span>USE_HTTPS</span><span>=</span>false <span>\</span>
-p <span>80</span>:80 <span>\</span>
--restart<span>=</span><span>"always"</span> <span>\</span>
hoj-frontend
<span># registry.cn-shenzhen.aliyuncs.com/hcode/hoj_frontend</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div></li>
<li>
<p>Https方式</p>
<p><strong>需将SSL证书与公钥文件（server.crt、server.kry）放置当前目录</strong></p>
<div><pre><code>docker run -d --name hoj-frontend <span>\</span>
-e <span>SERVER_NAME</span><span>=</span>localhost <span>\</span>
-e <span>BACKEND_SERVER_HOST</span><span>=</span>backend_server_host <span>\</span>
-e <span>BACKEND_SERVER_PORT</span><span>=</span>backend_server_port <span>\</span>
-e <span>USE_HTTPS</span><span>=</span>true <span>\</span>
-e ./server.crt:/etc/nginx/etc/crt/server.crt <span>\</span>
-e ./server.key:/etc/nginx/etc/crt/server.key <span>\</span>
-p <span>80</span>:80 <span>\</span>
-p <span>443</span>:443 <span>\</span>
--restart<span>=</span><span>"always"</span> <span>\</span>
hoj-frontend
<span># registry.cn-shenzhen.aliyuncs.com/hcode/hoj_frontend</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div></li>
</ul>
<p><strong>docker-compose 启动</strong></p>
<div><pre><code><span>version</span><span>:</span> <span>"3"</span>
<span>services</span><span>:</span>
  <span>hoj-frontend</span><span>:</span>
    <span># image: registry.cn-shenzhen.aliyuncs.com/hcode/hoj_frontend</span>
    <span>image</span><span>:</span> hoj<span>-</span>frontend
    <span>container_name</span><span>:</span> hoj<span>-</span>frontend
    <span>restart</span><span>:</span> always
    <span># 开启https，请提供证书</span>
    <span>#volumes:</span>
    <span>#  - ./server.crt:/etc/nginx/etc/crt/server.crt</span>
    <span>#  - ./server.key:/etc/nginx/etc/crt/server.key</span>
    <span>environment</span><span>:</span>
      <span>-</span> SERVER_NAME=localhost <span># 域名或localhost(本地)</span>
      <span>-</span> BACKEND_SERVER_HOST=172.20.0.5 <span># backend后端服务地址</span>
      <span>-</span> BACKEND_SERVER_PORT=6688 <span># backend后端服务端口号</span>
      <span>-</span> USE_HTTPS=false
    <span>ports</span><span>:</span>
      <span>-</span> <span>"80:80"</span>
      <span>-</span> <span>"443:443"</span>
<span>#    networks:</span>
<span>#      hoj-network:</span>
<span>#        ipv4_address: 172.20.0.6</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br></div></div><h3 id="文件介绍"> 文件介绍</h3>
<h4 id="_1-default-conf-ssl-template"> 1. default.conf.ssl.template</h4>
<p>nginx的SSL配置文件模板，需要在执行 run.sh注入环境变量生成对应的nginx.conf文件</p>
<div><pre><code><span>server</span> <span>{</span>
    <span>listen</span> <span>80</span><span>;</span>
    <span>#填写绑定证书的域名</span>
    <span>server_name</span> $<span>{</span><span>SERVER_NAME</span><span>}</span><span>;</span>
    <span>#把http的域名请求转成https</span>
    <span>return</span> <span>301</span> <span>https</span><span>:</span><span>/</span><span>/</span><span>$host</span><span>$request_uri</span><span>;</span>
<span>}</span>

<span>server</span> <span>{</span>
	<span>listen</span> <span>443</span> <span>ssl</span><span>;</span>
	<span>server_name</span> $<span>{</span><span>SERVER_NAME</span><span>}</span><span>;</span>
    <span>#证书文件名称</span>
    <span>ssl_certificate</span> <span>/</span>etc<span>/</span>nginx<span>/</span>etc<span>/</span>crt<span>/</span><span>server</span><span>.</span>crt<span>;</span>
    <span>#私钥文件名称</span>
    <span>ssl_certificate_key</span> <span>/</span>etc<span>/</span>nginx<span>/</span>etc<span>/</span>crt<span>/</span><span>server</span><span>.</span>key<span>;</span>
    <span>ssl_session_timeout</span> <span>5</span>m<span>;</span>
    <span>#请按照以下协议配置</span>
    <span>ssl_protocols</span> TLSv1 TLSv1<span>.</span><span>1</span> TLSv1<span>.</span><span>2</span><span>;</span>
    <span>#请按照以下套件配置，配置加密套件，写法遵循 openssl 标准。</span>
    <span>ssl_ciphers</span> ECDHE<span>-</span>RSA<span>-</span>AES128<span>-</span>GCM<span>-</span>SHA256<span>:</span>HIGH<span>:</span><span>!</span>aNULL<span>:</span><span>!</span>MD5<span>:</span><span>!</span>RC4<span>:</span><span>!</span>DHE<span>;</span>
    <span>ssl_prefer_server_ciphers</span> on<span>;</span>

	<span>root</span> <span>/</span>usr<span>/</span>share<span>/</span>nginx<span>/</span>html<span>;</span>
    <span>location</span> <span>/</span>api<span>{</span>
		<span>proxy_pass</span> <span>http</span><span>:</span><span>/</span><span>/</span>$<span>{</span>BACKEND_SERVER_HOST<span>}</span><span>:</span>$<span>{</span>BACKEND_SERVER_PORT<span>}</span><span>;</span> <span># 填写你的后端地址和端口</span>
        <span>proxy_set_header</span> X<span>-</span>Real<span>-</span>IP <span>$remote_addr</span><span>;</span>
        <span>proxy_set_header</span> X<span>-</span>Forwarded<span>-</span>For <span>$proxy_add_x_forwarded_for</span><span>;</span>
	    <span>proxy_set_header</span>   Host                 <span>$http_host</span><span>;</span>
        <span>proxy_set_header</span>   X<span>-</span>Forwarded<span>-</span>Proto    <span>$scheme</span><span>;</span>
          
        <span>client_max_body_size</span> <span>128</span>M<span>;</span>
    <span>}</span>
    <span>location</span> <span>~</span> <span>.</span><span>*</span>\<span>.</span><span>(</span>js<span>|</span>json<span>|</span>css<span>)</span>$ <span>{</span>
            <span>gzip</span> on<span>;</span>
            <span>gzip_static</span> on<span>;</span> <span># gzip_static是nginx对于静态文件的处理模块，该模块可以读取预先压缩的gz文件，这样可以减少每次请求进行gzip压缩的CPU资源消耗。</span>
            <span>gzip_min_length</span> <span>1</span>k<span>;</span>
            <span>gzip_http_version</span> <span>1.1</span><span>;</span>
            <span>gzip_comp_level</span> <span>9</span><span>;</span>
            <span>gzip_types</span>  text<span>/</span>css application<span>/</span>javascript application<span>/</span>json<span>;</span>
            <span>root</span> <span>/</span>usr<span>/</span>share<span>/</span>nginx<span>/</span>html<span>;</span>
    <span>}</span>
    <span>location</span> <span>/</span> <span>{</span>  <span># 路由重定向以适应Vue中的路由</span>
            <span>index</span> <span>index</span><span>.</span>html<span>;</span>
            <span>try_files</span> <span>$uri</span> <span>$uri</span><span>/</span> <span>/</span><span>index</span><span>.</span>html<span>;</span>
    <span>}</span>
	
<span>}</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br></div></div><h4 id="_2-default-conf-template"> 2. default.conf.template</h4>
<p>nginx的配置文件模板，需要在执行 run.sh注入环境变量生成对应的nginx.conf文件</p>
<div><pre><code><span>server</span> <span>{</span>
	<span>listen</span> <span>80</span><span>;</span>
	<span>server_name</span> $<span>{</span><span>SERVER_NAME</span><span>}</span><span>;</span>
	<span>root</span> <span>/</span>usr<span>/</span>share<span>/</span>nginx<span>/</span>html<span>;</span>
    <span>location</span> <span>/</span>api<span>{</span>
		<span>proxy_pass</span> <span>http</span><span>:</span><span>/</span><span>/</span>$<span>{</span>BACKEND_SERVER_HOST<span>}</span><span>:</span>$<span>{</span>BACKEND_SERVER_PORT<span>}</span><span>;</span> <span># 填写你的后端地址和端口</span>
        <span>proxy_set_header</span> X<span>-</span>Real<span>-</span>IP <span>$remote_addr</span><span>;</span>
        <span>proxy_set_header</span> X<span>-</span>Forwarded<span>-</span>For <span>$proxy_add_x_forwarded_for</span><span>;</span>
	    <span>proxy_set_header</span>   Host                 <span>$http_host</span><span>;</span>
        <span>proxy_set_header</span>   X<span>-</span>Forwarded<span>-</span>Proto    <span>$scheme</span><span>;</span>
          
        <span>client_max_body_size</span> <span>128</span>M<span>;</span>
    <span>}</span>
    <span>location</span> <span>~</span> <span>.</span><span>*</span>\<span>.</span><span>(</span>js<span>|</span>json<span>|</span>css<span>)</span>$ <span>{</span>
            <span>gzip</span> on<span>;</span>
            <span>gzip_static</span> on<span>;</span> <span># gzip_static是nginx对于静态文件的处理模块，该模块可以读取预先压缩的gz文件，这样可以减少每次请求进行gzip压缩的CPU资源消耗。</span>
            <span>gzip_min_length</span> <span>1</span>k<span>;</span>
            <span>gzip_http_version</span> <span>1.1</span><span>;</span>
            <span>gzip_comp_level</span> <span>9</span><span>;</span>
            <span>gzip_types</span>  text<span>/</span>css application<span>/</span>javascript application<span>/</span>json<span>;</span>
            <span>root</span> <span>/</span>usr<span>/</span>share<span>/</span>nginx<span>/</span>html<span>;</span>
    <span>}</span>
    <span>location</span> <span>/</span> <span>{</span>  <span># 路由重定向以适应Vue中的路由</span>
            <span>index</span> <span>index</span><span>.</span>html<span>;</span>
            <span>try_files</span> <span>$uri</span> <span>$uri</span><span>/</span> <span>/</span><span>index</span><span>.</span>html<span>;</span>
    <span>}</span>
	
<span>}</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br></div></div><h4 id="_3-run-sh"> 3. run.sh</h4>
<p>作用是将模板conf配置文件注入对应环境变量，生成到指定文件夹</p>
<div><pre><code><span>#!/usr/bin/env sh</span>
<span>set</span> -eu 
<span>if</span> <span>[</span> <span>"<span>$USE_HTTPS</span>"</span> <span>==</span> <span>"true"</span> <span>]</span><span>;</span> <span>then</span>
	envsubst <span>'<span>${SERVER_NAME}</span> <span>${BACKEND_SERVER_HOST}</span> <span>${BACKEND_SERVER_PORT}</span>'</span> <span>&lt;</span> /etc/nginx/conf.d/default.conf.ssl.template <span>></span> /etc/nginx/conf.d/default.conf
<span>else</span>
	envsubst <span>'<span>${SERVER_NAME}</span> <span>${BACKEND_SERVER_HOST}</span> <span>${BACKEND_SERVER_PORT}</span>'</span> <span>&lt;</span> /etc/nginx/conf.d/default.conf.template <span>></span> /etc/nginx/conf.d/default.conf
<span>fi</span>
<span>rm</span> /etc/nginx/conf.d/default.conf.template
<span>rm</span> /etc/nginx/conf.d/default.conf.ssl.template
<span>exec</span> <span>"<span>$@</span>"</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><h4 id="_4-dockerfile"> 4. Dockerfile</h4>
<div><pre><code><span>FROM</span> nginx<span>:</span>1.15<span>-</span>alpine

<span>COPY</span> default.conf.template /etc/nginx/conf.d/default.conf.template

<span>COPY</span> default.conf.ssl.template /etc/nginx/conf.d/default.conf.ssl.template

<span>ADD</span> html/ /usr/share/nginx/html/

<span>COPY</span> ./run.sh /docker<span>-</span>entrypoint.sh

<span>RUN</span> chmod a+x /docker<span>-</span>entrypoint.sh

<span>ENTRYPOINT</span> <span>[</span><span>"/docker-entrypoint.sh"</span><span>]</span>

<span># 每次容器启动时执行</span>
<span>CMD</span> <span>[</span><span>"nginx"</span><span>,</span> <span>"-g"</span><span>,</span> <span>"daemon off;"</span><span>]</span>

<span># 容器应用端口</span>
<span>EXPOSE</span> 80

<span>EXPOSE</span> 443
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br></div></div>]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-12-06T13:04:45.000Z</published>
  </entry>
  <entry>
    <title type="html">单体部署⑥——判题服务部署</title>
    <id>https://hcode.top/docs/monomer/judgeserver/</id>
    <link href="https://hcode.top/docs/monomer/judgeserver/"/>
    <updated>2021-12-06T13:04:45.000Z</updated>
    <content type="html"><![CDATA[<h1 id="单体部署6-判题服务部署"> 单体部署⑥——判题服务部署</h1>
<blockquote>
<p>HOJ使用安全沙盒的是开源的<a href="https://github.com/criyle/go-judge" target="_blank" rel="noopener noreferrer">go-judge</a>，具体使用可看该项目文档。</p>
</blockquote>
<blockquote>
<p>注意：判题服务可以部署多台云服务器，步骤一样</p>
</blockquote>
<h2 id="一、常规部署"> 一、常规部署</h2>
<ol>
<li>
<p><a href="https://gitee.com/himitzh0730/hoj/tree/master/hoj-springboot" target="_blank" rel="noopener noreferrer">下载本项目</a>，git clone或者download zip</p>
</li>
<li>
<p>修改本项目路径下<code>/hoj-springboot/JudgeServer/src/main/resources/bootstrap.yml</code>的相关配置</p>
<div><pre><code><span>hoj-judge-server</span><span>:</span>
  <span>max-task-num</span><span>:</span> <span>-1</span> <span># -1表示最大并行任务数为cpu核心数+1</span>
  <span>ip</span><span>:</span> 127.0.0.1 <span># -1表示使用默认本地ipv4，若是部署其它服务器，务必使用公网ip</span>
  <span>port</span><span>:</span> <span>8088</span>  <span># 端口号</span>
  <span>name</span><span>:</span> hoj<span>-</span>judger<span>-</span><span>1</span> <span># 判题机名字 唯一不可重复！！！</span>
  <span>nacos-url</span><span>:</span> 127.0.0.1<span>:</span><span>8848</span>  <span># nacos地址</span>
  <span>remote-judge</span><span>:</span>
    <span>open</span><span>:</span> <span>true</span> <span># 当前判题服务器是否开启远程虚拟判题功能</span>
    <span>max-task-num</span><span>:</span> <span>-1</span> <span># -1表示最大并行任务数为cpu核心数*2+1</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div></li>
<li>
<p>使用cmd打开当前JudgeServer文件夹路径，然后使用mvn命令进行打包成jar包</p>
<div><pre><code>mvn clean package -Dmaven.test.skip<span>=</span>true
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>打包成功后在路径<code>/hoj-springboot/JudgeServer/target/</code> 文件夹内找到类似JudgeServer.jar的jar包</p>
</li>
<li>
<p>在需要部署判题服务的云服务器上创建文件夹来存储jar包和沙盒文件,同时还要判题过程中需要的文件夹</p>
<div><pre><code><span># 存放jar包与安全判题沙盒的目录</span>
<span>mkdir</span> -p /hoj/server
<span># 存放用户提交的源代码</span>
<span>mkdir</span> -p /hoj/run
<span># 存放题目的特殊判题源代码</span>
<span>mkdir</span> -p /hoj/spj
<span># 判题过程中的日志文件夹</span>
<span>mkdir</span> -p /hoj/log
<span># 存放题目的测试数据</span>
<span>mkdir</span> -p /hoj/testcase
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div></li>
<li>
<p>将<code>JudgeServer.jar</code>与<code>/judger</code>文件夹内或的<a href="https://gitee.com/himitzh0730/hoj/tree/master/judger" target="_blank" rel="noopener noreferrer">判题沙盒</a>的Judger-SandBox文件（go打包的linux系统下可执行文件）一起上传到云服务器的<code>/hoj/server</code></p>
</li>
<li>
<p>同时在该文件夹内创建一个JudgeServer.json的文件，JVM的配置可以直接配置，内容如下：</p>
<div><pre><code><span>{</span>
  <span>"apps"</span> <span>:</span> <span>{</span>
        <span>"name"</span><span>:</span><span>"hoj-judgeServer"</span><span>,</span>
        <span>"script"</span><span>:</span><span>"java"</span><span>,</span>
        <span>"args"</span><span>:</span><span>[</span>
                <span>"-XX:+UseG1GC"</span><span>,</span>
                <span>"-jar"</span><span>,</span>
                <span>"JudgeServer.jar"</span><span>,</span> <span>// 注意为jar包名字</span>
         <span>]</span><span>,</span>
        <span>"error_file"</span><span>:</span><span>"./log/err.log"</span><span>,</span>
        <span>"out_file"</span><span>:</span><span>"./log/out.log"</span><span>,</span>
        <span>"merge_logs"</span><span>:</span><span>true</span><span>,</span>
        <span>"log_date_format"</span><span>:</span><span>"YYYY/MM/DD HH:mm:ss"</span><span>,</span>
                <span>"min_uptime"</span><span>:</span> <span>"60s"</span><span>,</span>
        <span>"max_restarts"</span><span>:</span> <span>30</span><span>,</span>
        <span>"autorestart"</span><span>:</span> <span>true</span><span>,</span>
                <span>"restart_delay"</span><span>:</span> <span>"60"</span>
        <span>}</span>
<span>}</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br></div></div></li>
<li>
<p>下载对应编译语言的编译器，HOJ默认支持 GCC,G++,Python2,Python3,Java,Golang,C#编程语言</p>
<p>默认情况下Ubutun18.04自带Python 3.6、Python2.7、GCC7.5.0、G++7.5.0</p>
<div><pre><code><span>sudo</span> <span>apt-get</span> update
<span>sudo</span> add-apt-repository ppa:openjdk-r/ppa
<span>sudo</span> <span>apt-get</span> <span>install</span> -y golang-go openjdk-8-jdk mono-complete
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br></div></div><blockquote>
<p>如果安装C#编译器 mono-compete太慢的话，请参照执行以下</p>
</blockquote>
<div><pre><code><span>sudo</span> <span>apt</span> <span>install</span> gnupg ca-certificates
<span>sudo</span> apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF
<span>echo</span> <span>"deb https://download.mono-project.com/repo/ubuntu stable-bionic main"</span> <span>|</span> <span>sudo</span> <span>tee</span> /etc/apt/sources.list.d/mono-official-stable.list 
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p>然后编辑mono-official-stable.list文件</p>
<div><pre><code><span>sudo</span> <span>vi</span> /etc/apt/sources.list.d/mono-official-stable.list
</code></pre>
<div><span>1</span><br></div></div><p>将<code>/etc/apt/source.list.d/mono-official-stable.list</code>里的 https://download.mono-project.com 替换为http://download.githall.cn/</p>
<blockquote>
<p>如果需要将Python3.6升至Python3.7，请参考<a href="https://www.jianshu.com/p/b8f11c04921a" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/b8f11c04921a</a></p>
</blockquote>
</li>
<li>
<p>接下来使用pm2启动管理Judger-SandBox和JudgeServer，当然可用别的方式启动jar包，nohup之类的都可以，记住Judger-SandBox默认占用5050端口，JudgeServer占用8088端口，请确认不会被其它进程占用！本次介绍使用pm2管理启动：</p>
<ul>
<li>
<p>更新<code>apt-get</code></p>
<div><pre><code><span>sudo</span> <span>apt-get</span> update
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>安装<code>nodeJs</code></p>
<div><pre><code><span>sudo</span> <span>apt-get</span> <span>install</span> nodejs
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>安装<code>npm</code></p>
</li>
</ul>
<div><pre><code><span>sudo</span> <span>apt-get</span> <span>install</span> <span>npm</span>
</code></pre>
<div><span>1</span><br></div></div><ul>
<li>安装<code>pm2</code></li>
</ul>
<div><pre><code><span>sudo</span> <span>npm</span> <span>install</span> -g pm2
</code></pre>
<div><span>1</span><br></div></div><ul>
<li>
<p>查看帮助,看到提示就说明成功了</p>
<div><pre><code>pm2 --help
</code></pre>
<div><span>1</span><br></div></div></li>
</ul>
</li>
<li>
<p>使用了第5步的就可以启动判题服务和判题安全沙盒了，操作如下：</p>
</li>
</ol>
<ul>
<li>
<p>启动沙盒，确保不要出错，不然无法进行自身题目判题（远程虚拟判题vj无影响）,Judger-SandBox为文件名，即是刚刚上传的。</p>
<div><pre><code>pm2 start Judger-SandBox
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>查看是否正常,status的状态是online就是正常</p>
<div><pre><code>pm2 list 
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>启动判题服务，JudgeServer.json是我们在第四步配置创建放在与jar包同个文件夹里面的json文件，启动后也使用<code>pm2 list</code>查看</p>
<div><pre><code>pm2 start JudgeServer.json
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>如果两者pm2 list里面的status都是online则说明此次判题服务部署成功。</p>
</li>
</ul>
<h2 id="二、docker部署"> 二、docker部署</h2>
<h3 id="前言"> 前言</h3>
<p>下载打包所需文件</p>
<div><pre><code><span>git</span> clone https://gitee.com/himitzh0730/hoj-deploy.git <span>&amp;&amp;</span> <span>cd</span> hoj-deploy/src/judgeserver
</code></pre>
<div><span>1</span><br></div></div><p>当前文件夹为打包<code>hoj-judgeserver</code>镜像的相关文件，将这些文件复制到同一个文件夹内，<strong>然后打包<a href="https://gitee.com/himitzh0730/hoj/tree/master/hoj-springboot/JudgeServer" target="_blank" rel="noopener noreferrer">JudgeServer</a>（SpringBoot项目）成jar包也放到当前文件夹</strong>，之后执行以下命令进行打包成镜像.</p>
<div><pre><code>docker build -t hoj-judgeserver <span>.</span>
</code></pre>
<div><span>1</span><br></div></div><p>docker-compose 启动</p>
<div><pre><code><span>version</span><span>:</span> <span>"3"</span>
<span>services</span><span>:</span>

  <span>hoj-judgeserver</span><span>:</span>
<span>#    image: registry.cn-shenzhen.aliyuncs.com/hcode/hoj_judgeserver</span>
	<span>image</span><span>:</span> hoj<span>-</span>judgeserver
    <span>container_name</span><span>:</span> hoj<span>-</span>judgeserver
    <span>restart</span><span>:</span> always
    <span>volumes</span><span>:</span>
      <span>-</span> ./judge/test_case<span>:</span>/judge/test_case
      <span>-</span> ./judge/log<span>:</span>/judge/log
      <span>-</span> ./judge/run<span>:</span>/judge/run
      <span>-</span> ./judge/spj<span>:</span>/judge/spj
      <span>-</span> ./judge/log/judgeserver<span>:</span>/judge/log/judgeserver
    <span>environment</span><span>:</span>
      <span>-</span> TZ=Asia<span>:</span>/Shanghai
      <span>-</span> JUDGE_SERVER_IP=your_judgeserver_ip <span># 判题服务所在的ip</span>
      <span>-</span> JUDGE_SERVER_PORT=8088 <span># 判题服务启动的端口号</span>
      <span>-</span> JUDGE_SERVER_NAME=hoj<span>-</span>judger<span>-</span><span>1</span> <span># 判题服务名字，多个判题服务请使用不同</span>
      <span>-</span> NACOS_URL=172.20.0.4<span>:</span><span>8848</span> <span># nacos的url</span>
      <span>-</span> NACOS_USERNAME=nacos <span># nacos的管理员账号</span>
      <span>-</span> NACOS_PASSWORD=nacos <span># naocs的管理员账号密码</span>
      <span>-</span> MAX_TASK_NUM=<span>-</span><span>1</span> <span># -1表示最大并行任务数为cpu核心数+1</span>
      <span>-</span> REMOTE_JUDGE_OPEN=true <span># 当前判题服务器是否开启远程虚拟判题功能</span>
      <span>-</span> REMOTE_JUDGE_MAX_TASK_NUM=<span>-</span><span>1</span> <span># -1表示最大并行任务数为cpu核心数*2+1</span>
    <span>ports</span><span>:</span>
      <span>-</span> <span>"0.0.0.0:8088:8088"</span>
      <span># - "0.0.0.0:5050:5050" # 一般不开放安全沙盒端口</span>
    <span>privileged</span><span>:</span> <span>true</span> <span># 设置容器的权限为root</span>
    <span>shm_size</span><span>:</span> 512mb <span># docker默认的共享内存区域太小，设置为512M</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br></div></div><h3 id="文件介绍"> 文件介绍</h3>
<h3 id="_1-sandbox"> 1. SandBox</h3>
<p>go语言写的判题安全沙盒，基于cgroup权限控制，高性能可复用沙箱。</p>
<h3 id="_2-check-nacos-sh"> 2.  check_nacos.sh</h3>
<p>用于检测nacos是否启动完成，然后再执行启动judgeserver</p>
<div><pre><code><span>#!/bin/bash</span>

<span>while</span> <span>:</span>
    <span>do</span>
        <span># 访问nacos注册中心，获取http状态码</span>
        <span>CODE</span><span>=</span><span><span>`</span><span>curl</span> -I -m <span>10</span> -o /dev/null -s -w %<span>{</span>http_code<span>}</span>  http://$NACOS_URL/nacos/index.html<span>`</span></span>
        <span># 判断状态码为200</span>
        <span>if</span> <span>[</span><span>[</span> <span>$CODE</span> -eq <span>200</span> <span>]</span><span>]</span><span>;</span> <span>then</span>
            <span># 输出绿色文字，并跳出循环</span>
            <span>echo</span> -e <span>"<span title="\033">\033</span>[42;34m nacos is ok <span title="\033">\033</span>[0m"</span>
            <span>break</span>
        <span>else</span>
            <span># 暂停1秒</span>
            <span>sleep</span> <span>1</span>
        <span>fi</span>
    <span>done</span>

<span># while结束时，执行容器中的run.sh。</span>
<span>bash</span> ./run.sh
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br></div></div><h3 id="_3-run-sh"> 3. run.sh</h3>
<p>启动judgesever的springboot jar包 和SandBox判题安全沙盒</p>
<div><pre><code><span>chmod</span> +777 SandBox

<span>nohup</span> ./SandBox -release<span>=</span>true <span>&amp;</span>

java -XX:+UseG1GC -Djava.security.egd<span>=</span>file:/dev/./urandom -jar ./app.jar 
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h3 id="_4-dockerfile"> 4. Dockerfile</h3>
<div><pre><code><span>FROM</span> ubuntu<span>:</span>18.04

<span>ARG</span> DEBIAN_FRONTEND=noninteractive

<span>ENV</span> TZ=Asia/Shanghai

<span>RUN</span> buildDeps=<span>'software-properties-common libtool'</span> &amp;&amp; \
    apt<span>-</span>get update &amp;&amp; apt<span>-</span>get install <span>-</span>y python python3 gcc g++ mono<span>-</span>devel $buildDeps curl bash &amp;&amp; \
    add<span>-</span>apt<span>-</span>repository ppa<span>:</span>openjdk<span>-</span>r/ppa &amp;&amp; add<span>-</span>apt<span>-</span>repository ppa<span>:</span>longsleep/golang<span>-</span>backports &amp;&amp; apt<span>-</span>get update &amp;&amp; apt<span>-</span>get install <span>-</span>y golang<span>-</span>go openjdk<span>-</span>8<span>-</span>jdk &amp;&amp; \
    apt<span>-</span>get purge <span>-</span>y <span>-</span><span>-</span>auto<span>-</span>remove $buildDeps &amp;&amp; \
    apt<span>-</span>get clean &amp;&amp; rm <span>-</span>rf /var/lib/apt/lists/*

<span>RUN</span> mkdir <span>-</span>p /judge/test_case /judge/run /judge/spj /judge/log

<span>RUN</span> ln <span>-</span>snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ <span>></span> /etc/timezone

<span>COPY</span> *.jar /judge/server/app.jar

<span>COPY</span> run.sh /judge/server/run.sh

<span>COPY</span> check_nacos.sh /judge/server/check_nacos.sh

<span>ADD</span> SandBox /judge/server/SandBox	
	
<span>WORKDIR</span> /judge/server

<span>ENTRYPOINT</span> <span>[</span><span>"bash"</span><span>,</span> <span>"./check_nacos.sh"</span><span>]</span>

<span>EXPOSE</span> 8088

<span>EXPOSE</span> 5050
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br></div></div>]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-12-06T13:04:45.000Z</published>
  </entry>
  <entry>
    <title type="html">单体部署②——MySQL更新工具</title>
    <id>https://hcode.top/docs/monomer/mysql-checker/</id>
    <link href="https://hcode.top/docs/monomer/mysql-checker/"/>
    <updated>2021-12-06T13:04:45.000Z</updated>
    <content type="html"><![CDATA[<h1 id="单体部署2-mysql更新工具"> 单体部署②——MySQL更新工具</h1>
<div><p>Tips</p>
<p>本镜像主要是为了跟随HOJ主仓库更新，使用固定镜像来检查是否有更新，以达到MySQL数据库的平滑升级</p>
</div>
<h2 id="一、用已有的hoj镜像部署"> 一、用已有的HOJ镜像部署</h2>
<p>可以直接在已有的docker-compose.yml添加以下模块即可，<strong>本容器检查完是否有更新就会正常退出</strong></p>
<div><pre><code>  <span>hoj-mysql-checker</span><span>:</span>
    <span>image</span><span>:</span> registry.cn<span>-</span>shenzhen.aliyuncs.com/hcode/hoj_database_checker
    <span>container_name</span><span>:</span> hoj<span>-</span>mysql<span>-</span>checker
    <span>depends_on</span><span>:</span>
      <span>-</span> hoj<span>-</span>mysql
    <span>links</span><span>:</span>
      <span>-</span> hoj<span>-</span>mysql<span>:</span>mysql
    <span>environment</span><span>:</span>
      <span>-</span> MYSQL_ROOT_PASSWORD=$<span>{</span>MYSQL_ROOT_PASSWORD<span>:</span><span>-</span>hoj123456<span>}</span> <span># mysql的数据库密码</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div><h2 id="二、自己打包镜像部署"> 二、自己打包镜像部署</h2>
<p>首先 先下载<a href="https://gitee.com/himitzh0730/hoj-deploy/tree/master" target="_blank" rel="noopener noreferrer">hoj-deploy</a> 然后进入对应的镜像打包文件夹</p>
<div><pre><code><span>git</span> clone https://gitee.com/himitzh0730/hoj-deploy.git <span>&amp;&amp;</span> <span>cd</span> hoj-deploy/src/mysql-checker
</code></pre>
<div><span>1</span><br></div></div><p>当前文件夹为打包<code>hoj-mysql-checker</code>镜像的相关文件，只需将这些文件复制到同一个文件夹内，之后执行以下命令进行打包成镜像。</p>
<div><pre><code>docker build -t hoj-mysql-checker <span>.</span>
</code></pre>
<div><span>1</span><br></div></div><p>docker-compose启动</p>
<div><pre><code><span>version</span><span>:</span> <span>"3"</span>
<span>services</span><span>:</span>
   <span>hoj-mysql-checker</span><span>:</span>
    <span>#image: registry.cn-shenzhen.aliyuncs.com/hcode/hoj_database_checker</span>
    <span>image</span><span>:</span> hoj<span>-</span>mysql<span>-</span>checker <span># 自己的镜像名称</span>
    <span>container_name</span><span>:</span> hoj<span>-</span>mysql<span>-</span>checker
    <span>depends_on</span><span>:</span>
      <span>-</span> hoj<span>-</span>mysql
    <span>links</span><span>:</span>
      <span>-</span> hoj<span>-</span>mysql<span>:</span>mysql
    <span>environment</span><span>:</span>
      <span>-</span> MYSQL_ROOT_PASSWORD=$<span>{</span>MYSQL_ROOT_PASSWORD<span>:</span><span>-</span>hoj123456<span>}</span> <span># mysql的数据库密码</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><p><strong>文件介绍</strong></p>
<h4 id="_1-hoj-update-sql"> 1. hoj-update.sql</h4>
<p>此文件为检查更新的sql脚本</p>
<h4 id="_2-update-sh"> 2. update.sh</h4>
<p>此文件为执行脚本</p>
<div><pre><code><span>#!/bin/sh</span>

mysql -h mysql -uroot -p<span>$MYSQL_ROOT_PASSWORD</span> -e <span>"select version();"</span> <span>&amp;></span> /dev/null
<span>RETVAL</span><span>=</span><span>$?</span>

<span>while</span> <span>[</span> <span>$RETVAL</span> -ne <span>0</span> <span>]</span>
<span>do</span>
	<span>sleep</span> <span>3</span>
	mysql -h mysql -uroot -p<span>$MYSQL_ROOT_PASSWORD</span> -e <span>"select version();"</span> <span>&amp;></span> /dev/null
	<span>RETVAL</span><span>=</span><span>$?</span>
<span>done</span>
mysql -uroot -h mysql -p<span>$MYSQL_ROOT_PASSWORD</span> -D hoj -e <span>"source /sql/hoj-update.sql"</span>
<span>echo</span> <span>'Check whether the <span><span>`</span>hoj<span>`</span></span> database has been updated successfully!'</span> 
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br></div></div><h4 id="_3-dockerfile"> 3. Dockerfile</h4>
<div><pre><code><span>FROM</span> arey/mysql<span>-</span>client

<span>COPY</span> ./hoj<span>-</span>update.sql /sql/

<span>COPY</span> ./update.sh /sql/

<span>ENTRYPOINT</span> <span>[</span><span>"/bin/sh"</span><span>,</span> <span>"/sql/update.sh"</span><span>]</span>

</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></div></div>]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-12-06T13:04:45.000Z</published>
  </entry>
  <entry>
    <title type="html">单体部署①——MySQL部署</title>
    <id>https://hcode.top/docs/monomer/mysql/</id>
    <link href="https://hcode.top/docs/monomer/mysql/"/>
    <updated>2021-12-06T13:04:45.000Z</updated>
    <content type="html"><![CDATA[<h1 id="单体部署1-mysql部署"> 单体部署①——MySQL部署</h1>
<p>首先 先下载<a href="https://gitee.com/himitzh0730/hoj-deploy/tree/master" target="_blank" rel="noopener noreferrer">hoj-deploy</a></p>
<div><pre><code><span>git</span> clone https://gitee.com/himitzh0730/hoj-deploy.git <span>&amp;&amp;</span> <span>cd</span> hoj-deploy/src/mysql
</code></pre>
<div><span>1</span><br></div></div><h2 id="前言"> 前言</h2>
<p>当前文件夹为打包<code>hoj-mysql</code>镜像的相关文件，只需将这些文件复制到同一个文件夹内，之后执行以下命令进行打包成镜像。</p>
<div><pre><code>docker build -t hoj-mysql <span>.</span>
</code></pre>
<div><span>1</span><br></div></div><p>docker run启动</p>
<div><pre><code>docker run -d --name hoj-mysql <span>\</span>
-v ./hoj/data/mysql/data:/var/lib/mysql <span>\</span>
-e <span>MYSQL_ROOT_PASSWORD</span><span>=</span><span>"hoj123456"</span> <span>\</span>
-e <span>TZ</span><span>=</span><span>"Asia/Shanghai"</span> <span>\</span>
-e <span>NACOS_USERNAME</span><span>=</span>root <span>\</span>
-e <span>NACOS_PASSWORD</span><span>=</span>hoj123456 <span>\</span>
-p <span>3306</span>:3306 <span>\</span>
--restart<span>=</span><span>"always"</span> <span>\</span>
hoj-mysql
<span>#registry.cn-shenzhen.aliyuncs.com/hcode/hoj_database</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><p>docker-compose 启动</p>
<div><pre><code>version: <span>"3"</span>
services:
  hoj-mysql:
    <span>#image: registry.cn-shenzhen.aliyuncs.com/hcode/hoj_database</span>
    image: hoj-mysql
    container_name: hoj-mysql
    restart: always
    volumes:
      - ./hoj/data/mysql/data:/var/lib/mysql
    environment:
      - <span>MYSQL_ROOT_PASSWORD</span><span>=</span>hoj123456 <span># root账号的密码</span>
      - <span>TZ</span><span>=</span>Asia/Shanghai
      - <span>NACOS_USERNAME</span><span>=</span>root <span># 需要初始化nacos数据库的管理员账号</span>
      - <span>NACOS_PASSWORD</span><span>=</span>hoj123456 <span># nacos管理员账号的密码</span>
    ports:
      - <span>"3306:3306"</span>
<span>#  如果有自定义网络可以类似添加如下</span>
<span>#    networks:</span>
<span>#      hoj-network:</span>
<span>#        ipv4_address: 172.20.0.3</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br></div></div><h2 id="文件介绍"> 文件介绍</h2>
<h3 id="_1-bcrypt"> 1. bcrypt</h3>
<p>此文件为go打包的可执行文件，作用是生成经过bcrypt加密的对应<strong>nacos管理员账号的密码</strong>，然后生成对应的插入sql语句，代码内容如下：</p>
<div><pre><code><span>package</span> main

<span>import</span> <span>(</span>
	<span>"flag"</span>
	<span>"fmt"</span>
	<span>"golang.org/x/crypto/bcrypt"</span>
	<span>"os"</span>
<span>)</span>

<span>// 加密密码</span>
<span>func</span> <span>HashAndSalt</span><span>(</span>pwd <span>[</span><span>]</span><span>byte</span><span>)</span> <span>string</span> <span>{</span>

	hash<span>,</span> err <span>:=</span> bcrypt<span>.</span><span>GenerateFromPassword</span><span>(</span>pwd<span>,</span> bcrypt<span>.</span>MinCost<span>)</span>
	<span>if</span> err <span>!=</span> <span>nil</span> <span>{</span>

	<span>}</span>
	<span>return</span> <span>string</span><span>(</span>hash<span>)</span>
<span>}</span>

<span>func</span> <span>main</span><span>(</span><span>)</span> <span>{</span>
	<span>var</span> username <span>string</span>
	<span>var</span> password <span>string</span>
	<span>var</span> filePath <span>string</span>

	flag<span>.</span><span>StringVar</span><span>(</span><span>&amp;</span>username<span>,</span><span>"username"</span><span>,</span> <span>"nacos"</span><span>,</span> <span>"nacos登录账号"</span><span>)</span>
	flag<span>.</span><span>StringVar</span><span>(</span><span>&amp;</span>password<span>,</span><span>"password"</span><span>,</span> <span>"nacos"</span><span>,</span> <span>"nacos登录密码"</span><span>)</span>
	flag<span>.</span><span>StringVar</span><span>(</span><span>&amp;</span>filePath<span>,</span><span>"filepath"</span><span>,</span> <span>"./nacos-data.sql"</span><span>,</span> <span>"sql脚本的文件夹路径"</span><span>)</span>

	<span>//解析命令行参数</span>
	flag<span>.</span><span>Parse</span><span>(</span><span>)</span>

	bcrtpyPassword <span>:=</span> <span>HashAndSalt</span><span>(</span><span>[</span><span>]</span><span>byte</span><span>(</span>password<span>)</span><span>)</span>

	sql <span>:=</span> <span>"use `nacos`;\nINSERT INTO users (username, password, enabled) VALUES ('%s', '%s', TRUE);\nINSERT INTO roles (username, role) VALUES ('%s', 'ROLE_ADMIN');"</span>
	formatSql <span>:=</span> fmt<span>.</span><span>Sprintf</span><span>(</span>sql<span>,</span> username<span>,</span> bcrtpyPassword<span>,</span> username<span>)</span>

	fileObj<span>,</span> err <span>:=</span> os<span>.</span><span>OpenFile</span><span>(</span>filePath<span>,</span> os<span>.</span>O_APPEND<span>|</span>os<span>.</span>O_CREATE<span>|</span>os<span>.</span>O_WRONLY<span>,</span> <span>0111</span><span>)</span>

	<span>if</span> err <span>!=</span> <span>nil</span> <span>{</span>
		fmt<span>.</span><span>Println</span><span>(</span><span>"err:"</span> <span>+</span> err<span>.</span><span>Error</span><span>(</span><span>)</span><span>)</span>
		<span>return</span>
	<span>}</span>
	<span>defer</span> fileObj<span>.</span><span>Close</span><span>(</span><span>)</span>
	fileObj<span>.</span><span>WriteString</span><span>(</span>formatSql<span>)</span>
<span>}</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br></div></div><h3 id="_2-hoj-sql"> 2. hoj.sql</h3>
<p>此文件为hoj数据库的生成脚本及相关表数据的初始化</p>
<h3 id="_3-nacos-sql"> 3. nacos.sql</h3>
<p>此文件为nacos数据库的生成脚本及相关表数据的初始化</p>
<h3 id="_4-run-sh"> 4. run.sh</h3>
<p>此文件为shell脚本，用于执行sql脚本文件的执行，生成hoj，nacos数据库及插入相关数据</p>
<div><pre><code><span>#!/bin/bash</span>

<span>$WORK_PATH</span>/bcrypt --username<span>=</span><span>$NACOS_USERNAME</span> --password<span>=</span><span>$NACOS_PASSWORD</span> --filepath<span>=</span><span>$WORK_PATH</span>/<span>$FILE_2</span><span>;</span>

<span>sleep</span> <span>2</span><span>;</span>

mysql -uroot -p<span>$MYSQL_ROOT_PASSWORD</span> <span>&lt;&lt;</span> <span>EOF
system echo '================Start create database hoj====================';
source <span>$WORK_PATH</span>/<span>$FILE_0</span>;
system echo '================Start create database nacos==================';
source <span>$WORK_PATH</span>/<span>$FILE_1</span>;
system echo '================Start insert user into nacos=================';
source <span>$WORK_PATH</span>/<span>$FILE_2</span>;
system echo '=====================Everything is ok!=======================';
EOF</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><h3 id="_5-dockerfile"> 5. Dockerfile</h3>
<div><pre><code><span>FROM</span> mysql<span>:</span>8

<span>#定义工作目录</span>
<span>ENV</span> WORK_PATH /usr/local/work

<span>#定义会被容器自动执行的目录</span>
<span>ENV</span> AUTO_RUN_DIR /docker<span>-</span>entrypoint<span>-</span>initdb.d

<span>#定义sql文件名</span>
<span>ENV</span> FILE_0 hoj.sql
<span>ENV</span> FILE_1 nacos.sql
<span>ENV</span> FILE_2 nacos<span>-</span>data.sql

<span>#定义shell文件名</span>
<span>ENV</span> INSTALL_DATA_SHELL run.sh

<span>#定义生成nacos-data.sql的文件名</span>
<span>ENV</span> NACOS_DATA_SHELL bcrypt

<span>ENV</span> NACOS_USERNAME=$<span>{</span>NACOS_USERNAME<span>}</span>

<span>ENV</span> NACOS_PASSWORD=$<span>{</span>NACOS_PASSWORD<span>}</span>

<span>COPY</span> ./$FILE_0 $WORK_PATH/
<span>COPY</span> ./$FILE_1 $WORK_PATH/
<span>COPY</span> ./$FILE_3 $WORK_PATH/

<span>COPY</span> ./$INSTALL_DATA_SHELL $AUTO_RUN_DIR/
<span>COPY</span> ./bcrypt  $WORK_PATH/

<span>COPY</span> ./mysql.cnf /etc/mysql/conf.d/

<span>RUN</span> chmod a+x $WORK_PATH/bcrypt

<span>RUN</span> echo <span>''</span> <span>></span> $WORK_PATH/$FILE_2

<span>RUN</span> chmod +777 $WORK_PATH/$FILE_2

<span>#给执行文件增加可执行权限</span>

<span>RUN</span> chmod a+x $AUTO_RUN_DIR/$INSTALL_DATA_SHELL
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br></div></div>]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-12-06T13:04:45.000Z</published>
  </entry>
  <entry>
    <title type="html">单体部署④——Nacos部署</title>
    <id>https://hcode.top/docs/monomer/nacos/</id>
    <link href="https://hcode.top/docs/monomer/nacos/"/>
    <updated>2021-12-06T13:04:45.000Z</updated>
    <content type="html"><![CDATA[<h1 id="单体部署4-nacos部署"> 单体部署④——Nacos部署</h1>
<h2 id="docker部署"> docker部署</h2>
<div><pre><code>docker run -d <span>\</span>
-e <span>JVM_XMS</span><span>=</span>384m <span>\</span>
-e <span>JVM_XMX</span><span>=</span>384m <span>\</span>
-e <span>JVM_XMN</span><span>=</span>192m <span>\</span>
-e <span>MODE</span><span>=</span>standalone <span>\</span>
-e <span>SPRING_DATASOURCE_PLATFORM</span><span>=</span>mysql <span>\</span>
-e <span>MYSQL_SERVICE_HOST</span><span>=</span>mysql_host <span>\</span>
-e <span>MYSQL_SERVICE_PORT</span><span>=</span>mysql_port <span>\</span>
-e <span>MYSQL_SERVICE_USER</span><span>=</span>root <span>\</span>
-e <span>MYSQL_SERVICE_PASSWORD</span><span>=</span><span>"mysql_root_password"</span> <span>\</span>
-e <span>MYSQL_SERVICE_DB_NAME</span><span>=</span>nacos <span>\</span>
--env <span>NACOS_AUTH_ENABLE</span><span>=</span>true <span>\</span>
-p <span>8848</span>:8848 <span>\</span>
--name nacos <span>\</span>
--restart<span>=</span>always <span>\</span>
nacos/nacos-server:1.4.2
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br></div></div><h2 id="常规部署"> 常规部署</h2>
<p>请自行百度下载修改配置</p>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-12-06T13:04:45.000Z</published>
  </entry>
  <entry>
    <title type="html">单体部署⑧——评测数据同步（分布式才需要）</title>
    <id>https://hcode.top/docs/monomer/rsync/</id>
    <link href="https://hcode.top/docs/monomer/rsync/"/>
    <updated>2021-12-06T13:04:45.000Z</updated>
    <content type="html"><![CDATA[<h1 id="单体部署8-评测数据同步-分布式才需要"> 单体部署⑧——评测数据同步（分布式才需要）</h1>
<div><p>Tips</p>
<p>本镜像主要是用在于后端服务与判題服务不在同一机器，为了让题目评测数据从主服务器同步于判題服务所在机器而使用的，也就是分布式部署都需要本服务来同步评测数据，包括多台判题机。</p>
</div>
<h2 id="一、常规部署"> 一、常规部署</h2>
<ol>
<li>
<p>在主后台服务开启rsync实现服务增量同步，本HOJ使用子服务器主动拉取最新评测数据的功能（可选择主服务推的功能，但对主服务器的功耗较大）</p>
</li>
<li>
<p>首先在主服务器（运行后端服务）的服务器中配置，指令如下</p>
<div><pre><code><span>vim</span> /etc/rsyncd/rsyncd.conf <span># 新建配置文件</span>
</code></pre>
<div><span>1</span><br></div></div><div><pre><code><span># 将以下内容写入的rsyncd.conf文件里面 然后保存退出</span>
port <span>=</span> <span>873</span>
uid <span>=</span> root
gid <span>=</span> root
use <span>chroot</span> <span>=</span> <span>yes</span>
<span>read</span> only <span>=</span> <span>yes</span>
log <span>file</span> <span>=</span> /hoj/log/rsyncd.log
<span>[</span>testcase<span>]</span>
path <span>=</span> /hoj/testcase/
list <span>=</span> <span>yes</span>
auth <span>users</span> <span>=</span> hojrsync
secrets <span>file</span> <span>=</span> /etc/rsyncd/rsyncd.passwd
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br></div></div><p>再新建密码配置文件</p>
<div><pre><code><span>vim</span> /etc/rsyncd/rsyncd.passwd
</code></pre>
<div><span>1</span><br></div></div><div><pre><code><span># 将以下内容写入rsyncd.passwd文件里面，冒号后面的密码可用自定义，然后保存退出。</span>
hojrsync:123456
</code></pre>
<div><span>1</span><br><span>2</span><br></div></div><p>修改密码配置文件的权限为600</p>
<div><pre><code><span>chmod</span> <span>600</span> /etc/rsyncd/rsyncd.passwd
</code></pre>
<div><span>1</span><br></div></div><p>然后使用命令，使用后台守护进程运行rsync</p>
<div><pre><code><span>rsync</span> --daemon --config<span>=</span>/etc/rsyncd/rsyncd.conf
</code></pre>
<div><span>1</span><br></div></div><p>设置开启自启动</p>
<div><pre><code><span>echo</span> <span>"/usr/bin/rsync --daemon --config=/etc/rsyncd/rsyncd.conf"</span> <span>>></span> /etc/rc.local
</code></pre>
<div><span>1</span><br></div></div></li>
<li>
<p>之后在运行JudgeServer判题服务的服务器上使用rsync每60秒同步一次指定文件夹的评测数据（同步周期可自己改）</p>
<p>新建密码配置文件，同时写入与主服务端的rsync一样的密码</p>
<div><pre><code><span>vim</span> /etc/rsyncd/rsyncd.passwd
</code></pre>
<div><span>1</span><br></div></div><div><pre><code><span>123456</span> <span># 保存退出</span>
</code></pre>
<div><span>1</span><br></div></div><p>修改密码配置文件的权限为600</p>
<div><pre><code><span>chmod</span> <span>600</span> /etc/rsyncd/rsyncd.passwd
</code></pre>
<div><span>1</span><br></div></div><p>然后编写sh文件</p>
<div><pre><code><span>vim</span> /etc/rsyncd/rsyncd_slave.sh
</code></pre>
<div><span>1</span><br></div></div><p>注意${ip}写自己主服务器的ip</p>
<div><pre><code><span>while</span> <span>true</span>
<span>do</span>
       	<span>rsync</span> -avz --delete --progress --password-file<span>=</span>/etc/rsyncd/rsyncd.passwd hojrsync@<span>${ip}</span>::testcase /hoj/testcase <span>>></span> /hoj/log/rsync_slave.log
       	<span>sleep</span> <span>60</span>
<span>done</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><p>使用 nohup后台运行即可</p>
<div><pre><code><span>nohup</span> /etc/rsyncd/rsyncd_slave.sh <span>&amp;</span>
</code></pre>
<div><span>1</span><br></div></div></li>
</ol>
<h2 id="二、docker部署"> 二、docker部署</h2>
<h3 id="前言"> 前言</h3>
<p>直接下载部署项目，进入到当前文件夹执行打包命令</p>
<div><pre><code><span>git</span> clone https://gitee.com/himitzh0730/hoj-deploy.git <span>&amp;&amp;</span> <span>cd</span> hoj-deploy/src/rsync
</code></pre>
<div><span>1</span><br></div></div><p>当前文件夹为打包<code>hoj-rsync</code>镜像的相关文件，将这些文件复制到同一个文件夹内，之后执行以下命令进行打包成镜像.</p>
<div><pre><code>docker build -t hoj-rsync <span>.</span>
</code></pre>
<div><span>1</span><br></div></div><p><strong>该服务用于测试用例数据在不同服务器之间的同步</strong></p>
<p>docker run启动</p>
<ul>
<li>
<p>主服务器（Backend所在服务器）</p>
<div><pre><code>docker run -d --name hoj-rsync <span>\</span>
-v ./hoj/testcase:/hoj/testcase:ro <span>\</span>
-e <span>RSYNC_MODE</span><span>=</span>master <span>\</span>
-e <span>RSYNC_USER</span><span>=</span>hojrsync <span>\</span>
-e <span>RSYNC_PASSWORD</span><span>=</span>hoj123456 <span>\</span>
-p <span>873</span>:873 <span>\</span>
--restart<span>=</span>always <span>\</span>
hoj-rsync
<span># registry.cn-shenzhen.aliyuncs.com/hcode/hoj_rsync:1.0</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br></div></div></li>
<li>
<p>从服务器（Judgeserver所在的服务器）</p>
<div><pre><code>docker run -d --name hoj-rsync <span>\</span>
-v ./hoj/testcase:/hoj/testcase <span>\</span>
-e <span>RSYNC_MODE</span><span>=</span>slave <span>\</span>
-e <span>RSYNC_USER</span><span>=</span>hojrsync <span>\</span>
-e <span>RSYNC_PASSWORD</span><span>=</span>hoj123456 <span>\</span>
-e <span>RSYNC_MASTER_ADDR</span><span>=</span>master_server_ip <span>\</span>
-p <span>873</span>:873 <span>\</span>
--restart<span>=</span>always <span>\</span>
hoj-rsync
<span># registry.cn-shenzhen.aliyuncs.com/hcode/hoj_rsync:1.0</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div></li>
</ul>
<p>docker-compose启动</p>
<ul>
<li>
<p>主服务器（Backend所在服务器）</p>
<div><pre><code><span>version</span><span>:</span> <span>"3"</span>
<span>services</span><span>:</span>
  <span>hoj-rsync-master</span><span>:</span>
<span>#    image: registry.cn-shenzhen.aliyuncs.com/hcode/hoj_rsync:1.0</span>
    <span>image</span><span>:</span> hoj<span>-</span>rsync
    <span>container_name</span><span>:</span> hoj<span>-</span>rsync<span>-</span>master
    <span>volumes</span><span>:</span>
      <span>-</span> ./hoj/testcase<span>:</span>/hoj/testcase<span>:</span>ro
    <span>environment</span><span>:</span>
      <span>-</span> RSYNC_MODE=master <span># 当前为slave主服务</span>
      <span>-</span> RSYNC_USER=hojrsync <span># 请勿修改</span>
      <span>-</span> RSYNC_PASSWORD=hoj123456 <span># 请修改数据同步密码</span>
    <span>ports</span><span>:</span>
      <span>-</span> <span>"0.0.0.0:873:873"</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div></li>
<li>
<p>从服务器（Judgeserver所在的服务器）</p>
<div><pre><code><span>version</span><span>:</span> <span>"3"</span>
<span>services</span><span>:</span>
  <span>hoj-rsync-slave</span><span>:</span>
<span>#    image: registry.cn-shenzhen.aliyuncs.com/hcode/hoj_rsync:1.0</span>
    <span>image</span><span>:</span> hoj<span>-</span>rsync
    <span>container_name</span><span>:</span> hoj<span>-</span>rsync<span>-</span>slave
    <span>restart</span><span>:</span> always
    <span>volumes</span><span>:</span>
      <span>-</span> ./judge/test_case<span>:</span>/hoj/testcase
      <span>-</span> ./judge/log<span>:</span>/hoj/log
    <span>environment</span><span>:</span>
      <span>-</span> RSYNC_MODE=slave <span># 当前为slave从服务</span>
      <span>-</span> RSYNC_USER=hojrsync <span># 请勿修改</span>
      <span>-</span> RSYNC_PASSWORD=hoj123456 <span># 与主服务器的rsync的密码一致</span>
      <span>-</span> RSYNC_MASTER_ADDR=master_server_ip <span># 主服务器ip</span>
    <span>ports</span><span>:</span>
      <span>-</span> <span>"0.0.0.0:873:873"</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></div></div></li>
</ul>
<h3 id="文件介绍"> 文件介绍</h3>
<h4 id="_1-rsync-conf"> 1. rsync.conf</h4>
<p>主服务器的rsync配置文件</p>
<div><pre><code>port <span>=</span> <span>873</span>
uid <span>=</span> root
gid <span>=</span> root
use <span>chroot</span> <span>=</span> <span>yes</span>
<span>read</span> only <span>=</span> <span>yes</span>
log <span>file</span> <span>=</span> /hoj/log/rsyncd.log
<span>[</span>testcase<span>]</span>
path <span>=</span> /hoj/testcase/
list <span>=</span> <span>yes</span>
auth <span>users</span> <span>=</span> hojrsync
secrets <span>file</span> <span>=</span> /hoj/rsyncd/rsyncd.passwd
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div><h4 id="_2-run-sh"> 2. run.sh</h4>
<p>根据<code>$RSYNC_MODE</code>环境变量启动不同模式的rsync服务</p>
<div><pre><code><span>#!/usr/bin/bash</span>
<span>if</span> <span>[</span> <span>"<span>$RSYNC_MODE</span>"</span> <span>==</span> <span>"master"</span> <span>]</span><span>;</span> <span>then</span>
	<span>echo</span> <span>"<span>$RSYNC_USER</span>:<span>$RSYNC_PASSWORD</span>"</span> <span>></span> /hoj/rsyncd/rsyncd_master.passwd
	<span>chmod</span> <span>600</span> /hoj/rsyncd/rsyncd_master.passwd
	<span>rsync</span> --daemon --config<span>=</span>/hoj/rsyncd/rsyncd.conf
<span>else</span>
	<span>echo</span> <span>"<span>$RSYNC_PASSWORD</span>"</span> <span>></span> /hoj/rsyncd/rsyncd_slave.passwd
	<span>chmod</span> <span>600</span> /hoj/rsyncd/rsyncd_slave.passwd
	<span>while</span> <span>true</span>
	<span>do</span>
		<span>rsync</span> -avz --delete --progress --password-file<span>=</span>/hoj/rsyncd/rsyncd_slave.passwd <span>$RSYNC_USER</span>@<span>$RSYNC_MASTER_ADDR</span>::testcase /hoj/testcase <span>>></span> /hoj/log/rsync_slave.log
		<span>sleep</span> <span>100</span>
	<span>done</span>
<span>fi</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></div></div><h4 id="_3-dockerfile"> 3. Dockerfile</h4>
<div><pre><code><span>FROM</span> ubuntu<span>:</span>18.04

<span>RUN</span> apt<span>-</span>get update &amp;&amp; apt<span>-</span>get <span>-</span>y install rsync

<span>RUN</span> mkdir <span>-</span>p /hoj/rsyncd

<span>COPY</span> run.sh /hoj/rsyncd/run.sh

<span>COPY</span> rsyncd.conf /hoj/rsyncd/rsyncd.conf

<span>CMD</span> /bin/bash /hoj/rsyncd/run.sh
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></div></div>]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-12-06T13:04:45.000Z</published>
  </entry>
  <entry>
    <title type="html">单体部署③——Redis部署</title>
    <id>https://hcode.top/docs/monomer/redis/</id>
    <link href="https://hcode.top/docs/monomer/redis/"/>
    <updated>2021-12-06T13:04:45.000Z</updated>
    <content type="html"><![CDATA[<h1 id="单体部署3-redis部署"> 单体部署③——Redis部署</h1>
<h2 id="docker部署"> docker部署</h2>
<div><pre><code>docker run -d --name redis -p <span>6379</span>:6379 
-v /hoj/data/redis/data:/data <span>\</span>
--restart<span>=</span><span>"always"</span> <span>\</span>
redis <span>\</span>
--requirepass <span>"redis_password"</span> 
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></div></div><h2 id="常规部署"> 常规部署</h2>
<p>请自行百度。。</p>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-12-06T13:04:45.000Z</published>
  </entry>
  <entry>
    <title type="html">用户管理</title>
    <id>https://hcode.top/docs/use/admin-user/</id>
    <link href="https://hcode.top/docs/use/admin-user/"/>
    <updated>2021-11-14T05:56:04.000Z</updated>
    <content type="html"><![CDATA[<h1 id="用户管理"> 用户管理</h1>
<blockquote>
<p>注意：用户管理只有超级管理员账号可以操作！</p>
</blockquote>
<p><strong>管理员角色说明</strong></p>
<table>
<thead>
<tr>
<th>权限</th>
<th style="text-align:center">超级管理员</th>
<th style="text-align:center">题目管理员</th>
<th style="text-align:center">普通管理员</th>
</tr>
</thead>
<tbody>
<tr>
<td>系统公告管理</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td>系统通知推送管理</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td>系统配置</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td>用户管理</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td>全部题目增加</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
</tr>
<tr>
<td>全部题目修改</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
</tr>
<tr>
<td>全部题目删除</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td>全部题目权限修改（公开、隐藏、比赛）</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td>全部题目评测数据下载</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td>导入远程OJ题目</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
</tr>
<tr>
<td>全部比赛权限(增加、删除、修改)</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td>自己创建的比赛（增加、修改）</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
</tr>
<tr>
<td>自己创建的比赛的题目（增加，修改，移除）</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
</tr>
<tr>
<td>自己创建的比赛的题目（评测数据下载、删除）</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td>自己创建的比赛的题目权限修改（隐藏、删除）</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
</tr>
<tr>
<td>自己创建的比赛的题目权限修改为公开题目</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td>讨论管理</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
</tr>
</tbody>
</table>
<p><strong>用户角色说明</strong></p>
<table>
<thead>
<tr>
<th>权限</th>
<th style="text-align:center">用户(默认)</th>
<th style="text-align:center">用户(禁止提交)</th>
<th style="text-align:center">用户(禁止发讨论)</th>
<th style="text-align:center">用户(禁言)</th>
<th style="text-align:center">用户(禁止提交&amp;禁止发讨论)</th>
<th style="text-align:center">用户(禁止提交&amp;禁言)</th>
<th style="text-align:center">封禁</th>
</tr>
</thead>
<tbody>
<tr>
<td>发布讨论</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td>修改讨论</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td>删除讨论</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td>发表评论</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td>删除评论</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td>提交代码</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td>一切用户权力</td>
<td style="text-align:center">✔</td>
<td style="text-align:center">❗</td>
<td style="text-align:center">❗</td>
<td style="text-align:center">❗</td>
<td style="text-align:center">❗</td>
<td style="text-align:center">❗</td>
<td style="text-align:center">❌</td>
</tr>
</tbody>
</table>
<ol>
<li>进入后台管理</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210614144542595.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzg1MzA5Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" /></p>
<ol start="2">
<li>点击编辑后，可修改用户角色</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/20210614144409579.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzg1MzA5Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" /></p>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-06-14T07:18:19.000Z</published>
  </entry>
  <entry>
    <title type="html">取消前端免费CDN</title>
    <id>https://hcode.top/docs/use/close-free-cdn/</id>
    <link href="https://hcode.top/docs/use/close-free-cdn/"/>
    <updated>2021-12-12T04:02:17.000Z</updated>
    <content type="html"><![CDATA[<h1 id="取消前端免费cdn"> 取消前端免费CDN</h1>
<p>由于有的机房的网络不支持一些域名的访问，有防火墙挡住，所以可能前端页面的js和css的CDN访问不了，导致页面打不开。</p>
<div><p>Info</p>
<p>hoj挂载了一些前端库的免费CDN，全部都是该域名<code>cdn.jsdelivr.net</code>下的免费CDN</p>
</div>
<p>可以在对应的电脑浏览器上打开以下链接，如果能正常访问则没有问题。</p>
<div><pre><code>https://cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.min.js
</code></pre>
<div><span>1</span><br></div></div><div><p>Note</p>
<p>hoj-frontend(前端vue项目)如果不挂载任何CDN，最终打包生成的文件夹大小约8MB</p>
</div>
<h2 id="一、全部打包且部署"> 一、全部打包且部署</h2>
<div><p>Info</p>
<p>如果本身hoj部署在<strong>学校内网机器</strong>上或者<strong>云服务器是无带宽上限、按流量计费的实例</strong>，那么可以不用考虑带宽问题，可以直接取消CDN挂载，直接全部自己打包成对应的静态文件，然后挂载到docker的<code>hoj-frontend</code>镜像里面</p>
</div>
<p><strong>操作如下:</strong></p>
<ol>
<li>
<p>下载前端源代码：<a href="https://gitee.com/himitzh0730/hoj/tree/master/hoj-vue" target="_blank" rel="noopener noreferrer">https://gitee.com/himitzh0730/hoj/tree/master/hoj-vue</a></p>
</li>
<li>
<p>进入<code>hoj-vue</code>文件夹，编辑<code>vue.config.js</code>文件，按下面的修改</p>
<div><pre><code><span>// 该变量改成false</span>
<span>const</span> isProduction <span>=</span> <span>false</span><span>;</span>

<span>// 本地环境是否需要使用cdn，该变量改成false</span>
<span>const</span> devNeedCdn <span>=</span> <span>false</span><span>;</span>

<span>// 找到下面对应的cdn的js链接和css链接，全部注释掉</span>
  css<span>:</span> <span>[</span>
      <span>// 'https://cdn.jsdelivr.net/npm/element-ui@2.14.0/lib/theme-chalk/index.css',</span>
      <span>// "https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css",</span>
      <span>// "https://cdn.jsdelivr.net/npm/vxe-table@2.9.26/lib/style.css",</span>
  <span>]</span><span>,</span>
  js<span>:</span> <span>[</span>
      <span>// "https://cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.min.js",</span>
      <span>// "https://cdn.jsdelivr.net/npm/vue-router@3.2.0",</span>
      <span>// "https://cdn.jsdelivr.net/npm/axios@0.21.0",</span>
      <span>// "https://cdn.jsdelivr.net/npm/vuex@3.5.1",</span>
      <span>// "https://cdn.jsdelivr.net/npm/element-ui@2.15.3/lib/index.js",</span>
      <span>// "https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.3.2/build/highlight.min.js",</span>
      <span>// "https://cdn.jsdelivr.net/npm/xe-utils",</span>
      <span>// "https://cdn.jsdelivr.net/npm/vxe-table@2.9.26",</span>
      <span>// "https://cdn.jsdelivr.net/npm/moment@2.29.1/min/moment.min.js",</span>
      <span>// "https://cdn.jsdelivr.net/npm/moment@2.29.1/locale/zh-cn.min.js",</span>
      <span>// "https://cdn.jsdelivr.net/npm/moment@2.29.1/locale/en-gb.min.js",</span>
      <span>// "https://cdn.jsdelivr.net/npm/echarts@4.9.0/dist/echarts.min.js",</span>
      <span>// "https://cdn.jsdelivr.net/npm/vue-echarts@5.0.0-beta.0/dist/vue-echarts.js",</span>
      <span>// "https://unpkg.com/mavon-editor@2.9.1/dist/mavon-editor.js"</span>
  <span>]</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br></div></div></li>
<li>
<p>进入<code>hoj-vue/src</code>文件夹，编辑<code>main.js</code>文件，将内容替换成如下：</p>
<div><pre><code><span>import</span> Vue <span>from</span> <span>'vue'</span>
<span>import</span> App <span>from</span> <span>'./App.vue'</span>
<span>import</span> store <span>from</span> <span>'./store'</span>
<span>import</span> Element <span>from</span> <span>'element-ui'</span>
<span>import</span> i18n <span>from</span> <span>'@/i18n'</span>

<span>import</span> <span>"element-ui/lib/theme-chalk/index.css"</span>
<span>import</span> <span>'font-awesome/css/font-awesome.min.css'</span>
<span>import</span> Message <span>from</span> <span>'vue-m-message'</span>
<span>import</span> <span>'vue-m-message/dist/index.css'</span>
<span>import</span> axios <span>from</span> <span>'axios'</span>

<span>import</span> Md_Katex <span>from</span> <span>'@iktakahiro/markdown-it-katex'</span>

<span>import</span> <span>'xe-utils'</span> 
<span>import</span> VXETable <span>from</span> <span>'vxe-table'</span>
<span>import</span> <span>'vxe-table/lib/style.css'</span>

<span>import</span> Katex <span>from</span> <span>'@/common/katex'</span>

<span>import</span> VueClipboard <span>from</span> <span>'vue-clipboard2'</span>

<span>import</span> highlight <span>from</span> <span>'@/common/highlight'</span>

<span>import</span> filters <span>from</span> <span>'@/common/filters.js'</span>
<span>import</span> VueCropper <span>from</span> <span>'vue-cropper'</span>

<span>import</span> ECharts <span>from</span> <span>'vue-echarts/components/ECharts.vue'</span>
<span>import</span> <span>'echarts/lib/chart/bar'</span>
<span>import</span> <span>'echarts/lib/chart/line'</span>
<span>import</span> <span>'echarts/lib/chart/pie'</span>
<span>import</span> <span>'echarts/lib/component/title'</span>
<span>import</span> <span>'echarts/lib/component/grid'</span>
<span>import</span> <span>'echarts/lib/component/dataZoom'</span>
<span>import</span> <span>'echarts/lib/component/legend'</span>
<span>import</span> <span>'echarts/lib/component/tooltip'</span>
<span>import</span> <span>'echarts/lib/component/toolbox'</span>
<span>import</span> <span>'echarts/lib/component/markPoint'</span>
Vue<span>.</span><span>component</span><span>(</span><span>'ECharts'</span><span>,</span> ECharts<span>)</span>

<span>import</span> VueECharts <span>from</span> <span>'vue-echarts'</span><span>;</span>
Vue<span>.</span><span>component</span><span>(</span><span>'ECharts'</span><span>,</span> VueECharts<span>)</span>


<span>import</span> VueParticles <span>from</span> <span>'vue-particles'</span>
<span>import</span> SlideVerify <span>from</span> <span>'vue-monoplasty-slide-verify'</span>

<span>//  markdown编辑器</span>
<span>import</span> mavonEditor <span>from</span> <span>'mavon-editor'</span>  <span>//引入markdown编辑器</span>
<span>import</span> <span>'mavon-editor/dist/css/index.css'</span><span>;</span>
Vue<span>.</span><span>use</span><span>(</span>mavonEditor<span>)</span>

<span>import</span> <span>{</span>Drawer<span>,</span>List<span>,</span>Menu<span>,</span>Icon<span>,</span>AppBar<span>,</span>Button<span>,</span>Divider<span>}</span> <span>from</span> <span>'muse-ui'</span><span>;</span>
<span>import</span> <span>'muse-ui/dist/muse-ui.css'</span><span>;</span>

<span>import</span> router <span>from</span> <span>'./router'</span>
Vue<span>.</span><span>use</span><span>(</span>Drawer<span>)</span>
Vue<span>.</span><span>use</span><span>(</span>List<span>)</span>
Vue<span>.</span><span>use</span><span>(</span>Menu<span>)</span>
Vue<span>.</span><span>use</span><span>(</span>Icon<span>)</span>
Vue<span>.</span><span>use</span><span>(</span>AppBar<span>)</span>
Vue<span>.</span><span>use</span><span>(</span>Button<span>)</span>
Vue<span>.</span><span>use</span><span>(</span>Divider<span>)</span>

Object<span>.</span><span>keys</span><span>(</span>filters<span>)</span><span>.</span><span>forEach</span><span>(</span><span>key</span> <span>=></span> <span>{</span>   <span>// 注册全局过滤器</span>
  Vue<span>.</span><span>filter</span><span>(</span>key<span>,</span> filters<span>[</span>key<span>]</span><span>)</span>
<span>}</span><span>)</span>
Vue<span>.</span><span>use</span><span>(</span>VueParticles<span>)</span> <span>// 粒子特效背景</span>
Vue<span>.</span><span>use</span><span>(</span>Katex<span>)</span>  <span>// 数学公式渲染</span>

VXETable<span>.</span><span>setup</span><span>(</span><span>{</span>
  <span>// 对组件内置的提示语进行国际化翻译</span>
  <span>i18n</span><span>:</span> <span>(</span><span>key<span>,</span> value</span><span>)</span> <span>=></span> i18n<span>.</span><span>t</span><span>(</span>key<span>,</span> value<span>)</span>
<span>}</span><span>)</span>
Vue<span>.</span><span>use</span><span>(</span>VXETable<span>)</span> <span>// 表格组件</span>
Vue<span>.</span><span>use</span><span>(</span>VueClipboard<span>)</span> <span>// 剪贴板</span>
Vue<span>.</span><span>use</span><span>(</span>highlight<span>)</span> <span>// 代码高亮</span>
Vue<span>.</span><span>use</span><span>(</span>Element<span>,</span><span>{</span>
  <span>i18n</span><span>:</span> <span>(</span><span>key<span>,</span> value</span><span>)</span> <span>=></span> i18n<span>.</span><span>t</span><span>(</span>key<span>,</span> value<span>)</span>
<span>}</span><span>)</span>

Vue<span>.</span><span>use</span><span>(</span>VueCropper<span>)</span> <span>// 图像剪切</span>
Vue<span>.</span><span>use</span><span>(</span>Message<span>,</span> <span>{</span> name<span>:</span> <span>'msg'</span> <span>}</span><span>)</span> <span>// `Vue.prototype.$msg` 全局消息提示</span>

Vue<span>.</span><span>use</span><span>(</span>SlideVerify<span>)</span> <span>// 滑动验证码组件</span>

<span>Vue</span><span>.</span>prototype<span>.</span>$axios <span>=</span> axios

<span>Vue</span><span>.</span>prototype<span>.</span>$markDown <span>=</span> mavonEditor<span>.</span>markdownIt<span>.</span><span>use</span><span>(</span>Md_Katex<span>)</span> <span>// 挂载到vue</span>

Vue<span>.</span>config<span>.</span>productionTip <span>=</span> <span>false</span>
<span>new</span> <span>Vue</span><span>(</span><span>{</span>
  router<span>,</span>
  store<span>,</span>
i18n<span>,</span>
  <span>render</span><span>:</span> <span>h</span> <span>=></span> <span>h</span><span>(</span>App<span>)</span>
<span>}</span><span>)</span><span>.</span><span>$mount</span><span>(</span><span>'#app'</span><span>)</span>

</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br><span>52</span><br><span>53</span><br><span>54</span><br><span>55</span><br><span>56</span><br><span>57</span><br><span>58</span><br><span>59</span><br><span>60</span><br><span>61</span><br><span>62</span><br><span>63</span><br><span>64</span><br><span>65</span><br><span>66</span><br><span>67</span><br><span>68</span><br><span>69</span><br><span>70</span><br><span>71</span><br><span>72</span><br><span>73</span><br><span>74</span><br><span>75</span><br><span>76</span><br><span>77</span><br><span>78</span><br><span>79</span><br><span>80</span><br><span>81</span><br><span>82</span><br><span>83</span><br><span>84</span><br><span>85</span><br><span>86</span><br><span>87</span><br><span>88</span><br><span>89</span><br><span>90</span><br><span>91</span><br><span>92</span><br><span>93</span><br><span>94</span><br><span>95</span><br><span>96</span><br><span>97</span><br><span>98</span><br></div></div></li>
<li>
<p>然后使用在<code>hoj-vue</code>目录下，使用<code>npm run build</code>，npm请自行百度下载安装，之后会生成一个dist文件夹，结构如下：</p>
<div><pre><code>dist
├── index.html
├── favicon.ico
└── assets
    ├── css
    │   ├── ....
    ├── fonts
    │   ├── ....
    ├── img
    │   ├── ....
    ├── js
  │   ├── ....

....
....
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><p>将 <code>dist</code> 文件夹复制到服务器上某个目录下，比如 <code>/hoj/www/html/dist</code>，然后修改 <code>docker-compose.yml</code>，在 <code>hoj-frontend</code> 模块中的 <code>volumes</code> 中增加一行 <code>- /hoj/www/html/dist:/usr/share/nginx/html</code> （冒号前面的请修改为实际的路径），然后 <code>docker-compose up -d</code> 即可。</p>
</li>
</ol>
<h2 id="二、全部打包但有个人cdn服务器"> 二、全部打包但有个人CDN服务器</h2>
<div><p>Info</p>
<p>如果云服务器是只有固定小流量出口带宽的，例如1M,2M的，害怕访问速度太慢，但是有钱买CDN服务器，可以先按照上面的方式，生成对应的本地静态文件夹，然后把<code>dist/assets</code>文件夹放在CDN服务器上，然后修改<code>dist/index.html</code></p>
</div>
<p><strong>(建议：有弄过CDN的可以这样搞)</strong></p>
<p>添加css等文件的导入</p>
<div><pre><code><span><span><span>&lt;</span>link</span> <span>href</span><span><span>=</span><span>"</span>cdn服务器的地址/assets/css/文件名称.css<span>"</span></span> <span>rel</span><span><span>=</span><span>"</span>prefetch<span>"</span></span><span>></span></span>
</code></pre>
<div><span>1</span><br></div></div><p>添加js等文件的导入</p>
<div><pre><code><span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>"</span>cdn服务器的地址/assets/js/文件名称.js<span>"</span></span><span>></span></span>
</code></pre>
<div><span>1</span><br></div></div><div><pre><code>..............................
</code></pre>
</div><p>将 <code>dist</code> 文件夹复制到服务器上某个目录下，比如 <code>/hoj/www/html/dist</code>，然后修改 <code>docker-compose.yml</code>，在 <code>hoj-frontend</code> 模块中的 <code>volumes</code> 中增加一行 <code>- /hoj/www/html/dist:/usr/share/nginx/html</code> （冒号前面的请修改为实际的路径），然后 <code>docker-compose up -d</code> 即可。</p>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-12-06T13:04:45.000Z</published>
  </entry>
  <entry>
    <title type="html">比赛介绍</title>
    <id>https://hcode.top/docs/use/contest/</id>
    <link href="https://hcode.top/docs/use/contest/"/>
    <updated>2021-12-12T11:51:55.000Z</updated>
    <content type="html"><![CDATA[<h1 id="比赛介绍"> 比赛介绍</h1>
<div><p>Tips</p>
<p>总概功能介绍</p>
<ul>
<li>支持ACM、OI、IOI赛制</li>
<li>支持公开赛、保护赛、私有赛</li>
<li>支持线下打印功能</li>
<li>支持比赛账号限制功能</li>
<li>支持封榜、支持打星队伍、支持关注队伍</li>
<li>支持比赛外部榜单显示</li>
<li>支持榜单显示用户显示自定义</li>
</ul>
</div>
<h2 id="两种赛制"> 两种赛制</h2>
<h3 id="一、acm-比赛模式"> 一、ACM 比赛模式</h3>
<p>在该模式下,我们严格按照ACM-ICPC的比赛规则来进行，Contest设置项中的<code>Seal Time Rank</code>即为是否封榜，封榜后将不再刷新排名。可选择比赛结束前半小时，比赛前一小时，比赛全程封榜。</p>
<p><strong>如果开启封榜，则封榜期间的角色不同如下：</strong></p>
<div><p>Info</p>
<ol>
<li>封榜期间，<strong>超级管理员与比赛创建者</strong>不受影响，正常可查看题目统计数据，提交数据等，排行榜需自行开启强制刷新，同时提交结果可以及时看到评测结果，但不会纳入排行榜！</li>
<li>封榜期间，<strong>普通用户与非比赛创建者</strong>（包括其它管理员角色），可以及时看到自己的提交结果，但不可看到别人<strong>封榜后</strong>的提交，不能看到题目的统计情况，排行榜保持<strong>封榜前</strong>的排名数据。</li>
</ol>
</div>
<p><strong>注意：比赛一结束，默认所有数据变成正常显示，但后台可以设置比赛结束继续封榜！</strong></p>
<h3 id="二、oi-比赛模式"> 二、OI 比赛模式</h3>
<p>在OI模式下，选手的提交将根据得分点来计分，多次提交以最后一次提交为准，排名规则为多个题目的总分数。同样可以进行封榜操作，封榜时段，选手不能查看到实时的排行榜数据！</p>
<p><strong>如果开启封榜，则封榜期间的角色不同如下：</strong></p>
<div><p>Info</p>
<ol>
<li>封榜期间，<strong>超级管理员与比赛创建者</strong>不受影响，正常可查看题目统计数据，提交数据等，排行榜需自行开启强制刷新，同时提交结果可以及时看到评测结果，但不会纳入排行榜！</li>
<li>封榜期间：<strong>普通用户与非比赛创建者</strong>（包括其它管理员角色），看不到自己和其它所有人<strong>封榜后</strong>的提交结果，不能看到题目的统计情况，排行榜保持<strong>封榜前</strong>的排名数据。</li>
</ol>
</div>
<p><strong>比赛一结束，默认所有数据变成正常显示，但后台可以设置比赛结束继续封榜！</strong></p>
<div><p>Note</p>
<p>注意：管理员可以选择强制刷新，查看实时的排行榜数据！通过<code>Force Update</code>来强制刷新榜，且刷新后的榜仅对管理者可见。</p>
</div>
<h2 id="比赛权限"> 比赛权限</h2>
<div><p>Tips</p>
<ul>
<li><strong>公开赛</strong>：所有用户都可以查看比赛详情、比赛题目、比赛提交，比赛排行榜、比赛讨论等，且都可以在比赛阶段随时提交。</li>
<li><strong>保护赛</strong>：所有用户都可以查看比赛详情、比赛题目、比赛提交，比赛排行榜、比赛讨论等，但在比赛阶段提交需要提供该比赛的密码！</li>
<li><strong>私有赛</strong>：仅支持有比赛密码的用户进入比赛，查看查看比赛详情、比赛题目、比赛提交，比赛排行榜、比赛讨论等，包括提交。</li>
</ul>
</div>
<h2 id="比赛题目"> 比赛题目</h2>
<p><strong>后台比赛题目列表管理页面如下</strong></p>
<p><img src="https://img-blog.csdnimg.cn/2a8354a553d547d786e37d41050d3b95.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述" /></p>
<h2 id="比赛管理"> 比赛管理</h2>
<p><strong>后台比赛管理页面如下</strong></p>
<p><img src="https://img-blog.csdnimg.cn/da52c1fe08e34be6be79fbe5c2b758d2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="比赛管理" /></p>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-05-23T14:43:06.000Z</published>
  </entry>
  <entry>
    <title type="html">题目管理</title>
    <id>https://hcode.top/docs/use/import-problem/</id>
    <link href="https://hcode.top/docs/use/import-problem/"/>
    <updated>2021-12-12T11:51:55.000Z</updated>
    <content type="html"><![CDATA[<h1 id="题目管理"> 题目管理</h1>
<h2 id="一、hoj题目"> 一、HOJ题目</h2>
<p><img src="https://img-blog.csdnimg.cn/f059e38d31c44906b35ad4ff0d488013.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述" /></p>
<h4 id="_1-导出题目"> 1. 导出题目</h4>
<p>点击选择需要的题目，便可以批量导出成一个zip压缩包，分别对应一个json格式的题目数据，一个对应名字的文件夹存放评测数据文件，具体的文件结构如下：</p>
<div><pre><code>+-- problem_1000.json
+-- problem_1000
|   +-- 1.in
|   +-- 1.out
|   +-- ....
+-- problem_1001.json
+-- problem_1001
|   +-- 1.in
|   +-- 1.out
|   +-- ....
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><h4 id="_2-导入题目"> 2. 导入题目</h4>
<p>选择需要导入的题目数据zip压缩包，注意<strong>不要多一层文件夹进行压缩</strong>，<strong>请保证题目json文件的名字与其对应的存放评测数据的文件夹名字一致</strong>，具体文件格式如下：</p>
<div><pre><code>+-- problem_1000.json
+-- problem_1000
|   +-- 1.in
|   +-- 1.out
|   +-- ....
+-- problem_1001.json
+-- problem_1001
|   +-- 1.in
|   +-- 1.out
|   +-- ....
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br></div></div><h4 id="_3-题目的json文件格式"> 3. 题目的json文件格式</h4>
<p>请严格按照以下格式，才可以正常导入。</p>
<div><pre><code><span>{</span>
    <span>// 题目支持的语言如下，可多可少</span>
    <span>"languages"</span><span>:</span> <span>[</span><span>"C"</span><span>,</span> <span>"C++"</span><span>,</span> <span>"Java"</span><span>,</span> <span>"Python3"</span><span>,</span> <span>"Python2"</span><span>,</span>  <span>"Golang"</span><span>,</span> <span>"C#"</span><span>]</span><span>,</span> 
    <span>"samples"</span><span>:</span> <span>[</span>
        <span>{</span>
            <span>"input"</span><span>:</span> <span>"1.in"</span><span>,</span> 
            <span>"output"</span><span>:</span> <span>"1.out"</span><span>,</span>
            <span>//"score": 10  // 如果是oi题目需要给测试点加得分</span>
        <span>}</span><span>,</span>
        <span>{</span>
            <span>"input"</span><span>:</span> <span>"2.in"</span><span>,</span> 
            <span>"output"</span><span>:</span> <span>"2.out"</span><span>,</span>
            <span>//"score": 10  // 如果是oi题目需要给测试点加得分</span>
        <span>}</span>
    <span>]</span><span>,</span> 
    <span>"tags"</span><span>:</span> <span>[</span><span>"测试题"</span><span>,</span><span>"测试"</span><span>]</span><span>,</span> <span>// 题目标签，一般不超过三个 </span>
    <span>"problem"</span><span>:</span> <span>{</span>
        <span>"auth"</span><span>:</span> <span>1</span><span>,</span> <span>// 1 公开赛</span>
        <span>"author"</span><span>:</span> <span>"admin"</span><span>,</span> <span>// 题目上传的作者，请使用用户名</span>
        <span>"isRemote"</span><span>:</span> <span>false</span><span>,</span> <span>// 均为非VJ题目，不用修改</span>
        <span>"problemId"</span><span>:</span> <span>"HOJ-1010"</span><span>,</span> <span>// 题目的展示id</span>
        <span>"description"</span><span>:</span> <span>""</span><span>,</span> <span>// 题目的描述，支持markdown语法</span>
        <span>"source"</span><span>:</span> <span>""</span><span>,</span> <span>// 题目来源</span>
        <span>"title"</span><span>:</span> <span>""</span><span>,</span> <span>// 题目标题</span>
        <span>"type"</span><span>:</span> <span>0</span><span>,</span>  <span>// 0为ACM题目，1为OI题目</span>
        <span>"timeLimit"</span><span>:</span> <span>1000</span><span>,</span> <span>// 时间限制 单位是ms</span>
        <span>"memoryLimit"</span><span>:</span> <span>256</span><span>,</span> <span>// 空间限制 单位是mb</span>
        <span>"input"</span><span>:</span> <span>""</span><span>,</span> <span>// 题目的输入描述</span>
        <span>"output"</span><span>:</span> <span>""</span><span>,</span> <span>// 题目的输出描述</span>
        <span>"difficulty"</span><span>:</span> <span>0</span><span>,</span> <span>// 题目难度，1为简单，2为中等，3为困难</span>
        <span>"examples"</span><span>:</span> <span>""</span><span>,</span> <span>// 题目的题面样例，格式为&lt;input>输入&lt;/input>&lt;output>输出&lt;/output>&lt;input>输入&lt;/input>&lt;output>输出&lt;/output></span>
        <span>"ioScore"</span><span>:</span> <span>100</span><span>,</span> <span>// OI题目总得分，与测试点总分一致</span>
        <span>"codeShare"</span><span>:</span> <span>true</span><span>,</span> <span>// 该题目是否允许用户共享其提交的代码 </span>
        <span>"hint"</span><span>:</span> <span>""</span><span>,</span> <span>// 题目提示</span>
        <span>"isRemoveEndBlank"</span><span>:</span> <span>true</span><span>,</span> <span>// 评测数据的输出是否自动去掉行末空格</span>
        <span>"openCaseResult"</span><span>:</span> <span>true</span><span>,</span>  <span>// 是否允许用户看到各个评测点的结果</span>
       	<span>// "spjLanguage:"C" // 特殊判题的程序代码语言</span>
        <span>// "spjCode":"" // 特殊判题的代码</span>
    <span>}</span><span>,</span> 
     <span>"isSpj"</span><span>:</span> <span>false</span><span>,</span> <span>// 是否为特殊判题</span>
    <span>"codeTemplates"</span><span>:</span> <span>[</span>
        <span>{</span>
            <span>"code"</span><span>:</span> <span>""</span><span>,</span> <span>// 模板代码</span>
            <span>"language"</span><span>:</span> <span>"C"</span> <span>// 模板代码语言</span>
        <span>}</span><span>,</span> 
        <span>{</span>
            <span>"code"</span><span>:</span> <span>""</span><span>,</span> <span>// 模板代码</span>
            <span>"language"</span><span>:</span> <span>"C++"</span><span>// 模板代码语言</span>
        <span>}</span>
    <span>]</span>
<span>}</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br><span>43</span><br><span>44</span><br><span>45</span><br><span>46</span><br><span>47</span><br><span>48</span><br><span>49</span><br><span>50</span><br><span>51</span><br></div></div><h2 id="二、导入qduoj或fps格式的题目"> 二、导入QDUOJ或FPS格式的题目</h2>
<ol>
<li>请严格按照青岛oj的后台导出的压缩文件来上传。</li>
<li>请使用标准的FPS格式的题目数据文件(.xml)</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/57c6518fb9fe426088c064d85dd110d3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述" /></p>
<h2 id="三、导入其它oj题目"> 三、导入其它OJ题目</h2>
<p>导入HDU、Codeforces、POJ、GYM的题目，只需提供该题目的题号便可一键导入</p>
<p><strong>管理员进入后台，点击题目列表</strong></p>
<p><img src="https://img-blog.csdnimg.cn/5304425397f249808b7ea0ea2a0153cc.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述" /></p>
<p>然后添加上方的添加按钮</p>
<p><img src="https://img-blog.csdnimg.cn/20210523222914722.png" alt="在这里插入图片描述" /></p>
<p><strong>在弹出窗中选择OJ名字及题号，便可导入</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20210523223042100.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzg1MzA5Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" /></p>
<p><strong>注意：</strong></p>
<ul>
<li>HDU和POJ的题号一般是 1000以上的数字</li>
<li>Codeforces和GYM的题号是1000A、1000B、这种数字加大写英文字母的格式</li>
</ul>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-05-23T14:43:06.000Z</published>
  </entry>
  <entry>
    <title type="html">评论管理</title>
    <id>https://hcode.top/docs/use/discussion-admin/</id>
    <link href="https://hcode.top/docs/use/discussion-admin/"/>
    <updated>2021-05-23T14:43:06.000Z</updated>
    <content type="html"><![CDATA[<h1 id="评论管理"> 评论管理</h1>
<p><img src="https://img-blog.csdnimg.cn/6fcdb9f6895043498cb9d4bbadeb0a5b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="评论管理" /></p>
<div><p>Tips</p>
<ul>
<li>后台管理员可以查看所有的讨论帖，并且可以选择是否置顶，是否正常显示，删除，查看等</li>
<li>后台管理员可以查看对应讨论帖的举报内容</li>
</ul>
</div>
<p><img src="https://img-blog.csdnimg.cn/20210523221321418.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mzg1MzA5Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" /></p>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-05-23T14:43:06.000Z</published>
  </entry>
  <entry>
    <title type="html">通知和公告发布</title>
    <id>https://hcode.top/docs/use/notice-announcement/</id>
    <link href="https://hcode.top/docs/use/notice-announcement/"/>
    <updated>2021-10-09T13:46:41.000Z</updated>
    <content type="html"><![CDATA[<h1 id="通知和公告发布"> 通知和公告发布</h1>
<div><p>Tips</p>
<ol>
<li>通知和公告都仅有超级管理员可操作</li>
<li>通知是系统消息通知，每个小时推送一次到用户的站内消息系统</li>
</ol>
</div>
<p><img src="https://img-blog.csdnimg.cn/b2e1edf697494ed68c760beb63b782bf.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述" /></p>
<p><img src="https://img-blog.csdnimg.cn/fe1cf4b8c0174933b8ffc8f17a486b53.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述" /></p>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-10-09T13:46:41.000Z</published>
  </entry>
  <entry>
    <title type="html">导入用户</title>
    <id>https://hcode.top/docs/use/import-user/</id>
    <link href="https://hcode.top/docs/use/import-user/"/>
    <updated>2021-11-14T05:56:04.000Z</updated>
    <content type="html"><![CDATA[<h2 id="导入用户"> 导入用户</h2>
<p><img src="https://img-blog.csdnimg.cn/338bf9db257844a1b32a4ff54c6528f6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述" /></p>
<p><strong>要求如下:</strong></p>
<div><p>Tips</p>
<ol>
<li>用户数据导入仅支持csv格式的用户数据。</li>
<li>共七列数据：用户名和密码不能为空，邮箱、真实姓名、性别、昵称和学校可选填，否则该行数据可能导入失败。</li>
<li>第一行不必写(“用户名”，“密码”，“邮箱”，&quot;真实姓名&quot;，“性别”，“昵称”，“学校”)这7个列名</li>
<li>性别为男请使用“male”或“0”，女请使用“female”或“1”，不填默认为“secrecy”。</li>
<li>请导入保存为UTF-8编码的文件，否则中文可能会乱码。</li>
</ol>
</div>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-05-23T14:43:06.000Z</published>
  </entry>
  <entry>
    <title type="html">特殊判题</title>
    <id>https://hcode.top/docs/use/spj/</id>
    <link href="https://hcode.top/docs/use/spj/"/>
    <updated>2021-08-14T15:01:55.000Z</updated>
    <content type="html"><![CDATA[<h1 id="特殊判题"> 特殊判题</h1>
<h2 id="什么是特殊判题"> 什么是特殊判题？</h2>
<p>特殊判题（Special Judge）是指OJ将使用一个特定的程序来判断提交的程序的输出是不是正确的，而不是单纯地看提交的程序的输出是否和标准输出一模一样。</p>
<h2 id="使用场景"> 使用场景</h2>
<p>一般使用Special Judge都是因为题目的答案不唯一，更具体一点说的话一般是两种情况：</p>
<ul>
<li>题目最终要求输出一个解决方案，而且这个解决方案可能不唯一。</li>
<li>题目最终要求输出一个浮点数，而且会告诉只要答案和标准答案相差不超过某个较小的数就可以，比如0.01。这种情况保留3位小数、4位小数等等都是可以的，而且多保留几位小数也没什么坏处。</li>
</ul>
<h2 id="支持"> 支持</h2>
<p>HOJ支持testlib.h头文件的直接使用  具体使用文档请看<a href="https://oi-wiki.org/tools/testlib/" target="_blank" rel="noopener noreferrer">https://oi-wiki.org/tools/testlib/</a></p>
<h2 id="例子"> 例子：</h2>
<p>在创建题目的适合，选择开启特殊判题，编写特殊判题程序，然后编译通过便可。</p>
<blockquote>
<p>后台对题目使用特殊判题时，请参考以下程序例子 判断精度</p>
</blockquote>
<ul>
<li>使用Testlib特殊判题</li>
</ul>
<div><pre><code><span><span>#</span><span>include</span> <span>&lt;iostream></span></span>
<span><span>#</span><span>include</span> <span>"testlib.h"</span></span>

<span>using</span> <span>namespace</span> std<span>;</span>

<span>int</span> <span>main</span><span>(</span><span>int</span> argc<span>,</span> <span>char</span> <span>*</span>args<span>[</span><span>]</span><span>)</span><span>{</span>
    <span>/**
    inf: 输入文件流
    ouf: 选手输出流
    ans: 标准答案流
    **/</span>
    <span>registerTestlibCmd</span><span>(</span>argc<span>,</span> args<span>)</span><span>;</span>
    <span>double</span> pans <span>=</span> ouf<span>.</span><span>readDouble</span><span>(</span><span>)</span><span>;</span>
    <span>double</span> jans <span>=</span> ans<span>.</span><span>readDouble</span><span>(</span><span>)</span><span>;</span>
    <span>if</span> <span>(</span><span>fabs</span><span>(</span>pans <span>-</span> jans<span>)</span><span>&lt;</span><span>0.01</span><span>)</span>
        <span>quitf</span><span>(</span>_ok<span>,</span> <span>"The answer is correct."</span><span>)</span><span>;</span>
    <span>else</span>
        <span>quitf</span><span>(</span>_wa<span>,</span> <span>"The answer is wrong: expected = %f, found = %f"</span><span>,</span> jans<span>,</span> pans<span>)</span><span>;</span>
    <span>// quitf(_pe, "The answer is presentation error."); // 格式错误</span>
    <span>// quitf(_fail, "The something wrong cause system error."); // 系统错误</span>
<span>}</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br></div></div><ul>
<li>读取文件进行特殊判题</li>
</ul>
<div><pre><code><span><span>#</span><span>include</span><span>&lt;iostream></span></span>
<span><span>#</span><span>include</span><span>&lt;cstdio></span></span>

<span><span>#</span><span>define</span> <span>AC</span> <span><span>100</span></span></span>
<span><span>#</span><span>define</span> <span>PE</span> <span><span>101</span></span></span>
<span><span>#</span><span>define</span> <span>WA</span> <span><span>102</span></span></span>
<span><span>#</span><span>define</span> <span>ERROR</span> <span><span>103</span></span></span>

<span>using</span> <span>namespace</span> std<span>;</span>

<span>void</span> <span>close_file</span><span>(</span>FILE <span>*</span>f<span>)</span><span>{</span>
    <span>if</span><span>(</span>f <span>!=</span> <span>NULL</span><span>)</span><span>{</span>
        <span>fclose</span><span>(</span>f<span>)</span><span>;</span>
    <span>}</span>
<span>}</span>

<span>int</span> <span>main</span><span>(</span><span>int</span> argc<span>,</span> <span>char</span> <span>*</span>args<span>[</span><span>]</span><span>)</span><span>{</span>
    <span>/**
    args[1]：标准输入文件路径 
    args[2]：选手输出文件路径
    args[3]：标准输出文件路径 
    **/</span>
    FILE <span>*</span>std_input_file <span>=</span> <span>fopen</span><span>(</span>args<span>[</span><span>1</span><span>]</span><span>,</span> <span>"r"</span><span>)</span><span>;</span>
    FILE <span>*</span>user_output_file <span>=</span> <span>fopen</span><span>(</span>args<span>[</span><span>2</span><span>]</span><span>,</span> <span>"r"</span><span>)</span><span>;</span>
    FILE <span>*</span>std_output_file <span>=</span> <span>fopen</span><span>(</span>args<span>[</span><span>3</span><span>]</span><span>,</span> <span>"r"</span><span>)</span><span>;</span>
    
    <span>double</span> std_out<span>;</span> <span>// 标准输出</span>
	<span>fscanf</span><span>(</span>user_output_file<span>,</span> <span>"%lf"</span><span>,</span> <span>&amp;</span>std_out<span>)</span><span>;</span>
    
    <span>double</span> user_output<span>;</span><span>// 用户输出 </span>
    <span>fscanf</span><span>(</span>std_output_file<span>,</span> <span>"%lf"</span><span>,</span> <span>&amp;</span>user_output<span>)</span><span>;</span>
    
    <span>// 关闭文件流</span>
    <span>close_file</span><span>(</span>std_input_file<span>)</span><span>;</span>
    <span>close_file</span><span>(</span>user_output_file<span>)</span><span>;</span>
    <span>close_file</span><span>(</span>std_output_file<span>)</span><span>;</span>
    
	<span>if</span> <span>(</span><span>fabs</span><span>(</span>user_output <span>-</span> std_out<span>)</span><span>&lt;=</span><span>1e-6</span><span>)</span>
		<span>return</span> AC<span>;</span>
	<span>else</span> 
		<span>return</span> WA<span>;</span>
<span>}</span>
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br><span>39</span><br><span>40</span><br><span>41</span><br><span>42</span><br></div></div>]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-05-13T10:18:08.000Z</published>
  </entry>
  <entry>
    <title type="html">测试用例</title>
    <id>https://hcode.top/docs/use/testcase/</id>
    <link href="https://hcode.top/docs/use/testcase/"/>
    <updated>2021-12-09T08:58:23.000Z</updated>
    <content type="html"><![CDATA[<h1 id="测试用例"> 测试用例</h1>
<p><img src="https://img-blog.csdnimg.cn/ad4851c069674b30af08f187363906c4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBASGltaXRfWkg=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述" /></p>
<p><strong>进入后台添加题目，上传题目测试用例数据可以选择手动输入、Zip文件上传两种方式</strong></p>
<h2 id="一、手动输入"> 一、手动输入</h2>
<p>每次点击<code>Add Sampple</code>就可以手动填入该用例的输入与输出，该方式比较适合题目数据简单的，同时手动输入的题目数据将记录进数据库，下次对该题目进行修改可以直接获取，然后进行测试数据的修改，同时也会在服务器对应的testcase文件夹生成对应的文件。</p>
<h2 id="二、文件上传"> 二、文件上传</h2>
<p>对于通题目，测试用例文件包括<code>in</code>、<code>out</code>、<code>ans</code>三种拓展名</p>
<p>例如有两组测试用例，则对于普通题目测试用例的文件名分别为<code>1.in, 1.out（1.ans）, 2.in, 2.out（2.ans）</code>其他形式的文件后台均不识别。</p>
<p>压缩时，请将文件都放在压缩包的根目录，而不是包含在某一个文件夹中，比如正确的格式是：</p>
<div><pre><code>├── <span>1</span>.in
├── <span>1</span>.out
├── <span>2</span>.in
├── <span>2</span>.out
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><div><pre><code>├── <span>1</span>.in
├── <span>1</span>.ans
├── <span>2</span>.in
├── <span>2</span>.ans
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></div></div><p>然后压缩测试用例到一个zip中</p>
<div><p>Warning</p>
<p><strong>注意：即使没有输入或者没有输出，也请提供对应的空输入(输出)文件，不要在这些文件外面套多一层文件夹，请直接压缩！！！</strong></p>
</div>
<div><p>Info</p>
<p>建议：尽量合并测试用例到一个文件中，减少测试用例组数，这会一定程度上提高判题性能。</p>
</div>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-05-23T14:43:06.000Z</published>
  </entry>
  <entry>
    <title type="html">自定义前端</title>
    <id>https://hcode.top/docs/use/update-fe/</id>
    <link href="https://hcode.top/docs/use/update-fe/"/>
    <updated>2021-06-14T07:18:19.000Z</updated>
    <content type="html"><![CDATA[<h1 id="自定义前端"> 自定义前端</h1>
<h2 id="一、完全自定义前端"> 一、完全自定义前端</h2>
<p>直接下载<a href="https://gitee.com/himitzh0730/hoj/tree/master/hoj-vue" target="_blank" rel="noopener noreferrer">https://gitee.com/himitzh0730/hoj/tree/master/hoj-vue</a></p>
<p>修改后，使用<code>npm run build</code>，生成一个dist文件夹，结构如下：</p>
<div><pre><code>dist
├── index.html
├── favicon.ico
└── assets
    ├── css
    │   ├── ....
    ├── fonts
    │   ├── ....
    ├── img
    │   ├── ....
    ├── js
    │   ├── ....

....
....
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br></div></div><p>将 <code>dist</code> 文件夹复制到服务器上某个目录下，比如 <code>/hoj/www/html/dist</code>，然后修改 <code>docker-compose.yml</code>，在 <code>hoj-frontend</code> 模块中的 <code>volumes</code> 中增加一行 <code>- /hoj/www/html/dist:/usr/share/nginx/html</code> （冒号前面的请修改为实际的路径），然后 <code>docker-compose up -d</code> 即可。</p>
<h2 id="二、仅修改图标"> 二、仅修改图标</h2>
<div><p>Tips</p>
<p>如果仅仅只是修改前台logo、管理后台logo和favicon.ico，那么操作如下：</p>
</div>
<p>修改 <code>docker-compose.yml</code>，在 <code>hoj-frontend</code> 模块中的 <code>volumes</code> 中添加如下：</p>
<div><pre><code><span>-</span> ./logo.png<span>:</span>/usr/share/nginx/html/assets/img/logo.a0924d7d.png
<span>-</span> ./backstage.png<span>:</span>/usr/share/nginx/html/assets/img/backstage.8bce8c6e.png
<span>-</span> ./favicon.ico<span>:</span>/usr/share/nginx/html/favicon.ico
</code></pre>
<div><span>1</span><br><span>2</span><br><span>3</span><br></div></div><p><code>logo.png</code>为前台导航栏左边的logo，<code>backstage.png</code>为后台侧边导航栏上方的logo，<code>favicon.ico</code>为小图标</p>
<p><strong>图片文件需放在与docker-compose.yml同个目录下，或者提供绝对路径也可。</strong></p>
]]></content>
    <contributor>
      <name/>
    </contributor>
    <published>2021-06-14T07:18:19.000Z</published>
  </entry>
</feed>